<!DOCTYPE html>
<html lang="pt-br">
<head>
    <link rel="icon" type="image/png" href="https://i.imgur.com/b31EnMe.jpeg">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Torneio Dead by Daylight - Ao Vivo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Creepster&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Special+Elite&display=swap" rel="stylesheet">
    <style>
        /* ✨ INÍCIO: ESTILOS PARA O MENU DE OPÇÕES DA MENSAGEM ✨ */
.message-options-menu {
    position: absolute;
    z-index: 1001; /* Acima das mensagens, mas abaixo de popups maiores */
    background-color: #2c2c2c;
    border: 1px solid var(--cor-borda);
    border-radius: 6px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.6);
    padding: 5px;
    display: flex;
    flex-direction: column;
    gap: 3px;
}

.options-menu-item {
    padding: 8px 15px;
    color: var(--cor-texto);
    cursor: pointer;
    font-size: 0.9rem;
    border-radius: 4px;
    transition: background-color 0.2s;
}

.options-menu-item:hover {
    background-color: var(--cor-borda-forte);
}

.options-menu-item.delete { /* Cor especial para a opção de apagar */
    color: #ff5c5c;
}

.options-menu-item.delete:hover {
    background-color: #ff4d4d;
    color: #fff;
}

.chat-message .edited-indicator {
    font-size: 0.75rem;
    color: #999;
    font-style: italic;
    margin-left: 8px;
}
/* ✨ FIM: ESTILOS DO MENU DE OPÇÕES ✨ */
        /* ✨ INÍCIO: ESTILOS DO BANNER DE CAMPEONATO ✨ */
#campeonato-banner {
    position: sticky; /* Fica fixo no topo ao rolar a página */
    top: 0;
    left: 0;
    width: 100%;
    background-color: rgba(10, 10, 10, 0.95);
    backdrop-filter: blur(8px);
    border-bottom: 2px solid var(--cor-principal);
    padding: 15px 5%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 9999; /* Garante que fique acima de todos os outros elementos */
    box-sizing: border-box;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    transition: transform 0.5s ease-in-out, opacity 0.5s ease-in-out;
    transform: translateY(0);
    opacity: 1;
}

/* Animação de entrada */
@keyframes slideInDown {
    from {
        transform: translateY(-100%);
    }
    to {
        transform: translateY(0);
    }
}
#campeonato-banner {
    animation: slideInDown 0.6s ease-out;
}


/* Classe para esconder o banner suavemente */
#campeonato-banner.hidden {
    transform: translateY(-150%);
    opacity: 0;
    pointer-events: none; /* Impede cliques no banner escondido */
}

.banner-conteudo {
    display: flex;
    align-items: center;
    gap: 20px;
}

.banner-icone {
    font-size: 2.5rem;
    line-height: 1;
}

.banner-texto h3 {
    font-family: 'Creepster', cursive;
    color: var(--cor-principal);
    font-size: 1.8rem;
    margin: 0 0 5px 0;
    letter-spacing: 1px;
}

.banner-texto p {
    margin: 0;
    font-size: 1rem;
    color: var(--cor-texto);
}

.banner-texto p strong {
    color: #fff; /* Destaca a data/hora */
}

#close-banner-btn {
    background: none;
    border: none;
    font-size: 2.5rem;
    color: #888;
    cursor: pointer;
    transition: color 0.3s, transform 0.3s;
    padding: 0 15px;
}

#close-banner-btn:hover {
    color: var(--cor-principal);
    transform: scale(1.1);
}

/* Ajuste para telas pequenas */
@media (max-width: 768px) {
    #campeonato-banner {
        padding: 15px;
        flex-direction: column;
        gap: 10px;
        text-align: center;
    }
    .banner-conteudo {
        flex-direction: column;
        gap: 10px;
    }
    #close-banner-btn {
        position: absolute;
        top: 5px;
        right: 5px;
        font-size: 2rem;
    }
}
/* ✨ FIM: ESTILOS DO BANNER ✨ */
        :root {
            --cor-principal: #ff4d4d;
            --cor-fundo-container: rgba(15, 15, 15, 0.9);
            --cor-borda: #4a0e0e;
            --cor-borda-forte: #8B0000;
            --cor-texto: #f0f0f0;
            --cor-cinza-botao: #3a3a3a;
        }
        body {
            margin: 0; padding: 0; font-family: 'Roboto', sans-serif;
            color: var(--cor-texto);
            background-image: url('https://i.imgur.com/Vlh2Ik7.jpeg');
            background-size: cover; background-position: center; background-attachment: fixed;
            backdrop-filter: brightness(0.6);
        }
        header {
    background-color: rgba(10, 10, 10, 0.8); 
    border-bottom: 2px solid var(--cor-borda);
    padding: 15px 5%; 
    position: sticky; 
    top: 0; 
    z-index: 2000;
    display: flex; 
    align-items: center;
    backdrop-filter: blur(10px);
    position: relative; /* ADICIONADO */
}
        .logo h1 { font-family: 'Creepster', cursive; font-size: 2.5rem; color: var(--cor-principal); margin: 0; }
        .nav-buttons { 
    display: flex; 
    gap: 15px; 
    margin-left: auto; /* ADICIONADO */
}
        .nav-buttons .btn {
            font-weight: bold; text-decoration: none; color: var(--cor-texto);
            background-color: var(--cor-borda-forte); padding: 10px 20px;
            border-radius: 5px; transition: all 0.3s ease; text-transform: uppercase;
            border: none; font-size: 0.9rem; cursor: pointer;
        }
        .nav-buttons .btn:hover { background-color: var(--cor-principal); transform: translateY(-2px); box-shadow: 0 4px 15px rgba(255, 0, 0, 0.4); }

        main { padding: 40px 5%; max-width: 1400px; margin: 0 auto; }
        .section-container {
            background-color: var(--cor-fundo-container); padding: 30px; border-radius: 10px;
            border: 2px solid var(--cor-borda); box-shadow: 0 0 25px rgba(0, 0, 0, 0.5);
            margin-bottom: 30px; animation: fadeIn 1s ease-in-out;
            position: relative; 
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .section-title { font-family: 'Creepster', cursive; font-size: 3rem; color: var(--cor-principal); text-align: center; margin-top: 0; margin-bottom: 30px; }
        
        #live-section { max-width: 960px; margin: 0 auto; }
        .video-container {
            position: relative; width: 100%; padding-top: 56.25%; 
            background-color: #000; border-radius: 5px; border: 1px solid var(--cor-borda);
        }
        .video-container > div, .video-container > iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        #player-wrapper iframe { width: 100%; height: 100%; border: none; }
        #offline-image { width: 100%; height: 100%; object-fit: cover; }
        .live-indicator {
            position: absolute; top: 15px; left: 15px; background-color: var(--cor-principal);
            color: white; padding: 5px 10px; border-radius: 5px; font-weight: bold; z-index: 20;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse { 50% { box-shadow: 0 0 20px rgba(255, 77, 77, 1); } }
        .hidden { display: none !important; }
#regras ul {
    font-family: 'Special Elite', monospace; /* Nova fonte */
    font-size: 1.1rem;
    line-height: 1.6;
    color: #ccc; /* Cor um pouco mais apagada, como tinta antiga */
}

/* Destaca números ou palavras-chave */
#regras li strong {
    color: var(--cor-principal);
    font-weight: normal; /* A fonte já é marcante, não precisa de negrito extra */
}
        #regras ul { list-style: none; padding: 0; }
        #regras li { background-color: rgba(0, 0, 0, 0.2); padding: 15px 20px; margin-bottom: 10px; border-left: 4px solid var(--cor-borda-forte); }
        #regras li::before {
    content: ''; /* Remove o emoji */
    display: inline-block;
    width: 10px;
    height: 10px;
    background-color: var(--cor-principal);
    border-radius: 2px;
    margin-right: 15px;
    transform: rotate(45deg); /* Cria um losango, como um gerador */
    filter: drop-shadow(0 0 4px var(--cor-principal));
}

        #dbd-unmute-popup {
            position: absolute; bottom: 30px; left: 50%;
            transform: translateX(-50%) translateY(200%); 
            background-color: var(--cor-fundo-container); padding: 20px;
            border-radius: 10px; border: 1px solid var(--cor-borda-forte);
            box-shadow: 0 0 25px rgba(0,0,0,0.7); z-index: 2000;
            text-align: center; transition: transform 0.4s ease-out, opacity 0.4s ease-out;
            width: auto; max-width: 90%; opacity: 0; pointer-events: none;
        }
        #dbd-unmute-popup.show { transform: translateX(-50%) translateY(0); opacity: 1; pointer-events: auto; }
        #dbd-unmute-popup p { margin: 0 0 15px 0; font-size: 1.1rem; color: var(--cor-texto); }
        .popup-buttons { display: flex; gap: 10px; justify-content: center; }
        .popup-btn {
            border: none; padding: 10px 25px; border-radius: 5px;
            font-weight: bold; font-size: 1rem; cursor: pointer; transition: all 0.2s ease;
        }
        .popup-btn:hover { transform: translateY(-2px); }
        #unmute-yes-btn { background-color: var(--cor-borda-forte); color: white; }
        #unmute-yes-btn:hover { background-color: var(--cor-principal); }
        #unmute-no-btn { background-color: var(--cor-cinza-botao); color: var(--cor-texto); }
        #unmute-no-btn:hover { background-color: #555; }
        
        .popup-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.85); z-index: 3000;
            display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none;
            transition: opacity 0.4s ease; backdrop-filter: blur(5px);
        }
        .popup-overlay.active { opacity: 1; pointer-events: auto; }
        .feedback-popup {
            background-color: #110e0e; border: 1px solid var(--cor-borda);
            box-shadow: 0 0 40px rgba(0,0,0,0.8); border-radius: 10px; padding: 30px 40px;
            width: 90%; max-width: 500px; position: relative;
            transform: scale(0.9); transition: transform 0.4s ease;
        }
        .popup-overlay.active .feedback-popup { transform: scale(1); }
        /* Adicione esta nova classe para alinhar pop-ups no topo */
.popup-overlay.align-top {
    align-items: flex-start; /* Em vez de 'center', alinha no topo */
}
        /* Encontre a regra do popup de feedback e adicione a margem */
.feedback-popup {
    background-color: #110e0e; 
    border: 1px solid var(--cor-borda);
    box-shadow: 0 0 40px rgba(0,0,0,0.8); 
    border-radius: 10px; 
    padding: 30px 40px;
    width: 90%; 
    max-width: 500px; 
    position: relative;
    transform: scale(0.9); 
    transition: transform 0.4s ease;
    margin-top: 30vh; /* ✨ ADICIONE ESTA LINHA ✨ */
}

/* Encontre a regra do popup do placar e adicione a mesma margem */
.scoreboard-popup {
    background-color: #110e0e; 
    border: 1px solid var(--cor-borda);
    box-shadow: 0 0 40px rgba(0,0,0,0.8); 
    border-radius: 10px; 
    padding: 30px 40px;
    width: 90%; 
    max-width: 800px; 
    position: relative;
    transform: scale(0.9); 
    transition: transform 0.4s ease;
    margin-top: 15vh; /* ✨ ADICIONE ESTA LINHA ✨ */
}
        .feedback-popup .close-btn {
            position: absolute; top: 15px; right: 20px;
            background: none; border: none; font-size: 2rem;
            color: #888; cursor: pointer; transition: color 0.3s;
        }
        .feedback-popup .close-btn:hover { color: var(--cor-principal); }
        .feedback-popup h2 { font-family: 'Creepster', cursive; color: var(--cor-principal); font-size: 2.8rem; text-align: center; margin: 0 0 25px 0; }
        .feedback-popup .form-row { display: flex; gap: 20px; margin-bottom: 20px; }
        .feedback-popup .form-group { flex: 1; margin-bottom: 20px; }
        .feedback-popup .form-row .form-group { margin-bottom: 0; }
        @media (max-width: 520px) {
            .feedback-popup .form-row { flex-direction: column; gap: 0; }
            .feedback-popup .form-row .form-group { margin-bottom: 20px; }
        }
        .feedback-popup .form-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #ccc; font-size: 0.8rem; text-transform: uppercase; }
        .feedback-popup .form-group input, .feedback-popup .form-group textarea {
            width: 100%; padding: 12px; background-color: rgba(0, 0, 0, 0.4); border: 1px solid #555;
            border-radius: 5px; color: #fff; font-size: 1rem;
            box-sizing: border-box; font-family: 'Roboto', sans-serif;
        }
        .feedback-popup .form-group textarea { resize: vertical; min-height: 120px; }
        .submit-feedback {
            width: 100%; border: none; background-color: var(--cor-borda-forte);
            color: white; padding: 15px; border-radius: 5px;
            font-size: 1.1rem; font-weight: bold; cursor: pointer;
            transition: all 0.3s; margin-top: 10px;
        }
        .submit-feedback:hover { background-color: var(--cor-principal); }
        .feedback-success { text-align: center; padding: 40px 20px; }
        .feedback-success .icon { font-size: 4rem; color: var(--cor-principal); animation: popIn 0.5s ease; }
        @keyframes popIn { from { transform: scale(0.5); opacity: 0; } }
        .feedback-success h3 { font-family: 'Creepster', cursive; font-size: 2.5rem; margin: 15px 0 10px 0; }
        
        /* --- ESTILOS DO PLACAR (VERSÃO FINAL: VIDRO AVERMELHADO) --- */
.scoreboard-fab {
    position: absolute;
    bottom: 20px;
    right: 20px;
    z-index: 1000;

    /* Efeito de Vidro Tingido de Vermelho */
    background: radial-gradient(circle, rgba(255, 77, 77, 0.15) 0%, rgba(139, 0, 0, 0.1) 100%); /* ✨ ALTERADO: Opacidade bem menor para um efeito mais sutil */
    backdrop-filter: blur(12px); /* ✨ ALTERADO: Um pouco mais de desfoque */
    border: 1px solid rgba(255, 255, 255, 0.25); /* ✨ ALTERADO: Borda mais fina e clara, como vidro */
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.35);

    /* Estilos do conteúdo */
    border-radius: 50px;
    padding: 10px 20px;
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    color: var(--cor-texto);
    font-weight: bold;
    font-size: 1rem;
    
    /* Transição Suave */
    transition: all 0.3s ease;
}

.scoreboard-fab:hover {
    transform: scale(1.05) translateY(-5px); /* Efeito de elevação */
    background: radial-gradient(circle, rgba(255, 77, 77, 0.25) 0%, rgba(139, 0, 0, 0.2) 100%); /* ✨ ALTERADO: Ainda bem transparente no hover */
    border: 1px solid var(--cor-principal); /* Borda acende com a cor do tema */
    box-shadow: 0 0 25px rgba(255, 77, 77, 0.6); /* Brilho vermelho um pouco mais forte */
}

.scoreboard-fab img {
    width: 50px;
    height: 50px;
}
/* --- INÍCIO: ESTILOS DO POP-UP DE MEMBROS DA EQUIPE --- */

/* Torna o nome da equipe no placar clicável e com efeito hover */
.leaderboard-list .name {
    cursor: pointer;
    transition: color 0.3s ease, text-shadow 0.3s ease;
}
.leaderboard-list .name:hover {
    color: var(--cor-principal);
    text-shadow: 0 0 8px var(--cor-principal);
}

/* Estilo da lista de membros dentro do pop-up */
#team-info-members-list {
    list-style: none;
    padding: 0;
    margin-top: 30px;
}

#team-info-members-list li {
    background-color: rgba(0, 0, 0, 0.2);
    padding: 15px 20px;
    margin-bottom: 10px;
    border-radius: 6px;
    border-left: 3px solid #666;
    font-size: 1.2rem;
    font-weight: 500;
    transition: all 0.3s ease;
}

#team-info-members-list li:hover {
    transform: translateX(5px);
    border-left-color: var(--cor-principal);
}

/* ✨ ESTILO DE DESTAQUE PARA O CAPITÃO ✨ */
#team-info-members-list li.captain-member {
    background: linear-gradient(90deg, rgba(255, 215, 0, 0.15), rgba(255, 215, 0, 0) 70%);
    border-left: 4px solid #FFD700; /* Dourado */
    color: #FFD700;
    font-weight: 700;
}

/* Ícone de coroa para o capitão */
#team-info-members-list li.captain-member::before {
    content: '👑';
    margin-right: 12px;
    vertical-align: middle;
    display: inline-block;
    filter: drop-shadow(0 0 5px #FFD700); /* Brilho na coroa */
}
/* ✨ ESTILO DE DESTAQUE PARA O KILLER ✨ */
#team-info-members-list li.killer-member {
    background: linear-gradient(90deg, rgba(255, 77, 77, 0.2), rgba(255, 77, 77, 0) 70%);
    border-left: 4px solid var(--cor-principal); /* Vermelho */
    color: var(--cor-principal);
    font-weight: 700;
    text-shadow: 0 0 8px rgba(255, 77, 77, 0.7);
}

/* Ícone de faca para o Killer */
#team-info-members-list li.killer-member::before {
    content: '🔪';
    margin-right: 12px;
    vertical-align: middle;
    display: inline-block;
    filter: drop-shadow(0 0 5px var(--cor-principal)); /* Brilho vermelho */
}

/* Garante que o ícone do Killer apareça mesmo se o jogador for Capitão */
#team-info-members-list li.captain-member.killer-member::before {
    content: '👑 🔪'; /* Mostra ambos os ícones */
}
/* --- FIM: ESTILOS DO POP-UP DE MEMBROS --- */
        .scoreboard-popup {
            background-color: #110e0e; border: 1px solid var(--cor-borda);
            box-shadow: 0 0 40px rgba(0,0,0,0.8); border-radius: 10px; padding: 30px 40px;
            width: 90%; max-width: 800px; position: relative;
            transform: scale(0.9); transition: transform 0.4s ease;
        }
        .popup-overlay.active .scoreboard-popup { transform: scale(1); }
        .scoreboard-popup .close-btn {
            position: absolute; top: 15px; right: 20px; background: none; border: none; font-size: 2rem;
            color: #888; cursor: pointer; transition: color 0.3s;
        }
        .scoreboard-popup .close-btn:hover { color: var(--cor-principal); }
        .scoreboard-popup h2 { font-family: 'Creepster', cursive; color: var(--cor-principal); font-size: 2.8rem; text-align: center; margin: 0 0 25px 0; }
        .score-display { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        .score-card { background-color: rgba(0,0,0,0.4); padding: 20px; border-radius: 5px; }
        .score-card h3 {
            margin: 0 0 15px 0; font-size: 1.2rem; text-transform: uppercase;
            display: flex; align-items: center; justify-content: center;
            gap: 10px; padding-bottom: 10px; border-bottom: 1px solid var(--cor-borda);
        }
        .score-card h3 img { height: 60px; }
        .leaderboard-list { list-style: none; padding: 0; margin: 0; min-height: 288px; }
        .leaderboard-list li { display: flex; justify-content: space-between; padding: 8px 5px; border-radius: 3px; font-size: 1.1rem; }
        .leaderboard-list li:nth-child(odd) { background-color: rgba(255,255,255,0.05); }
        .leaderboard-list .name { font-weight: bold; }
        .leaderboard-list .score { color: var(--cor-principal); font-weight: bold; }
        /* Estilo para a mensagem inteira de um moderador */
.moderator-message {
    background: linear-gradient(90deg, rgba(255, 215, 0, 0.1), rgba(255, 215, 0, 0) 70%);
    border-left: 4px solid #FFD700; /* Borda dourada */
    padding-left: 15px !important; /* Adiciona um recuo para destacar */
}

/* Estilo para o NOME do moderador */
.moderator-message .name {
    color: #FFD700; /* Cor dourada */
    font-weight: bold;
    text-shadow: 0 0 8px rgba(255, 215, 0, 0.8), 0 0 3px black; /* Efeito de brilho */
}

/* Adiciona um ícone de escudo antes do nome do moderador */
.moderator-message .name::before {
    content: ''; /* Apaga o emoji de escudo */
    display: inline-block;
    width: 60px;          /* Largura do seu selo (ajuste se quiser) */
    height: 60px;         /* Altura do seu selo (ajuste se quiser) */
    margin-right: 8px;    /* Espaço entre o selo e o nome */
    vertical-align: middle; /* Alinha o selo com o texto */
    background-image: url('https://i.imgur.com/2L3vqPA.png');
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
}
        /* ===== NOVO LAYOUT DO CHAT (STATUS ACIMA, MENSAGEM AO LADO) ===== */
.chat-message {
    line-height: 1.4;
    margin-bottom: 15px;
    word-wrap: break-word;
}

.chat-message .name {
    /* Estilo do Nome de usuário */
    font-weight: bold;
    line-height: 1.2;
    margin-right: 8px; /* <-- Voltamos a ter uma margem à direita */
}

.watching-indicator {
    /* Status discreto ACIMA do nome */
    display: block;
    font-size: 0.7rem;
    color: #888; /* Um pouco mais claro que antes para ser legível */
    font-style: italic;
    line-height: 1;
    margin-bottom: 4px; /* Espaço entre o status e a linha do nome/mensagem */
    font-weight: normal;
}

.chat-message .text {
    /* O texto da mensagem volta a fluir normalmente */
    font-size: 0.95rem;
    display: inline; /* <-- Garante que fique ao lado do nome */
    padding-top: 0;
}
/* ================================================================= */
/* ======================================================= */
        @media (max-width: 768px) { .score-display { grid-template-columns: 1fr; } }
        /* --- INÍCIO: ESTILOS DA CONTAGEM REGRESSIVA --- */
#countdown-container {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);

    /* Estilos antigos que mantivemos */
    text-align: center;
    padding: 0 20px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    min-width: 300px; 
}
.countdown-title {
    margin: 0 0 5px 0;
    font-size: 1rem;
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 2px;
    color: #ccc;
}
#timer {
    display: flex;
    justify-content: center;
    gap: 15px;
}
.time-block {
    display: flex;
    flex-direction: column;
    align-items: center;
}
.time-value {
    font-family: 'Creepster', cursive;
    font-size: 2.5rem;
    color: var(--cor-principal);
    line-height: 1;
    animation: pulse-red-text 2s infinite;
}
.time-label {
    font-size: 0.7rem;
    text-transform: uppercase;
    color: #aaa;
}
#live-message {
    font-family: 'Creepster', cursive;
    font-size: 2rem;
    color: var(--cor-principal);
    animation: pulse-red-text 1.5s infinite;
}
@keyframes pulse-red-text {
    50% { text-shadow: 0 0 15px var(--cor-principal); }
}
@media (max-width: 900px) {
    #countdown-container { display: none; } /* Esconde em telas pequenas para não quebrar o layout */
}
/* --- FIM DOS ESTILOS --- */
        /* ===================================================================== */
/* ✨ INÍCIO: VERSÃO FINAL COM ELEMENTO DEDICADO ✨ */
/* ===================================================================== */

/* --- CONFIGURAÇÃO DA HIERARQUIA (EMPILHAMENTO) --- */

#chat-messages {
    position: relative;
}
.chat-message {
    position: relative;
    z-index: 5;
}
#chat-placeholder {
    position: absolute;
    width: 100%;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    z-index: 10;
}

/* --- ESTILO DA NOSSA NOVA CAMADA/OVERLAY --- */

#chat-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    
    background-image: url('https://i.imgur.com/2UivLtF.png');
    background-size: cover;
    background-position: center;
    
    z-index: 8;
    
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.4s ease-in-out;
}

/* --- O GATILHO QUE ATIVA TUDO --- */

/* Quando o placeholder estiver ativo (classe no pai)... */
#chat-messages.placeholder-active #chat-overlay {
    /* ...o nosso div de overlay se torna visível! */
    opacity: 0.95;
}

/* ✨ A CORREÇÃO DEFINITIVA ESTÁ AQUI ✨ */
/* Bloqueia a rolagem do chat de forma forçada quando o placeholder está ativo */
#chat-messages.placeholder-active {
    overflow-y: hidden !important;
}

/* ===================================================================== */
/* ✨ FIM DA VERSÃO FINAL ✨ */
/* ===================================================================== */
        /* --- INÍCIO: ESTILOS DO CONTADOR DE VISITANTES --- */
#visitor-counter {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #aaa;
    margin-top: 65px; /* Alinha com o logo */
    font-size: 0.9rem;
    text-shadow: 0 0 5px black;
    transform: translateX(-185px);
}
#visitor-counter .icon {
    font-size: 1.2rem;
    animation: pulse-red-text 3s infinite; /* Usa a animação cintilante */
}
#visitor-counter #visitor-count {
    font-weight: bold;
    color: var(--cor-principal);
    font-size: 1.1rem;
}
/* Esconde em telas pequenas para não quebrar o layout */
@media (max-width: 768px) {
    #visitor-counter {
        display: none;
    }
}
/* --- FIM DOS ESTILOS --- */
        .logo {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        /* --- INÍCIO: ESTILOS DO CHAT AO VIVO --- */
#chat-messages {
    height: 350px;
    overflow-y: auto;
    border: 1px solid #333;
    padding: 15px;
    border-radius: 5px;
    margin-bottom: 15px;
    display: flex;
    flex-direction: column;

    /* --- ADIÇÕES PARA O FUNDO TEMÁTICO --- */
    background-image: 
        /* Camada de cor preta semi-transparente por cima */
        linear-gradient(rgba(15, 15, 15, 0.85), rgba(15, 15, 15, 0.85)),
        /* Sua imagem da Entidade por baixo */
        url('https://i.imgur.com/ElV8c5i.png');
    
    background-position: center; /* Centraliza a imagem */
    background-repeat: no-repeat; /* A imagem não se repete */
    background-size: contain; /* Garante que a imagem caiba inteira na caixa */
}
        /* --- INÍCIO: ESTILOS DO PLACEHOLDER DO CHAT --- */

/* Torna a caixa de mensagens um container para o placeholder */
#chat-messages {
    position: relative;
}

#chat-placeholder {
    /* Posicionamento (sem alteração) */
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);

    /* Aparência */
    text-align: center;
    width: 80%;
    pointer-events: none; /* Impede que o texto seja clicável */
    transition: opacity 0.3s ease;
}

/* Esconde o placeholder quando o chat está ativo */
#chat-placeholder.hidden {
    opacity: 0;
}

#chat-placeholder .placeholder-icon {
    font-size: 3rem;
    margin-bottom: 10px;
    opacity: 0.6; /* 🔧 ALTERADO: Ícone um pouco mais visível */
    /* ✨ NOVO: Adiciona um brilho sutil no ícone */
    text-shadow: 0 0 8px rgba(255, 77, 77, 0.5); 
}

#chat-placeholder h4 {
    margin: 0 0 15px 0;
    font-family: 'Creepster', cursive;
    font-size: 2rem; /* 🔧 ALTERADO: Fonte um pouco maior */
    font-weight: normal;
    color: rgba(255, 255, 255, 0.9); /* 🔧 ALTERADO: Cor bem mais forte e visível */
    /* ✨ NOVO: Efeito de brilho vermelho, combinando com o tema */
    text-shadow: 0 0 12px var(--cor-principal);
}

#chat-placeholder p {
    margin: 8px 0;
    font-size: 0.95rem; /* 🔧 ALTERADO: Fonte um pouco maior para ler melhor */
    color: rgba(255, 255, 255, 0.8); /* ✨ NOVO: Cor dedicada para os parágrafos, bem mais clara */
     /* ✨ NOVO: Sombra escura sutil para destacar o texto do fundo */
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
}

#chat-placeholder code {
    background-color: rgba(0,0,0,0.6); /* 🔧 ALTERADO: Fundo um pouco mais escuro */
    padding: 3px 6px;
    border-radius: 4px;
    font-family: monospace;
    color: #ffc107; /* ✨ NOVO: Cor amarelada para destacar os comandos */
    font-weight: bold; /* ✨ NOVO: Deixa o comando em negrito */
}

/* --- FIM: ESTILOS DO PLACEHOLDER DO CHAT --- */
#chat-messages::-webkit-scrollbar { width: 8px; }
#chat-messages::-webkit-scrollbar-track { background: #1a1a1a; }
#chat-messages::-webkit-scrollbar-thumb { background: var(--cor-borda-forte); border-radius: 4px; }
.chat-message { margin-bottom: 12px; line-height: 1.4; word-wrap: break-word; }
.chat-message .name { 
    font-weight: bold; 
    /* color: var(--cor-principal); -- REMOVIDO DAQUI */
    margin-right: 8px; 
}
/* Adicione isso ao seu CSS */
.feedback-popup .form-group input:focus, 
.feedback-popup .form-group textarea:focus,
#chat-form input:focus {
    border-color: var(--cor-principal);
    box-shadow: 0 0 10px rgba(255, 77, 77, 0.5);
}
/* NOVO: Estilo para menções no chat */
.chat-message .mention {
    background-color: var(--cor-principal);
    color: white;
    padding: 2px 5px;
    border-radius: 4px;
    font-weight: bold;
}

#chat-form .form-group {
    display: flex;
    gap: 15px;
}
#chat-form input {
    flex-grow: 1;
    padding: 12px;
    border-radius: 5px;
    border: 1px solid #555;
    background-color: #1a1a1a;
    color: #f0f0f0;
    font-size: 1rem;
    box-sizing: border-box;
}
#chat-form button {
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    background-color: var(--cor-borda-forte);
    color: white;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.3s;
    font-size: 1rem;
}
#chat-form button:hover { background-color: var(--cor-principal); }
        #message-group {
    position: relative;
}

/* NOVO: Estilos para a caixa de sugestões de menção */
.suggestions-box {
    position: absolute;
    bottom: 100%; /* Aparece acima do campo de input */
    left: 0;
    right: 0;
    background-color: #1f1f1f;
    border: 1px solid var(--cor-borda);
    border-bottom: none;
    border-radius: 5px 5px 0 0;
    max-height: 160px;
    overflow-y: auto;
    z-index: 10; /* Garante que fique sobre outros elementos */
    box-shadow: 0 -5px 15px rgba(0,0,0,0.3);
}

.suggestion-item {
    padding: 10px 15px;
    color: var(--cor-texto);
    cursor: pointer;
    border-bottom: 1px solid #333;
    font-size: 0.9rem;
}
.suggestion-item:last-child {
    border-bottom: none;
}
.suggestion-item:hover {
    background-color: var(--cor-borda-forte);
}
/* --- FIM: ESTILOS DO CHAT AO VIVO --- */
        /* ✨ INÍCIO: NOVOS ESTILOS PARA O SELETOR DE EMOJIS ✨ */

/* Posiciona o painel de emojis de forma absoluta */
#emoji-picker {
    position: absolute;
    bottom: 110%; /* Aparece acima do campo de input */
    right: 0;
    width: 300px;
    max-height: 200px;
    overflow-y: auto;
    background-color: #1f1f1f;
    border: 1px solid var(--cor-borda);
    border-radius: 8px;
    box-shadow: 0 -5px 20px rgba(0,0,0,0.4);
    padding: 10px;
    z-index: 15;
    display: grid; /* Organiza os emojis em uma grade */
    grid-template-columns: repeat(auto-fill, minmax(30px, 1fr));
    gap: 5px;
}

/* Estilo para cada emoji dentro do painel */
.emoji-item {
    padding: 5px;
    font-size: 1.5rem;
    text-align: center;
    cursor: pointer;
    border-radius: 5px;
    transition: background-color 0.2s;
}
.emoji-item:hover {
    background-color: var(--cor-borda-forte);
}

/* Estilo do botão que abre o painel de emojis */
#emoji-toggle-btn {
    padding: 0 12px;
    background-color: #2a2a2a;
    border: 1px solid #555;
    border-radius: 5px;
    font-size: 1.2rem;
    cursor: pointer;
    transition: background-color 0.3s;
}
#emoji-toggle-btn:hover {
    background-color: #444;
}
/* Quando o botão está desativado (antes de entrar no chat) */
#emoji-toggle-btn:disabled {
    cursor: not-allowed;
    opacity: 0.5;
}

/* Scrollbar do painel de emojis */
#emoji-picker::-webkit-scrollbar { width: 6px; }
#emoji-picker::-webkit-scrollbar-track { background: #2a2a2a; }
#emoji-picker::-webkit-scrollbar-thumb { background: var(--cor-borda-forte); border-radius: 3px; }

/* --- FIM DOS ESTILOS --- */
        /* NOVO: Estilo para mensagens do sistema no chat */
.chat-system-message {
    color: #a0a0a0;
    font-style: italic;
    text-align: center;
    margin: 8px 0;
    font-size: 0.9em;
}
        /* --- INÍCIO: ESTILOS DE MENSAGENS PRIVADAS --- */

/* Indicador que aparece acima do campo de texto */
#private-message-indicator {
    background-color: rgba(139, 0, 0, 0.3);
    border: 1px solid var(--cor-borda-forte);
    padding: 8px 12px;
    border-radius: 5px;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.9rem;
    animation: fadeIn 0.3s ease;
}

#private-message-indicator span {
    font-style: italic;
}

#private-message-indicator button {
    background: var(--cor-principal);
    color: white;
    border: none;
    border-radius: 4px;
    padding: 4px 8px;
    font-size: 0.8rem;
    cursor: pointer;
    transition: background-color 0.2s;
}

#private-message-indicator button:hover {
    background-color: #ff2d2d;
}

/* Menu que aparece ao clicar no nome de um usuário */
.context-menu {
    position: absolute;
    background-color: #2a2a2a;
    border: 1px solid var(--cor-borda);
    border-radius: 5px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    z-index: 1000;
    padding: 5px;
}

.context-menu-item {
    padding: 8px 15px;
    color: var(--cor-texto);
    cursor: pointer;
    font-size: 0.9rem;
}

.context-menu-item:hover {
    background-color: var(--cor-borda-forte);
}

/* Estilo para o nome clicável */
.chat-message .name {
    cursor: pointer;
    transition: text-shadow 0.2s;
}
.chat-message .name:hover {
    text-shadow: 0 0 5px var(--cor-texto);
}

/* Estilo para a mensagem privada */
.private-message {
    background-color: rgba(112, 12, 12, 0.2);
    border-left: 3px solid #FFC107; /* Amarelo para destacar */
    padding: 10px;
    border-radius: 5px;
}

.private-message .pm-header {
    font-size: 0.8em;
    font-style: italic;
    color: #FFC107;
    margin-bottom: 5px;
}

/* --- FIM: ESTILOS DE MENSAGENS PRIVADAS --- */
      /* --- INÍCIO: Estilos para troca de transmissão --- */
#stream-switcher {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-top: 20px; /* Espaçamento acima dos botões */
}

.stream-btn {
    font-weight: bold;
    text-decoration: none;
    color: var(--cor-texto);
    background-color: var(--cor-cinza-botao); /* Cor padrão */
    padding: 10px 20px;
    border-radius: 5px;
    transition: all 0.3s ease;
    text-transform: uppercase;
    border: 1px solid var(--cor-borda);
    font-size: 0.9rem;
    cursor: pointer;
}

.stream-btn:hover {
    background-color: #555;
    transform: translateY(-2px);
}

/* Estilo do botão ativo (transmissão selecionada) */
.stream-btn.active {
    background-color: var(--cor-principal);
    box-shadow: 0 4px 15px rgba(255, 0, 0, 0.4);
    border-color: var(--cor-principal);
}
/* --- FIM: Estilos para troca de transmissão --- */
        /* --- INÍCIO: Estilos do Placar Atualizado --- */

/* ✨ NOVO: Estilo para o texto de data/hora da atualização */
#last-updated-timestamp {
    color: #4CAF50; /* Um tom de verde */
    font-size: 0.9rem;
    font-style: italic;
    text-align: center;
    margin-top: -15px; /* Puxa para mais perto do título */
    margin-bottom: 25px;
}

/* 🔧 ALTERADO: Força o placar a ter sempre uma coluna, já que agora é uma lista só */
.score-display { 
    grid-template-columns: 1fr; 
}

/* Ajusta a altura mínima para a nova lista única */
#teams-leaderboard {
    min-height: 400px;
}
/* --- FIM: Estilos do Placar Atualizado --- */
        /* ============================================= */
/* ✨ INÍCIO: NOVOS ESTILOS DO GRIMÓRIO FLUTUANTE (COM POSICIONAMENTO CORRIGIDO) ✨ */
/* ================================================================================= */

/* O contêiner que flutua */
#grimorio-container {
    position: fixed;
    /* ✨ VALORES EXATOS RESTAURADOS DO SEU CÓDIGO ORIGINAL PARA PC ✨ */
    bottom: 870px; 
    left: 280px;
    z-index: 1050;
    
    animation: flutuar 3s ease-in-out infinite;
    transition: transform 0.5s ease, filter 0.5s ease;
}

#grimorio-container:hover {
    transform: scale(1.1);
    filter: drop-shadow(0 0 15px var(--cor-principal));
    animation-play-state: paused;
}

/* Estilos para CADA item (livro) dentro do contêiner */
.grimorio-item {
    position: absolute; 
    top: 0;
    left: 0;
    transition: opacity 0.8s ease-in-out;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-decoration: none;
    color: var(--cor-texto);
}

.grimorio-item img {
    width: 80px;
    height: auto;
    margin-bottom: 5px;
}

.grimorio-item span {
    font-family: 'Creepster', cursive;
    font-size: 1.1rem;
    background-color: rgba(10, 10, 10, 0.7);
    padding: 5px 10px;
    border-radius: 5px;
    text-shadow: 0 0 5px black;
    text-align: center;
    width: 150px;
}

/* Classes de controle de visibilidade */
.grimorio-visible {
    opacity: 1;
    pointer-events: auto;
}
.grimorio-hidden {
    opacity: 0;
    pointer-events: none;
}

@keyframes flutuar {
    0% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
    100% { transform: translateY(0px); }
}

@media (max-width: 768px) {
    #grimorio-container {
        /* ✨ VALORES EXATOS RESTAURADOS DO SEU CÓDIGO ORIGINAL PARA MOBILE ✨ */
        bottom: 220px;
        left: 15px;
    }
    .grimorio-item img {
        width: 60px;
    }
    .grimorio-item span {
        font-size: 0.8rem;
        width: 120px;
    }
}
/* --- FIM DOS NOVOS ESTILOS --- */
        footer {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background-color: rgba(255, 255, 255, 0.1); /* Cor de fundo quase transparente */
    backdrop-filter: blur(15px); /* Efeito de vidro */
    border-top: 1px solid rgba(255, 255, 255, 0.2); /* Borda sutil */
    padding: 15px 5%; /* Espaçamento interno */
    z-index: 100; /* Garante que fique acima de outros elementos */
    color: #ddd; /* Cor do texto */
    font-size: 0.8rem;
             box-sizing: border-box; /* Isso resolve o problema da largura */
}

.footer-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: 1400px; /* Mantém a largura consistente com o main */
    margin: 0 auto;
}

.footer-links a, .footer-links button {
    color: #ccc;
    text-decoration: none;
    margin-left: 15px;
    transition: color 0.3s ease;
    background: none;
    border: none;
    cursor: pointer;
    font-size: 0.9rem;
}

.footer-links a:hover, .footer-links button:hover {
    color: var(--cor-principal);
}

.footer-links button {
    padding: 0; /* Remove padding padrão do botão */
}

/* Estilo para telas menores */
@media (max-width: 768px) {
    .footer-content {
        flex-direction: column;
        text-align: center;
    }
    .footer-links {
        margin-top: 10px;
    }
    .footer-links a, .footer-links button {
        margin: 0 10px;
    }
}
        /* SUBSTITUA TODO O CSS DO SEU RODAPÉ POR ESTE BLOCO */

footer {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background-color: rgba(15, 15, 15, 0.2); /* Um pouco mais escuro para contraste */
    backdrop-filter: blur(15px);
    border-top: 1px solid rgba(255, 255, 255, 0.2);
    padding: 10px 5%; /* Diminuí um pouco a altura */
    z-index: 100;
    box-sizing: border-box;
}

.footer-content {
    display: grid; /* Mude de flex para grid */
    grid-template-columns: 1fr auto 1fr; /* Cria 3 colunas: esquerda | centro | direita */
    align-items: center;
    max-width: 1400px;
    margin: 0 auto;
    width: 100%;
    gap: 20px; /* Espaçamento entre as colunas */
}

/* Esquerda: Imagem */
.footer-logo img {
    height: 40px; /* Tamanho da imagem */
    width: auto;
    vertical-align: middle; /* Alinha verticalmente com o texto */
}

/* Centro: Texto de Copyright */
.footer-copyright {
    color: #ccc;
    font-size: 0.9rem;
    margin: 0;
    text-align: center; /* Garante que o texto fique centralizado em sua coluna */
}

/* Direita: Links */
.footer-links {
    display: flex;
    gap: 20px;
    justify-self: end; /* Alinha os links à DIREITA de sua coluna */
}

.footer-links a, .footer-links button {
    color: #ccc;
    text-decoration: none;
    transition: color 0.3s ease;
    background: none;
    border: none;
    cursor: pointer;
    font-size: 0.9rem;
    padding: 0;
    font-family: 'Roboto', sans-serif; /* Garante a mesma fonte */
}

.footer-links a:hover, .footer-links button:hover {
    color: var(--cor-principal);
}

/* Media Query para telas pequenas */
@media (max-width: 850px) {
    .footer-content {
        flex-direction: column;
        gap: 10px;
    }
    .footer-copyright {
        /* Coloca o copyright no topo em telas pequenas */
        order: -1; 
    }
}
        /* =================================================== */
/* --- INÍCIO: ESTILOS PARA DISPOSITIVOS MÓVEIS --- */
/* =================================================== */
/* ================================================================= */
/* --- INÍCIO: ESTILOS PARA DISPOSITIVOS MÓVEIS (VERSÃO CORRIGIDA) --- */
/* ================================================================= */

/* Regras para telas de até 800px de largura */
@media (max-width: 800px) {
    /* Ajustes Gerais */
    main {
        padding: 20px 15px; 
    }
    .section-container {
        padding: 20px;
    }
    header,
    footer {
        position: static;
    }
    footer {
        margin-top: 30px; 
    }

    /* Cabeçalho */
    header {
        flex-direction: column;
        gap: 15px;
    }
    .logo h1 {
        font-size: 2rem;
    }
    
    /* Contador de visitantes e Contagem regressiva */
    #countdown-container,
    #visitor-counter {
        display: flex;
    }
    #countdown-container {
        display: none; /* Mantendo escondido em mobile como no código original */
    }

    /* Rodapé */
    .footer-content {
        grid-template-columns: 1fr;
        justify-items: center;
        gap: 15px;
    }

    /* Seções específicas */
    #regras.section-container {
        padding-left: 0;
        padding-right: 0;
        border-left: none;
        border-right: none;
    }
    #transmissao {
        padding-left: 0;
        padding-right: 0;
        border-left: none;
        border-right: none;
    }
    #transmissao .section-title,
    #transmissao #stream-switcher {
        padding-left: 15px;
        padding-right: 15px;
    }

    /* Títulos e Contagem Regressiva */
    .section-title {
        font-size: 2.2rem;
    }
    .time-value {
        font-size: 1.4rem;
    }
    .time-label {
        font-size: 0.5rem;
    }
    #timer {
        gap: 7px;
    }

    /* Botão de Tela Cheia */
    #custom-fullscreen-btn {
        display: block; 
    }
}

/* Regras para telas de até 768px de largura */
@media (max-width: 768px) {
    #countdown-container {
        display: none !important;
    }
    .grimorio-flutuante {
        bottom: 155px;
        left: 15px;
    }
    /* Estilo de moderador (já estava aqui) */
    .moderator-message {
        background: linear-gradient(90deg, rgba(255, 215, 0, 0.1), rgba(255, 215, 0, 0) 70%);
        border-left: 4px solid #FFD700;
        padding-left: 15px;
        border-radius: 4px;
    }
    .moderator-message .name {
        color: #FFD700;
        text-shadow: 0 0 8px rgba(255, 215, 0, 0.8);
    }
    .moderator-message .name::before {
        content: '🛡️';
        margin-right: 6px;
    }
}

/* Regras para telas de até 480px de largura */
@media (max-width: 480px) {
    /* Seções e Títulos */
    .section-container {
        padding: 20px;
    }
    .section-title {
        font-size: 2rem;
        margin-bottom: 20px;
    }
    .logo h1 {
        font-size: 1.8rem;
    }
    .scoreboard-popup h2,
    .feedback-popup h2 {
        font-size: 2rem;
    }

    /* Cabeçalho */
    header {
        flex-direction: column;
        gap: 15px;
        padding: 15px;
    }
    #visitor-counter {
        margin-top: 0;
        transform: translateX(0);
        order: 3;
    }
    .nav-buttons {
        width: 100%;
        justify-content: center;
    }

    /* Formulários e Botões */
    #chat-form .form-group {
        flex-direction: column;
        gap: 10px;
    }
    #chat-form button {
        width: 100%;
    }
    #stream-switcher {
        flex-direction: column;
        align-items: stretch;
        gap: 10px;
    }
    .feedback-popup .form-row {
        flex-direction: column;
        gap: 0;
    }
    .feedback-popup .form-row .form-group {
        margin-bottom: 20px;
    }

    /* Pop-ups e Placar */
    .scoreboard-popup,
    .feedback-popup {
        padding: 25px 15px;
        width: 95%;
        box-sizing: border-box;
    }
    .leaderboard-list {
        min-height: 250px;
    }
    .scoreboard-fab {
        right: -5px;
        bottom: -90px;
        padding: 8px 15px;
        font-size: 0.9rem;
    }
    .scoreboard-fab img {
        width: 40px;
        height: 40px;
    }

    /* Regras */
    #regras li {
        padding: 15px;
        font-size: 0.9rem;
    }
    #regras li::before {
        margin-right: 10px;
    }

    /* Rodapé */
    .footer-content {
        grid-template-columns: 1fr;
        justify-items: center;
        gap: 15px;
    }
    .footer-logo {
        grid-row: 2;
    }
    .footer-copyright {
        order: 0;
        grid-row: 1;
    }
    .footer-links {
        justify-self: center;
        grid-row: 3;
    }
}


/* --- INÍCIO: ESTILOS DO BOTÃO DE REGRAS (VERSÃO FINAL) --- */

/* 1. O botão volta a ter o estilo de container que você gostava */
.dropdown-toggle {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 15px;
    width: 100%;
    max-width: 90%;
    margin: 0 auto; /* Centraliza o botão */
    
    font-family: 'Creepster', cursive;
    font-size: 1.2rem;
    color: var(--cor-principal);
    text-shadow: 0 0 5px black;
    
    background-color: rgba(10, 10, 10, 0.7);
    border: 2px solid var(--cor-borda-forte);
    border-radius: 8px;
    padding: 8px 16px;
    cursor: pointer;
    transition: all 0.3s ease;
    
    /* Adiciona uma margem inferior para quando a lista estiver fechada */
    margin-bottom: 30px;
}

.dropdown-toggle:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 20px rgba(255, 77, 77, 0.4);
    border-color: var(--cor-principal);
    color: #fff;
    text-shadow: 0 0 10px #fff;
}

.dropdown-icon {
    font-size: 1.5rem;
    transition: transform 0.4s ease;
}

.dropdown-icon.rotated {
    transform: rotate(180deg);
}

/* 2. A LISTA de regras agora tem seu PRÓPRIO fundo */
.rules-list {
    /* Estilos do container aplicados diretamente na lista */
    background-color: var(--cor-fundo-container);
    border: 2px solid var(--cor-borda);
    border-radius: 10px;
    padding: 30px;
    box-shadow: 0 0 25px rgba(0, 0, 0, 0.5);

    /* Animação para aparecer e desaparecer */
    overflow: hidden;
    max-height: 5000px;
    transition: max-height 0.7s ease-in-out, opacity 0.5s ease, margin-top 0.7s ease;
    opacity: 1;
    margin-top: -20px; /* Puxa a lista para perto do botão */
}

/* 3. Esconde a lista de forma suave */
.rules-list.hidden {
    max-height: 0;
    opacity: 0;
    padding-top: 0;
    padding-bottom: 0;
    border-width: 0;
    margin-top: 0;
}

/* 4. Ajustes para PC */
@media (min-width: 769px) {
    .dropdown-toggle {
        max-width: 700px;
        font-size: 2rem;
    }
}

/* --- FIM: ESTILOS DO BOTÃO DE REGRAS --- */
        @media (max-width: 768px) {
    .rules-list {
        padding: 25px 15px; /* Diminui o espaçamento lateral */
    }
}
    </style>
</head>
<body>
    <div id="campeonato-banner" class="hidden">
        <div class="banner-conteudo">
            <div class="banner-icone">🏆</div>
            <div class="banner-texto">
                <h3>A Próxima Caçada Foi Anunciada!</h3>
                <p>A névoa se agita! O próximo torneio será em <strong><span id="banner-data"></span> <span id="banner-horario"></span></strong>. Prepare sua alma!</p>
            </div>
        </div>
        <button id="close-banner-btn" title="Fechar Aviso">×</button>
    </div>
    <header>
        <div class="logo"><h1>Torneio da Entidade</h1></div>
        <div id="visitor-counter">
    <span class="icon">👁️</span>
    <span id="visitor-count">1</span>
    <span class="text"></span>
</div>
        <div id="countdown-container">
    <p class="countdown-title">A Caçada Começa Em...</p>
    <div id="timer">
        <div class="time-block">
            <span id="days" class="time-value">00</span>
            <span class="time-label">Dias</span>
        </div>
        <div class="time-block">
            <span id="hours" class="time-value">00</span>
            <span class="time-label">Horas</span>
        </div>
        <div class="time-block">
            <span id="minutes" class="time-value">00</span>
            <span class="time-label">Minutos</span>
        </div>
        <div class="time-block">
            <span id="seconds" class="time-value">00</span>
            <span class="time-label">Segundos</span>
        </div>
    </div>
    <div id="live-message" class="hidden">A CAÇADA COMEÇOU!</div>
</div>
        <nav class="nav-buttons">
            <a href="inscricao.html" class="btn" id="signup-btn">Inscrever-se</a>
            <button id="open-feedback-btn" class="btn">Feedback</button>
        </nav>
    </header>
     <main>
    <section class="section-container" id="transmissao">
        <h2 class="section-title">Acompanhe Ao Vivo</h2>
        <div id="live-section">
            <div class="video-container">
                <div id="player-wrapper"></div>
                <div id="offline-overlay">
                    <img id="offline-image" src="https://i.imgur.com/OezIOeL.jpeg" alt="Transmissão Offline">
                </div>
                <div id="video-loader" class="hidden">
                    <div class="loader-content">
                        <div class="loader-spinner"></div>
                        <span>CARREGANDO A CAÇADA...</span>
                    </div>
                </div>
                <div id="live-indicator-wrapper" class="hidden"><div class="live-indicator">AO VIVO</div></div>
                <button id="custom-fullscreen-btn" class="hidden" title="Tela Cheia">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M5 5h5v2H7v3H5V5m9 0h5v5h-2V7h-3V5m3 9h2v5h-5v-2h3v-3m-7 3v-2H5v5h5v-3H8z"/>
                    </svg>
                </button>
            </div>
            <div id="stream-switcher">
                <button class="stream-btn active" data-stream="stream1">Transmissão Principal</button>
                <button class="stream-btn" data-stream="stream2">Transmissão 2</button>
                <button class="stream-btn" data-stream="stream3">Transmissão 3</button>
            </div>
        </div>
        <div id="dbd-unmute-popup">
            <p>Deseja ativar o som?</p>
            <div class="popup-buttons">
                <button id="unmute-yes-btn" class="popup-btn">Sim</button>
                <button id="unmute-no-btn" class="popup-btn">Não</button>
            </div>
        </div>
        <div id="scoreboard-fab" class="scoreboard-fab">
            <img src="https://i.postimg.cc/YCSyWS5y/Gemini-Generated-Image-vpc766vpc766vpc7-Photoroom.png" alt="Ícone de Troféu"/>
        </div>
    </section>

    <section class="section-container" id="chat-container">
        <h2 class="section-title">Chat da Entidade</h2>
        <div id="chat-messages">
            <div id="chat-overlay"></div>
            <div id="chat-placeholder">
                <div class="placeholder-icon">💬</div>
                <h4>Bem-vindo ao Chat da Entidade</h4>
                <p>Use <code>/nome SEUNOME</code> para mudar o nome de usuário. Ex: /nome Chris.</p>
                <p>Clique no nome de um usuário para enviar uma DM.</p>
                <p>Digite <code>@</code> para mencionar alguém.</p>
                <p>Clique em uma mensagem para editá-la ou excluí-la.</p>
            </div>
        </div>
        <div id="private-message-indicator" class="hidden">
            <span id="pm-info"></span>
            <button id="exit-pm-btn">Voltar ao Chat Público</button>
        </div>
        <form id="chat-form">
            <div class="form-group" id="name-group">
                <input type="text" id="chat-name" placeholder="Digite seu nome para entrar..." required maxlength="15">
                <button type="button" id="enter-chat-btn">Entrar no Chat</button>
            </div>
            <div class="form-group hidden" id="message-group">
                <div id="emoji-picker" class="hidden"></div>
                <input type="text" id="chat-message" placeholder="Digite sua mensagem..." required disabled maxlength="400">
                <button type="button" id="emoji-toggle-btn" title="Inserir Emoji" disabled>😊</button>
                <button type="submit" disabled>Enviar</button>
                <div id="mention-suggestions" class="suggestions-box hidden"></div>
            </div>
        </form>
    </section>

    <section id="regras">
        <button class="dropdown-toggle" id="rules-toggle-btn">
            <span>Regras do Torneio</span>
            <span class="dropdown-icon">▼</span>
        </button>
        
        <div id="rules-content" class="rules-list hidden">
            <ul>
                <li>1. Cada esquadrão será formado por cinco almas: quatro destinadas à Sobrevivência e uma encarregada da Caçada.</li>
                <li>2. A Entidade não espera. A tolerância para atrasos é de 5 minutos, e o descumprimento implicará em derrota automática (W.O.).</li>
                <li>3. Assim como o julgamento da Entidade, as decisões da organização são absolutas e não estarão sujeitas a apelações, visando a integridade da competição.</li>
                <li>4. Para garantir que a habilidade seja o único reflexo na névoa, a Entidade decreta que quando uma equipe for "espelhar" a escolha de Assassino da equipe adversária, ela também deverá espelhar o mapa onde a caçada anterior ocorreu.</li>
                <li>5. Assassinos capazes de um abate instantâneo devem honrar a caçada, sendo proibida a prática de 'camperar'. A exceção se aplica unicamente ao Ghost Face.</li>
                <li>6. Para manter o equilíbrio dos reinos, a Entidade decreta que, dentre as vantagens "Ressonância, Impasse, Intervenção e Sem Saída" o Assassino pode equipar no máximo DUAS (2) por partida.</li>
                <li>7. A forma pura do mal (Michael Myers) está proibido de carregar os fragmentos de lápide ou o acessório Lápide de Judith. Sua fúria deve ser demonstrada no gancho, não em uma aniquilação instantânea que ignora o ritual da Entidade.</li>
                <li>8. A Entidade despreza o poder que não é conquistado pelo mérito, então o uso da perk "Ninguém Escapa da Morte (NOED)" é estritamente proibido. A caçada deve ser vencida pela pressão constante, não por uma fúria desesperada e artificial no final do ritual.</li>
                <li>9. O reino da Entidade exige respeito. Atos de desrespeito ou preconceito (verbal ou escrito) serão punidos com a expulsão sumária de toda a equipe do torneio.</li>
                <li>10. A agonia no chão tem seus limites. Um Assassino com duas presas caídas deve completar o ritual do gancho com uma delas antes de voltar seu foco para os demais.</li>
                <li>11. Para selar o destino da última esperança, cada partida deve ser iniciada com uma oferenda que conjure a Escotilha no Santuário do Assassino ou no prédio principal.</li>
                <li>12. A engenhosidade é a chave. Os quatro Sobreviventes devem adentrar a partida com itens únicos, sendo proibida a repetição de arsenal entre os membros da equipe.</li>
                <li>13. Entre as poderosas vantagens "Adrenalina, Inquebrável, Extraoficialmente, Duro na Queda e Ataque Decisivo", a equipe de Sobreviventes pode equipar apenas UMA (1) no total entre os quatro jogadores na mesma partida.</li>
                <li>14. As leis da realidade, mesmo neste reino, não devem ser quebradas. É estritamente proibido o uso de qualquer bug, glitch ou exploit conhecido que conceda uma vantagem injusta. A descoberta de tal ato levará à desclassificação imediata.</li>
                <li>15. Em caso de almas perdidas na névoa por desconexão de um jogador (Somente se não houver começado uma perseguição qualquer), a partida deverá ser reiniciada. Se já houver perseguição em andamento, a partida continua normalmente, e a equipe desfalcada deverá lutar com as almas que restaram.</li>
                <li>16. A desobediência à entidade tem um preço. A equipe ou Assassino infrator perderá o favor da Entidade, sofrendo com a subtração parcial ou total dos pontos e até mesmo com a desclassificação.</li>
            </ul>
        </div>
    </section>
         <div id="grimorio-container">
    <a href="niveis.html" id="grimorio-killers" class="grimorio-item grimorio-visible">
        <img src="https://i.imgur.com/KhwS5jZ.gif" alt="Grimório dos Killers">
        <span>Grimório dos Killers</span>
    </a>
    <a href="recompensas.html" id="grimorio-recompensas" class="grimorio-item grimorio-hidden">
        <img src="https://i.imgur.com/p53OZAS.gif" alt="Livro das Recompensas">
        <span>Livro dos Rewards</span>
    </a>
</div>
</main>

   <div id="scoreboard-overlay" class="popup-overlay align-top">
    <div class="scoreboard-popup">
        <button id="close-scoreboard-btn" class="close-btn">×</button>
        <h2>Placar do Torneio</h2>
        
        <p id="last-updated-timestamp"></p>

        <div class="score-display">
            <div class="score-card">
                <h3><img src="https://i.postimg.cc/YCSyWS5y/Gemini-Generated-Image-vpc766vpc766vpc7-Photoroom.png" alt="Ícone Troféu"> Placar das Equipes</h3>
                <ol id="teams-leaderboard" class="leaderboard-list"></ol>
            </div>
        </div>
    </div>
</div>
    
    <div id="feedback-popup-overlay" class="popup-overlay align-top">
        <div class="feedback-popup">
            <button id="close-feedback-btn" class="close-btn">×</button>
            <div id="feedback-form-content">
                <h2>Sua Opinião Importa</h2>
                <form id="feedback-form" action="https://formspree.io/f/xpwrwpzo" method="POST">
                    <div class="form-row">
                        <div class="form-group"><label for="feedback-name">Seu Nome</label><input type="text" id="feedback-name" name="name" required></div>
                        <div class="form-group"><label for="feedback-email">Seu Email</label><input type="email" id="feedback-email" name="email" required></div>
                    </div>
                    <div class="form-group"><label for="feedback-message">Sua Mensagem</label><textarea id="feedback-message" name="message" required></textarea></div>
                    <button type="submit" class="submit-feedback">Enviar Feedback</button>
                </form>
            </div>
            <div id="feedback-success-content" class="feedback-success hidden">
                <div class="icon">✔</div><h3>Enviado!</h3><p>Obrigado pelo seu feedback.</p>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    
    <script>
    // --- COLE AQUI A CONFIGURAÇÃO DO FIREBASE ---
    const firebaseConfig = {
  apiKey: "AIzaSyAyyhIT7nE7gGngadaAuBwhqlw8FER4Ogo",
  authDomain: "torneiodbd.firebaseapp.com",
  projectId: "torneiodbd",
  storageBucket: "torneiodbd.firebasestorage.app",
  messagingSenderId: "253724939016",
  appId: "1:253724939016:web:030515bc99b6c0d3ab52bd"
    };
    // --- FIM DA CONFIGURAÇÃO ---

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const isLiveNow = true; // MUDE PARA false QUANDO NÃO HOUVER LIVE
function generateUUID() {
        return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>
            (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
        );
    }
    let deviceId = localStorage.getItem('chatDeviceId');
    if (!deviceId) {
        deviceId = generateUUID();
        localStorage.setItem('chatDeviceId', deviceId);
    }
   // ✨ NOVO: Objeto para armazenar os IDs das suas 3 transmissões
const STREAM_IDS = {
    stream1: 'ID_DA_LIVE_1', // SUBSTITUA PELO ID REAL DA SUA LIVE PRINCIPAL
    stream2: 'ID_DA_LIVE_2', // SUBSTITUA PELO ID REAL DA LIVE 2
    stream3: 'ID_DA_LIVE_3'  // SUBSTITUA PELO ID REAL DA LIVE 3
};

let player;
let currentStreamKey = 'stream1'; // Define a transmissão padrão que será carregada primeiro

window.onYouTubeIframeAPIReady = function() {
    // Se a variável isLiveNow for true...
    if (isLiveNow) {
        // ...mostra a nossa animação de carregamento...
        //document.getElementById('video-loader').classList.remove('hidden');

        // ...e então cria o player do YouTube.
        player = new YT.Player('player-wrapper', {
            videoId: STREAM_IDS[currentStreamKey], // Carrega a live padrão
            playerVars: { 'autoplay': 1, 'mute': 1, 'playsinline': 1, 'controls': 1 },
            events: { 'onStateChange': onPlayerStateChange }
        });
    }
    // Se isLiveNow for false, nada acontece, e a imagem offline continua visível por padrão.
};
    document.addEventListener('DOMContentLoaded', function() {
        // --- INÍCIO: LÓGICA DO POP-UP DE MEMBROS DA EQUIPE ---

// Referências aos elementos do pop-up
const teamInfoOverlay = document.getElementById('team-info-overlay');
const teamInfoPopup = document.getElementById('team-info-popup');
const closeTeamInfoBtn = document.getElementById('close-team-info-btn');
const teamInfoName = document.getElementById('team-info-name');
const teamInfoMembersList = document.getElementById('team-info-members-list');

// O placar é dinâmico, então usamos delegação de evento
const placarListaEquipes = document.getElementById('teams-leaderboard');

placarListaEquipes.addEventListener('click', (e) => {
    if (e.target.classList.contains('name')) {
        const teamId = e.target.dataset.teamId;
        if (teamId) {
            teamsRef.child(teamId).once('value', (snapshot) => {
                const teamData = snapshot.val();
                
                if (teamData && teamData.members) {
                    teamInfoName.textContent = teamData.name;
                    teamInfoMembersList.innerHTML = '';

                    const killerName = teamData.members.killer;
                    const captainName = teamData.members.capitao;
                    
                    // Cria uma lista com todos os nomes de jogadores, sem repetição
                    const todosOsMembros = new Set();
                    if (captainName) todosOsMembros.add(captainName);
                    if (killerName) todosOsMembros.add(killerName); // Garante que o killer esteja na lista
                    for (let i = 1; i <= 4; i++) {
                        const memberName = teamData.members[`membro${i}`];
                        if (memberName) todosOsMembros.add(memberName);
                    }

                    // Agora, cria o elemento <li> para cada membro da lista
                    todosOsMembros.forEach(nomeDoMembro => {
                        const li = document.createElement('li');
                        li.textContent = nomeDoMembro;

                        // Aplica o estilo de Capitão se o nome corresponder
                        if (nomeDoMembro === captainName) {
                            li.classList.add('captain-member');
                        }
                        // Aplica o estilo de Killer se o nome corresponder
                        if (nomeDoMembro === killerName) {
                            li.classList.add('killer-member');
                        }
                        teamInfoMembersList.appendChild(li);
                    });
                    
                    teamInfoOverlay.classList.add('active');
                } else {
                    alert('Informações dos membros não encontradas para esta equipe.');
                }
            });
        }
    }
});

// Funções para fechar o pop-up
function closeTeamInfoPopup() {
    teamInfoOverlay.classList.remove('active');
}

closeTeamInfoBtn.addEventListener('click', closeTeamInfoPopup);
teamInfoOverlay.addEventListener('click', (e) => {
    // Fecha o pop-up se o clique for no fundo escuro
    if (e.target === teamInfoOverlay) {
        closeTeamInfoPopup();
    }
});

// --- FIM: LÓGICA DO POP-UP ---
// --- INÍCIO: LÓGICA FINAL DO BANNER (BASEADA NA LÓGICA DO PLACAR) ---

// Seleciona os elementos do banner na página
const campeonatoBanner = document.getElementById('campeonato-banner');
const bannerData = document.getElementById('banner-data');
const bannerHorario = document.getElementById('banner-horario');
const closeBannerBtn = document.getElementById('close-banner-btn');

// Garante que o código só execute se os elementos existirem
if (campeonatoBanner) {
    
    // O PLACAR LÊ DE 'teams'. O BANNER LERÁ DE 'banner'.
    // Esta é a referência correta, no nível principal do seu banco de dados.
    const bannerRef = database.ref('banner');

    // Fica "escutando" por qualquer alteração no objeto 'banner'
    bannerRef.on('value', (snapshot) => {
        const bannerInfo = snapshot.val();

        // CONDIÇÃO: O objeto 'banner' existe? O campo 'ativo' é true? O campo 'data' existe?
        if (bannerInfo && bannerInfo.ativo === true && bannerInfo.data) {
            
            // Se sim, preenchemos os dados e removemos a classe 'hidden' para MOSTRAR o banner.
            bannerData.textContent = bannerInfo.data;
            bannerHorario.textContent = bannerInfo.horario || ''; // Horário é opcional
            campeonatoBanner.classList.remove('hidden');

        } else {
            
            // Caso contrário, adicionamos a classe 'hidden' para garantir que ele fique ESCONDIDO.
            campeonatoBanner.classList.add('hidden');
        }
    });

    // Adiciona a funcionalidade para o botão de fechar.
    closeBannerBtn.addEventListener('click', () => {
        campeonatoBanner.classList.add('hidden');
    });
}
// --- FIM: LÓGICA FINAL DO BANNER ---
        const fullscreenBtn = document.getElementById('custom-fullscreen-btn');
const videoContainer = document.querySelector('.video-container');
       // ✨ NOVO: Lógica para trocar a transmissão
    const streamSwitcher = document.getElementById('stream-switcher');
    const streamButtons = document.querySelectorAll('.stream-btn');

    streamSwitcher.addEventListener('click', (e) => {
        // Verifica se o clique foi em um botão de stream e não é o ativo
        if (e.target.classList.contains('stream-btn') && !e.target.classList.contains('active')) {
            const newStreamKey = e.target.dataset.stream;

            // Se o player estiver pronto, carrega o novo vídeo
            if (player && typeof player.loadVideoById === 'function') {
                player.loadVideoById(STREAM_IDS[newStreamKey]);
                currentStreamKey = newStreamKey;

                // Atualiza a classe 'active' nos botões
                streamButtons.forEach(btn => {
                    btn.classList.remove('active');
                });
                e.target.classList.add('active');
            }
            }
        });
        
        // --- INÍCIO: LÓGICA DO CHAT AO VIVO (COMANDOS, DMs E MENÇÕES CORRIGIDAS) ---
const MAX_MESSAGE_LENGTH = 400;
const MAX_USERNAME_LENGTH = 15;
const palavrasImproprias = ['idiota', 'idiotas', 'viadinho', 'laskar', 'lascar', 'pôpo', 'popô', 'pôpô', 'popo', 'bumbum', 'bunda', 'dedada', 'lamber', 'linguada', 'boquetinho', 'boquetão', 'boquetao', 'bouquete', 'boquete', 'genital', 'genitalha', 'camaco', 'dotada', 'dotado', 'roludas', 'roludos', 'roluda', 'roludo', 'rola', 'pirocão', 'pirocao', 'pirocudo', 'pirocas', 'piroca', 'neguinhos', 'negrinhos', 'negrinhas', 'neguinha', 'neguinha', 'neguinho', 'nego', 'chifruda', 'chifrudo', 'corninha', 'corninho', 'benga', 'pauzuda', 'pauzudo', 'rodinhas', 'cuzinhos', 'gayzinhos', 'viadinhos', 'putinhas', 'ovinhos', 'ovinho', 'ovão', 'ovao', 'ovos', 'ovo', 'rodinha', 'boguinha', 'boga', 'ânus', 'anus', 'lambido', 'lambi', 'lamber', 'lambe', 'vara', 'negrinha', 'negrinho', 'negra', 'negro', 'peitao', 'peitão', 'peitinho', 'peito', 'peitos', 'chupar', 'chupa', 'viad', 'viadao', 'viadão', 'viadinho', 'mamaco', 'macaquinho', 'linguiça', 'toba', 'pau no cú', 'pau no cu', 'arrombada', 'arrombado', 'piranha', 'gayzinho', 'vadiazinha', 'putinha', 'puta', 'gay', 'travesti', 'traveco', 'bicha', 'bixa', 'macaca', 'macaco', 'vagabunda', 'bilau', 'pal', 'pau', 'chibiu', 'xibiu', 'perereca', 'chota', 'xota', 'vagina', 'buceta', 'pênis', 'penis', 'incesto', 'porno', 'pornô', 'viadinha', 'cuzinho', 'vadio', 'vadia', 'bobo', 'bobos', 'trouxa', 'trouxas', 'babaca', 'babacas', 'otário', 'otaria', 'otários', 'otarias', 'bocó', 'bocós', 'burro', 'burra', 'burros', 'burras', 'imbecil', 'imbecis', 'corno', 'corna', 'cornos', 'cornas', 'vagabundo', 'vagabunda', 'vagabundos', 'vagabundas', 'merda', 'merdas', 'porra', 'porras', 'caralho', 'caralhos', 'filho da puta', 'filha da puta', 'filhos da puta', 'filhas da puta', 'puta', 'putas', 'putaria', 'puto', 'puta que pariu', 'vai tomar no cu', 'vai se foder', 'vai se ferrar', 'vai se lascar', 'se fode', 'se foda', 'se ferra', 'se lasca', 'se ferrou', 'foda-se', 'fodase', 'fodam-se', 'fodido', 'fodida', 'fodidos', 'fodidas', 'fdp', 'pnc', 'vsf', 'vtnc', 'escroto', 'escrota', 'escrotos', 'escrotas', 'cuzão', 'cuzona', 'cuzões', 'cuzao', 'cuzona', 'cu', 'cuzao', 'pau no cu', 'pau no seu cu', 'pau no cú', 'no cu', 'no cú', 'viado', 'veado', 'veados', 'viados', 'boiola', 'boiolas', 'bicha', 'bichas', 'gayzinho', 'lesbica', 'lésbica', 'mongol', 'mongoloide', 'retardado', 'retardada', 'retardados', 'retardadas', 'deficiente', 'aleijado', 'aleijada', 'aleijados', 'aleijadas', 'doente', 'doentes', 'nojento', 'nojenta', 'nojentos', 'nojentas', 'maldito', 'maldita', 'desgraçado', 'desgraçada', 'desgraçados', 'desgraçadas', 'maluco', 'maluca', 'malucos', 'malucas', 'traste', 'lixo', 'lixos', 'fracassado', 'fracassada', 'fracassados', 'fracassadas', 'zé ruela', 'zé buceta', 'zé', 'cracudo', 'cracuda', 'cracudos', 'cracudas', 'maconheiro', 'maconheira', 'maconheiros', 'maconheiras', 'demente', 'tapado', 'tapada', 'jumento', 'jumenta', 'anta', 'jegue', 'burro pra caralho', 'burra pra caralho'];
const chatNameInput = document.getElementById('chat-name');
const enterChatBtn = document.getElementById('enter-chat-btn');
const nameGroup = document.getElementById('name-group');
const chatForm = document.getElementById('chat-form');
const chatMessageInput = document.getElementById('chat-message');
const messageGroup = document.getElementById('message-group');
const chatMessages = document.getElementById('chat-messages');
const chatSubmitButton = messageGroup.querySelector('button[type="submit"]');
const chatPlaceholder = document.getElementById('chat-placeholder');

// Referências para novas funcionalidades
const pmIndicator = document.getElementById('private-message-indicator');
const pmInfo = document.getElementById('pm-info');
const exitPmBtn = document.getElementById('exit-pm-btn');
const suggestionsBox = document.getElementById('mention-suggestions');

// Referências do Firebase
const publicMessagesRef = database.ref('chatMessages');
const privateMessagesRef = database.ref('privateMessages');
const participantsRef = database.ref('participants');
        // COLE ESTAS 5 LINHAS ABAIXO
const moderatorsRef = database.ref('moderators');
let moderatorList = {}; // Guarda a lista de mods

moderatorsRef.on('value', (snapshot) => {
    moderatorList = snapshot.val() || {}; // Atualiza a lista em tempo real
});

// Variáveis de estado
let chatParticipants = new Set();
let currentUser = '';
let privateRecipient = null;
const userColors = {};

function getRandomColor() {
    const hue = Math.floor(Math.random() * 360);
    return `hsl(${hue}, 90%, 70%)`;
}

function escapeHTML(str) {
    const p = document.createElement('p');
    p.textContent = str;
    return p.innerHTML;
}

function displaySystemMessage(text) {
    const messageElement = document.createElement('div');
    messageElement.className = 'chat-system-message';
    messageElement.textContent = text;
    chatMessages.appendChild(messageElement);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}
        // DEPOIS (SUBSTITUA PELA VERSÃO ABAIXO)
function contemPalavraImpropria(texto) {
    if (palavrasImproprias.length === 0) return false;

    // Converte o texto do usuário para minúsculas e divide em "palavras"
    // Isso lida com espaços e pontuações de forma mais eficaz
    const palavrasDoTexto = texto.toLowerCase().split(/[\s,\.;:\-_!?()]+/);

    // Verifica se ALGUMA das palavras do texto está na lista de palavras impróprias
    return palavrasDoTexto.some(palavra => palavrasImproprias.includes(palavra));
}

// ✨ SUBSTITUA PELO BLOCO CORRIGIDO ABAIXO ✨

function activateChat(name) {
    currentUser = name;
    chatNameInput.value = name;
    nameGroup.classList.add('hidden');

    const chatPlaceholder = document.getElementById('chat-placeholder');
    if (chatPlaceholder) {
        chatPlaceholder.classList.add('hidden');
        chatMessages.classList.remove('placeholder-active');
    }

    messageGroup.classList.remove('hidden');
    chatMessageInput.disabled = false;
    chatSubmitButton.disabled = false;
    document.getElementById('emoji-toggle-btn').disabled = false;
    chatMessageInput.focus();

    // ALTERADO: Agora salvamos o ID do dispositivo junto com o nome
    const participantRef = participantsRef.child(name);
    participantRef.set({ deviceId: deviceId, online: true });
    participantRef.onDisconnect().remove();

    listenForPrivateMessages(currentUser);
}

// Lógica de Entrada no Chat (COM VERIFICAÇÃO DE BAN)
const savedName = localStorage.getItem('dbdChatName');
if (savedName) {
    activateChat(savedName);
} else {
    if (chatPlaceholder) chatPlaceholder.classList.remove('hidden');
    chatMessages.classList.add('placeholder-active');
}

// Função para bloquear o chat (reutilizável)
function bloquearChatPorBanimento() {
    alert('Este dispositivo foi banido do chat e não pode mais participar.');
    const chatNameInput = document.getElementById('chat-name');
    const enterChatBtn = document.getElementById('enter-chat-btn');
    const chatMessageInput = document.getElementById('chat-message');
    const chatSubmitButton = document.querySelector('#message-group button[type="submit"]');
    
    if (chatNameInput) chatNameInput.disabled = true;
    if (enterChatBtn) {
        enterChatBtn.disabled = true;
        enterChatBtn.textContent = 'BANIDO';
    }
    if (chatMessageInput) {
        chatMessageInput.disabled = true;
        chatMessageInput.placeholder = 'Você foi banido.';
    }
    if (chatSubmitButton) chatSubmitButton.disabled = true;
}

// "Vigilante" em tempo real que escuta por banimentos
const dispositivoBanidoRef = database.ref('dispositivosBanidos').child(deviceId);
dispositivoBanidoRef.on('value', (snapshot) => {
    if (snapshot.exists()) {
        bloquearChatPorBanimento();
    }
});

// Lógica de entrada no chat simplificada
enterChatBtn.addEventListener('click', () => {
    const name = chatNameInput.value.trim();
    if (!name) return;

    if (contemPalavraImpropria(name)) {
        alert('Este nome de usuário não é permitido. Por favor, escolha outro.');
        return;
    }
    if (name.length > MAX_USERNAME_LENGTH) {
        alert(`O nome de usuário é muito longo! O limite é de ${MAX_USERNAME_LENGTH} caracteres.`);
        return;
    }
    if (chatParticipants.has(name)) {
        alert(`O nome "${name}" já está em uso.`);
        return;
    }

    localStorage.setItem('dbdChatName', name);
    activateChat(name);
});

participantsRef.on('child_added', snapshot => chatParticipants.add(snapshot.key));
participantsRef.on('child_removed', snapshot => chatParticipants.delete(snapshot.key));

// Lógica de Envio de Mensagem (com tratamento de comandos)
chatForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const message = chatMessageInput.value.trim();
    if (!currentUser || !message) return;

    if (contemPalavraImpropria(message)) {
        alert('Sua mensagem contém termos não permitidos e não será enviada.');
        chatMessageInput.value = ''; // Limpa o campo
        return;
    }
    if (message.length > MAX_MESSAGE_LENGTH) {
        alert(`Sua mensagem é muito longa! O limite é de ${MAX_MESSAGE_LENGTH} caracteres.`);
        return; // Impede o envio da mensagem
    }

    if (message.startsWith('/')) {
        handleCommand(message);
        chatMessageInput.value = '';
        return;
    }

    if (privateRecipient) {
        const conversationId = [currentUser, privateRecipient].sort().join('_');
        privateMessagesRef.child(conversationId).push({
            from: currentUser, to: privateRecipient, message,
            timestamp: firebase.database.ServerValue.TIMESTAMP
        });
    } else {
    publicMessagesRef.push({
        name: currentUser,
        message,
        timestamp: firebase.database.ServerValue.TIMESTAMP,
        watchingStream: isLiveNow ? currentStreamKey : 'offline',
        senderDeviceId: deviceId // <-- ESTA É A LINHA ADICIONADA
    });
}
    chatMessageInput.value = '';
});

// --- FUNÇÃO PARA PROCESSAR COMANDOS ---
function handleCommand(message) {
    const parts = message.split(' ');
    const command = parts[0];
    const args = parts.slice(1);

    if (command === '/limparagora') {
        if (confirm('Tem certeza que deseja apagar TODAS as mensagens do chat público?')) {
            publicMessagesRef.remove();
            privateMessagesRef.remove();
        }
    } else if (command === '/nome') {
        const newName = args.join(' ').trim();
        const oldName = currentUser;

        if (!newName) {
            displaySystemMessage('Uso: /nome <seu_novo_nome>');
        } else if (chatParticipants.has(newName)) {
            displaySystemMessage(`O nome "${newName}" já está em uso.`);
        } else {
            participantsRef.child(oldName).remove();
            const newParticipantRef = participantsRef.child(newName);
            newParticipantRef.set(true);
            newParticipantRef.onDisconnect().remove();

            currentUser = newName;
            localStorage.setItem('dbdChatName', newName);

            displaySystemMessage(`Seu nome foi alterado de "${oldName}" para "${newName}"`);
        }
    } else {
        displaySystemMessage(`Comando "${command}" não reconhecido.`);
    }
}

// 🔧 ALTERADO: Lógica para RENDERIZAR mensagens públicas
publicMessagesRef.limitToLast(100).on('child_added', (snapshot) => {
    const msg = snapshot.val();
    const messageKey = snapshot.key; // Pega a chave única da mensagem
    if (!msg || !msg.name || !msg.message || msg.to) return;
    displayPublicMessage(msg, messageKey); // Passa a chave para a função de exibição
});

// Escuta por mensagens alteradas (editadas ou apagadas)
publicMessagesRef.limitToLast(100).on('child_changed', (snapshot) => {
    const msg = snapshot.val();
    const messageKey = snapshot.key;
    const messageElement = document.querySelector(`[data-message-id="${messageKey}"]`);

    if (messageElement) {
        const textSpan = messageElement.querySelector('.text');
        const editedIndicator = messageElement.querySelector('.edited-indicator');

        // Atualiza o texto da mensagem
        textSpan.innerHTML = escapeHTML(msg.message).replace(/@([\wÀ-ú]+)/g, '<span class="mention">@$1</span>');

        // Adiciona ou confirma o indicador "(editado)"
        if (msg.isEdited && !editedIndicator) {
            const indicator = document.createElement('span');
            indicator.className = 'edited-indicator';
            indicator.textContent = '(editado)';
            messageElement.appendChild(indicator);
        }

        // Se a mensagem foi "apagada" (texto substituído)
        if (msg.isDeleted) {
             textSpan.style.color = '#888';
             textSpan.style.fontStyle = 'italic';
             messageElement.style.pointerEvents = 'none'; // Impede novos cliques
        }
    }
});

// 🔧 ALTERADO: Função para exibir a mensagem pública
function displayPublicMessage(msg, messageKey) { // Recebe a chave da mensagem
    const messageElement = document.createElement('div');
    messageElement.classList.add('chat-message');

    // ✨ NOVO: Adiciona atributos de dados para identificar a mensagem
    messageElement.dataset.messageId = messageKey;
    if(msg.timestamp) messageElement.dataset.timestamp = msg.timestamp;
    if(msg.senderDeviceId) messageElement.dataset.senderDeviceId = msg.senderDeviceId;

    // Adiciona a classe de moderador
    if (moderatorList[msg.name]) {
        messageElement.classList.add('moderator-message');
    }

    if (msg.watchingStream) {
        const streamIndicator = document.createElement('span');
        streamIndicator.className = 'watching-indicator';
        streamIndicator.textContent = msg.watchingStream === 'offline' ? 'Sem live ativa' : `Na tela ${msg.watchingStream.slice(-1)}`;
        messageElement.appendChild(streamIndicator);
    }

    if (!userColors[msg.name]) userColors[msg.name] = getRandomColor();
    const nameSpan = document.createElement('span');
    nameSpan.className = 'name';
    nameSpan.textContent = msg.name + ':';
    nameSpan.style.color = userColors[msg.name];
    nameSpan.dataset.username = msg.name;
    messageElement.appendChild(nameSpan);

    const messageSpan = document.createElement('span');
    messageSpan.className = 'text';

    // ✨ NOVO: Verifica se a mensagem foi "apagada"
    if (msg.isDeleted) {
        messageSpan.textContent = msg.message;
        messageSpan.style.color = '#888';
        messageSpan.style.fontStyle = 'italic';
        messageElement.style.pointerEvents = 'none'; // Impede cliques em mensagens apagadas
    } else {
        messageSpan.innerHTML = escapeHTML(msg.message).replace(/@([\wÀ-ú]+)/g, '<span class="mention">@$1</span>');
    }
    messageElement.appendChild(messageSpan);

    // ✨ NOVO: Adiciona o indicador "(editado)" se necessário
    if (msg.isEdited) {
        const indicator = document.createElement('span');
        indicator.className = 'edited-indicator';
        indicator.textContent = '(editado)';
        messageElement.appendChild(indicator);
    }

    chatMessages.appendChild(messageElement);

    if (!chatMessages.classList.contains('placeholder-active')) {
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }
}
// Lógica para RENDERIZAR mensagens privadas
function displayPrivateMessage(msg) {
    const isSender = msg.from === currentUser;
    const otherPerson = isSender ? msg.to : msg.from;
    const messageElement = document.createElement('div');
    messageElement.classList.add('chat-message', 'private-message');
    const header = document.createElement('div');
    header.className = 'pm-header';
    header.textContent = isSender ? `Sussurro para ${otherPerson}:` : `Sussurro de ${otherPerson}:`;
    messageElement.appendChild(header);
    const messageSpan = document.createElement('span');
    messageSpan.className = 'text';
    messageSpan.textContent = msg.message;
    messageElement.appendChild(messageSpan);
    chatMessages.appendChild(messageElement);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

// Lógica para "ESCUTAR" por mensagens privadas
function listenForPrivateMessages(username) {
    const conversationIds = new Set();
    const setupListener = (otherUser) => {
        if (otherUser === username) return;
        const conversationId = [username, otherUser].sort().join('_');
        if (conversationIds.has(conversationId)) return;
        conversationIds.add(conversationId);
        privateMessagesRef.child(conversationId).on('child_added', (msgSnapshot) => {
            const msg = msgSnapshot.val();
            if (msg && (msg.to === username || msg.from === username)) {
                displayPrivateMessage(msg);
            }
        });
    };
    participantsRef.on('child_added', (snapshot) => setupListener(snapshot.key));
}

// Lógica do MENU DE CONTEXTO e SUGESTÕES DE MENÇÃO
document.body.addEventListener('click', (e) => {
    const existingMenu = document.querySelector('.context-menu');
    if (existingMenu) existingMenu.remove();
    hideSuggestions();

    if (e.target.classList.contains('name')) {
        const username = e.target.dataset.username;
        if (username && username !== currentUser) {
            e.preventDefault();
            createContextMenu(username, e.pageX, e.pageY);
        }
    }
});

function createContextMenu(username, x, y) {
    const menu = document.createElement('div');
    menu.className = 'context-menu';
    menu.style.left = `${x}px`;
    menu.style.top = `${y}px`;
    const pmItem = document.createElement('div');
    pmItem.className = 'context-menu-item';
    pmItem.textContent = `Mensagem Privada`;
    pmItem.onclick = () => { enterPrivateMode(username); menu.remove(); };
    menu.appendChild(pmItem);
    document.body.appendChild(menu);
}

// Funções para GERENCIAR o modo de conversa
function enterPrivateMode(username) {
    privateRecipient = username;
    pmInfo.textContent = `Sussurrando para ${username}...`;
    pmIndicator.classList.remove('hidden');
    chatMessageInput.placeholder = `Mensagem privada para ${username}...`;
    chatMessageInput.focus();
}

function exitPrivateMode() {
    privateRecipient = null;
    pmIndicator.classList.add('hidden');
    chatMessageInput.placeholder = 'Digite sua mensagem...';
    chatMessageInput.focus();
}
exitPmBtn.addEventListener('click', exitPrivateMode);

// --- LÓGICA DAS SUGESTÕES DE MENÇÃO (CORRIGIDA) ---
chatMessageInput.addEventListener('input', () => {
    const text = chatMessageInput.value;
    const cursorPos = chatMessageInput.selectionStart;

    // Verifica se o cursor está logo após um @
    if (text.substring(cursorPos - 1, cursorPos) === '@' && (text.length === 1 || text.substring(cursorPos - 2, cursorPos - 1) === ' ')) {
        const suggestions = [...chatParticipants].filter(name => name !== currentUser);
        if (suggestions.length > 0) showSuggestions(suggestions, cursorPos - 1);
        else hideSuggestions();
        return;
    }

    // Lógica para filtrar nomes
    const textBeforeCursor = text.substring(0, cursorPos);
    const lastAtIndex = textBeforeCursor.lastIndexOf('@');
    const lastSpaceIndex = textBeforeCursor.lastIndexOf(' ');

    if (lastAtIndex > lastSpaceIndex) {
        const searchTerm = textBeforeCursor.substring(lastAtIndex + 1).toLowerCase();
        const suggestions = [...chatParticipants].filter(name =>
            name.toLowerCase().startsWith(searchTerm) && name !== currentUser
        );
        if (suggestions.length > 0) showSuggestions(suggestions, lastAtIndex);
        else hideSuggestions();
    } else {
        hideSuggestions();
    }
});

function showSuggestions(suggestions, atIndex) {
    suggestionsBox.innerHTML = '';
    suggestions.forEach(name => {
        const item = document.createElement('div');
        item.className = 'suggestion-item';
        item.textContent = name;
        item.addEventListener('mousedown', (e) => {
            e.preventDefault();
            const text = chatMessageInput.value;
            const before = text.substring(0, atIndex);
            const after = text.substring(chatMessageInput.selectionStart);
            chatMessageInput.value = `${before}@${name} ${after}`;
            hideSuggestions();
            chatMessageInput.focus();
        });
        suggestionsBox.appendChild(item);
    });
    suggestionsBox.classList.remove('hidden');
}

function hideSuggestions() {
    if (!suggestionsBox.classList.contains('hidden')) {
        suggestionsBox.classList.add('hidden');
    }
}

// Limpeza geral do chat público
publicMessagesRef.on('value', (snapshot) => {
    if (!snapshot.exists() && chatMessages) {
        chatMessages.innerHTML = ''; // Limpa completamente o chat
        const name = localStorage.getItem('dbdChatName');

        // SÓ recria o placeholder se o usuário NÃO tiver um nome salvo
        if (!name) { 
            const placeholder = document.createElement('div');
            placeholder.id = 'chat-placeholder';
            placeholder.innerHTML = `<div class="placeholder-icon">💬</div>
                <h4>Bem-vindo ao Chat da Entidade</h4>
                <p>Use <code>/nome SEUNOME</code> para mudar o nome de usuário. Ex: /nome Chris.</p>
                <p>Clique sobre o nome de um usuário para enviar uma DM.</p>
                <p>Digite <code>@</code> para mencionar alguém.</p>
                <p>Clique em uma mensagem para editá-la ou excluí-la.</p>`;
            chatMessages.appendChild(placeholder);
        }
    }
});
        // ✨ INÍCIO: LÓGICA PARA EDITAR E APAGAR MENSAGENS ✨

const TIME_LIMIT_MS = 15 * 60 * 1000; // 15 minutos em milissegundos

// Usamos delegação de evento no container de mensagens para performance
chatMessages.addEventListener('click', (e) => {
    // Remove qualquer menu anterior que possa estar aberto
    const existingMenu = document.querySelector('.message-options-menu');
    if (existingMenu) existingMenu.remove();

    const messageElement = e.target.closest('.chat-message');
    if (!messageElement) return; // Se o clique não foi em uma mensagem, sai

    // Pega as informações que guardamos nos data-attributes
    const messageId = messageElement.dataset.messageId;
    const senderId = messageElement.dataset.senderDeviceId;
    const timestamp = parseInt(messageElement.dataset.timestamp, 10);
    const messageText = messageElement.querySelector('.text').textContent;

    // CONDIÇÕES PARA MOSTRAR O MENU:
    // 1. O remetente da msg é o usuário atual?
    // 2. A mensagem tem um timestamp válido?
    // 3. O tempo decorrido é menor que 15 minutos?
    if (senderId === deviceId && timestamp && (Date.now() - timestamp < TIME_LIMIT_MS)) {
        createMessageOptionsMenu(e.pageX, e.pageY, messageId, messageText);
    }
});

function createMessageOptionsMenu(x, y, messageId, currentText) {
    const menu = document.createElement('div');
    menu.className = 'message-options-menu';
    // Ajusta a posição para não sair da tela
    menu.style.left = `${Math.min(x, window.innerWidth - 150)}px`; 
    menu.style.top = `${y}px`;

    // Opção de Editar
    const editItem = document.createElement('div');
    editItem.className = 'options-menu-item';
    editItem.textContent = 'Editar';
    editItem.onclick = () => {
        const newText = prompt('Edite sua mensagem:', currentText);
        // Se o usuário não clicou em "cancelar" e o texto não está vazio
        if (newText !== null && newText.trim() !== '') {
            publicMessagesRef.child(messageId).update({
                message: newText.trim(),
                isEdited: true
            });
        }
        menu.remove();
    };

    // Opção de Apagar
    const deleteItem = document.createElement('div');
    deleteItem.className = 'options-menu-item delete';
    deleteItem.textContent = 'Apagar para todos';
    deleteItem.onclick = () => {
        if (confirm('Tem certeza de que deseja apagar esta mensagem para todos?')) {
            // Em vez de remover, substituímos o conteúdo. Fica mais limpo.
            publicMessagesRef.child(messageId).update({
                message: 'Mensagem apagada pelo autor.',
                isDeleted: true
            });
        }
        menu.remove();
    };

    menu.appendChild(editItem);
    menu.appendChild(deleteItem);
    document.body.appendChild(menu);

    // Garante que o menu seja removido se o usuário clicar fora dele
    setTimeout(() => {
        document.body.addEventListener('click', () => menu.remove(), { once: true });
    }, 0);
}

// ✨ FIM: LÓGICA PARA EDITAR E APAGAR MENSAGENS ✨
// --- FIM: LÓGICA DO CHAT AO VIVO ---
        // ✨ INÍCIO: LÓGICA DO SELETOR DE EMOJIS ✨
const emojiBtn = document.getElementById('emoji-toggle-btn');
const emojiPicker = document.getElementById('emoji-picker');

// Lista de emojis que aparecerão no painel
const emojis = [
    // Carinhas e Reações
    '😀', '😃', '😄', '😁', '😆', '😅', '🤣', '😂', '🙂', '🙃', '🫠', '😉', '😊', '😇', '🥰', '😍', '🤩', '😘',
    '😗', '☺️', '😚', '😙', '🥲', '😋', '😛', '😜', '🤪', '😝', '🤑', '🤗', '🤭', '🫢', '🫣', '🤫', '🤔',
    '🫡', '🤐', '🤨', '😐', '😑', '😶', '🫥', '😶‍🌫️', '😏', '😒', '🙄', '😬', '😮‍💨', '🤥', '🫨', '🙂‍↔️',
    '🙂‍↕️', '😌', '😔', '😪', '🤤', '😴', '😷', '🤒', '🤕', '🤢', '🤮', '🤧', '🥵', '🥶', '🥴', '😵', '😵‍💫',
    '🤯', '🤠', '🥳', '🥸', '😎', '🤓', '🧐', '😕', '🫤', '😟', '🙁', '☹️', '😮', '😯', '😲', '😳', '🥺',
    '🥹', '😦', '😧', '😨', '😰', '😥', '😢', '😭', '😱', '😖', '😣', '😞', '😓', '😩', '😫', '🥱', '😤',
    '😡', '😠', '🤬', '😈', '👿', '💀', '☠️', '💩', '🤡', '👹', '👺', '👻', '👽', '👾', '🤖', '😺', '😸',
    '😹', '😻', '😼', '😽', '🙀', '😿', '😾', '🙈', '🙉', '🙊', '👋', '🤚', '🖐️', '✋', '🖖', '🫱', '🫲',
    '🫳', '🫴', '🫷', '🫸', '👌', '🤌', '🤏', '✌️', '🤞', '🫰', '🤟', '🤘', '🤙', '👈', '👉', '👆', '🖕',
    '👇', '☝️', '🫵', '👍', '👎', '✊', '👊', '🤛', '🤜', '👏', '🙌', '🫶', '👐', '🤲', '🤝', '🙏', '✍️',
    '💅', '🤳', '💪', '🦾', '🦿', '🦵', '🦶', '👂', '🦻', '👃', '🙋‍♂️', '🙋‍♀️', '❤️', '🩷', '🧡', '💛', '💚',
    '💙', '🩵', '💜', '🤎', '🖤', '🩶', '🤍', '🎖️', '🏆', '🏅', '🥇', '🥈', '🥉'
];

// Função que cria os emojis e os adiciona ao painel
function populateEmojiPicker() {
    emojis.forEach(emoji => {
        const emojiEl = document.createElement('span');
        emojiEl.className = 'emoji-item';
        emojiEl.textContent = emoji;
        emojiEl.addEventListener('click', () => {
            // Insere o emoji na posição atual do cursor no campo de texto
            const start = chatMessageInput.selectionStart;
            const end = chatMessageInput.selectionEnd;
            const text = chatMessageInput.value;
            chatMessageInput.value = text.substring(0, start) + emoji + text.substring(end);
            chatMessageInput.focus();
            // Move o cursor para depois do emoji inserido
            chatMessageInput.selectionEnd = start + emoji.length;
        });
        emojiPicker.appendChild(emojiEl);
    });
}
populateEmojiPicker(); // Chama a função para criar os emojis assim que a página carrega

// Evento para mostrar/esconder o painel de emojis
emojiBtn.addEventListener('click', (event) => {
    event.stopPropagation(); // Impede que o clique feche o painel imediatamente
    emojiPicker.classList.toggle('hidden');
});

// Evento para fechar o painel se clicar em qualquer outro lugar da página
document.addEventListener('click', (event) => {
    if (!emojiPicker.classList.contains('hidden') && !emojiPicker.contains(event.target) && event.target !== emojiBtn) {
        emojiPicker.classList.add('hidden');
    }
});
// ✨ FIM: LÓGICA DO SELETOR DE EMOJIS ✨


// --- FIM: LÓGICA DO CHAT AO VIVO ---


        // (O resto do seu código JS continua aqui, sem alterações)
        const visitorCountElement = document.getElementById('visitor-count');
        const presenceRef = database.ref('presence');
        const mySessionRef = presenceRef.push();
        mySessionRef.onDisconnect().remove();
        mySessionRef.set(true);
        presenceRef.on('value', (snapshot) => {
            const count = snapshot.numChildren();
            if (visitorCountElement) {
                visitorCountElement.textContent = count;
            }
        });
        
        const offlineOverlay = document.getElementById('offline-overlay');
        const liveIndicator = document.getElementById('live-indicator-wrapper');
        const unmutePopup = document.getElementById('dbd-unmute-popup');
        const unmuteYesBtn = document.getElementById('unmute-yes-btn');
        const unmuteNoBtn = document.getElementById('unmute-no-btn');
        let popupShown = false;
        window.onPlayerStateChange = function(event) {
    if (event.data === YT.PlayerState.PLAYING) { // Removi o !popupShown para o botão sempre aparecer
        offlineOverlay.classList.add('hidden');
        liveIndicator.classList.remove('hidden');
        document.getElementById('video-loader').classList.add('hidden'); // Esconde a animação
        fullscreenBtn.classList.remove('hidden'); // LINHA ADICIONADA AQUI

        if (!popupShown) { // Movi o popup para uma verificação separada
            unmutePopup.classList.add('show');
            popupShown = true;
        }
    } else {
        // Esconde nosso botão de tela cheia se o vídeo não estiver tocando
        fullscreenBtn.classList.add('hidden');
    }
}
        unmuteYesBtn.addEventListener('click', (event) => {
            event.preventDefault();
            unmutePopup.classList.remove('show');
            if (player && typeof player.unMute === 'function') {
                player.unMute();
            }
        });
        unmuteNoBtn.addEventListener('click', (event) => {
            event.preventDefault();
            unmutePopup.classList.remove('show');
        });
        const feedbackOverlay = document.getElementById('feedback-popup-overlay');
        const openFeedbackBtn = document.getElementById('open-feedback-btn');
        const closeFeedbackBtn = document.getElementById('close-feedback-btn');
        const feedbackForm = document.getElementById('feedback-form');
        const formContent = document.getElementById('feedback-form-content');
        const successContent = document.getElementById('feedback-success-content');
        openFeedbackBtn.addEventListener('click', () => feedbackOverlay.classList.add('active'));
        if(closeFeedbackBtn) {
            closeFeedbackBtn.addEventListener('click', () => {
                feedbackOverlay.classList.remove('active');
                setTimeout(() => {
                    formContent.classList.remove('hidden');
                    successContent.classList.add('hidden');
                }, 400);
            });
        }
        feedbackForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(feedbackForm);
            const submitBtn = feedbackForm.querySelector('.submit-feedback');
            submitBtn.textContent = 'Enviando...';
            submitBtn.disabled = true;
            fetch(feedbackForm.action, {
                method: 'POST', body: formData, headers: { 'Accept': 'application/json' }
            }).then(response => {
                if (response.ok) {
                    formContent.classList.add('hidden');
                    successContent.classList.remove('hidden');
                } else {
                    alert('Houve um erro ao enviar seu feedback. Tente novamente.');
                    submitBtn.textContent = 'Enviar Feedback';
                    submitBtn.disabled = false;
                }
            }).catch(error => {
                alert('Houve um erro de conexão. Tente novamente.');
                submitBtn.textContent = 'Enviar Feedback';
                submitBtn.disabled = false;
            });
        });
        // SUBSTITUA TODO O BLOCO DO PLACAR POR ESTE CÓDIGO CORRIGIDO
const scoreboardFab = document.getElementById('scoreboard-fab');
const scoreboardOverlay = document.getElementById('scoreboard-overlay');
const closeScoreboardBtn = document.getElementById('close-scoreboard-btn');

// 🔧 CORRIGIDO: Referências aos elementos corretos do HTML
const teamsList = document.getElementById('teams-leaderboard'); 
const timestampElement = document.getElementById('last-updated-timestamp');

scoreboardFab.addEventListener('click', () => scoreboardOverlay.classList.add('active'));
closeScoreboardBtn.addEventListener('click', () => scoreboardOverlay.classList.remove('active'));

// ✨ ATUALIZADO: Função completa que atualiza a lista E o carimbo de data/hora
function updateLeaderboard(snapshot, listElement, timestampEl) {
    const data = snapshot.val();
    listElement.innerHTML = '<li>Carregando...</li>';

    if (data) {
        const now = new Date();
        const pad = (num) => num.toString().padStart(2, '0');
        const formattedDate = `${pad(now.getDate())}/${pad(now.getMonth() + 1)}/${now.getFullYear()}`;
        const formattedTime = `${pad(now.getHours())}:${pad(now.getMinutes())}:${pad(now.getSeconds())}`;
        timestampEl.textContent = `Última atualização: ${formattedDate} às ${formattedTime}`;
    } else {
        timestampEl.textContent = 'Ainda não há dados no placar.';
    }

    if (data) {
        listElement.innerHTML = '';
        const entries = Object.keys(data).map(key => ({ id: key, ...data[key] }));
        
        const sortedEntries = entries.sort((a, b) => b.score - a.score);
        
        if (sortedEntries.length === 0) {
            listElement.innerHTML = '<li>Nenhuma equipe registrada ainda.</li>';
        } else {
            sortedEntries.forEach((entry, index) => {
                const li = document.createElement('li');
                li.innerHTML = `<span data-team-id="${entry.id}" class="name">${index + 1}. ${entry.name}</span><span class="score">${entry.score} pts</span>`;
                listElement.appendChild(li);
            });
        }
    } else {
        listElement.innerHTML = '<li>Nenhuma equipe registrada ainda.</li>';
    }
}

// 🔧 CORRIGIDO: Listener que chama a função com os parâmetros corretos
const teamsRef = database.ref('teams');
teamsRef.on('value', (snapshot) => {
    updateLeaderboard(snapshot, teamsList, timestampElement);
});
// ADICIONE ESTE NOVO BLOCO
fullscreenBtn.addEventListener('click', () => {
    // Verifica se JÁ existe um elemento em tela cheia no documento
    const isFullscreen = document.fullscreenElement || document.webkitFullscreenElement;

    // SE NÃO ESTIVER em tela cheia...
    if (!isFullscreen) {
        // ...então, entra em tela cheia.
        if (videoContainer.requestFullscreen) {
            videoContainer.requestFullscreen().then(() => { screen.orientation.lock('landscape'); });
        } else if (videoContainer.webkitRequestFullscreen) { /* Safari */
            videoContainer.webkitRequestFullscreen();
        } else if (videoContainer.msRequestFullscreen) { /* IE11 */
            videoContainer.msRequestFullscreen();
        }
    } 
    // SE JÁ ESTIVER em tela cheia...
    else {
        // ...então, sai da tela cheia.
        if (document.exitFullscreen) {
            document.exitFullscreen().then(() => { screen.orientation.unlock(); });
        } else if (document.webkitExitFullscreen) { /* Safari */
            document.webkitExitFullscreen();
        } else if (document.msExitFullscreen) { /* IE11 */
            document.msExitFullscreen();
        }
    }
});
        });
        document.addEventListener('DOMContentLoaded', function() {
    const openFeedbackBtnHeader = document.getElementById('open-feedback-btn');
    const openFeedbackBtnFooter = document.getElementById('open-feedback-btn-footer');
    const feedbackOverlay = document.getElementById('feedback-popup-overlay');

    if (openFeedbackBtnFooter && feedbackOverlay) {
        openFeedbackBtnFooter.addEventListener('click', () => feedbackOverlay.classList.add('active'));
    }
});
</script>
    <div id="registration-closed-popup" class="popup-overlay align-top">
    <div class="feedback-popup">
        <button class="close-btn">×</button>
        <div class="feedback-success" style="display: block;">
            <img src="https://i.imgur.com/HGt7kAz.png" alt="Inscrições Fechadas" style="height: 150px; margin-bottom: 15px;">
            <h3 style="font-family: 'Creepster', cursive; font-size: 2.5rem;">Inscrições Fechadas</h3>
            <p>A Entidade não está aceitando novos desafiantes no momento. Volte quando os portões de saída forem energizados!</p>
        </div>
    </div>
</div>
    <footer>
    <div class="footer-content">
        <div class="footer-logo">
            <img src="https://i.imgur.com/ElV8c5i.png" alt="Ícone da Entidade">
        </div>
        
        <p class="footer-copyright">© 2025 Torneio da Entidade. Todos os direitos reservados.</p>
        
        <nav class="footer-links">
            <a href="admin.html" target="_blank">Administrador</a>
            <a href="resultados.html" target="_blank">Sorteios</a>
            <a href="niveis.html" target="_blank">Grimório</a>
        </nav>
    </div>
</footer>
    <div id="team-info-overlay" class="popup-overlay align-top">
    <div id="team-info-popup" class="scoreboard-popup"> <button id="close-team-info-btn" class="close-btn">×</button>
        <h2 id="team-info-name">Nome da Equipe</h2>
        <ul id="team-info-members-list">
            </ul>
    </div>
</div>
    <script>
document.addEventListener('DOMContentLoaded', function() {
    const grimorioKillers = document.getElementById('grimorio-killers');
    const grimorioRecompensas = document.getElementById('grimorio-recompensas');

    // Se os elementos existirem na página
    if (grimorioKillers && grimorioRecompensas) {
        // A cada 10 segundos (10000 milissegundos)
        setInterval(() => {
            // Alterna as classes de visibilidade dos dois livros
            grimorioKillers.classList.toggle('grimorio-visible');
            grimorioKillers.classList.toggle('grimorio-hidden');

            grimorioRecompensas.classList.toggle('grimorio-visible');
            grimorioRecompensas.classList.toggle('grimorio-hidden');
        }, 10000); // 10000ms = 10 segundos
    }
});
        // --- INÍCIO: LÓGICA PARA ATIVAR/DESATIVAR INSCRIÇÕES ---

// Seleciona os elementos que vamos usar
const signupBtn = document.getElementById('signup-btn');
    const registrationPopup = document.getElementById('registration-closed-popup');
    const closeRegistrationPopupBtn = registrationPopup.querySelector('.close-btn');

    // Referência no seu Firebase para o controle de inscrições
    const registrationsRef = database.ref('config/registrationsOpen');

    // Fica "ouvindo" qualquer mudança no valor de 'registrationsOpen' no Firebase
    registrationsRef.on('value', (snapshot) => {
        const areOpen = snapshot.val(); // Pega o valor (true ou false)

        if (areOpen === true) {
            // Se as inscrições estiverem ABERTAS
            signupBtn.classList.remove('disabled');
            signupBtn.href = 'inscricao.html'; // Garante que o link funcione
            signupBtn.setAttribute('title', 'Clique para se inscrever!');
        } else {
            // Se as inscrições estiverem FECHADAS (ou não existir a chave)
            signupBtn.classList.add('disabled');
            signupBtn.href = '#'; // Remove o link para evitar navegação
            signupBtn.setAttribute('title', 'As inscrições estão fechadas no momento.');
        }
    });

    // Adiciona o evento de clique ao botão de inscrição
    signupBtn.addEventListener('click', (event) => {
        // Verifica se o botão tem a classe 'disabled'
        if (signupBtn.classList.contains('disabled')) {
            event.preventDefault(); // Previne qualquer ação padrão do link
            registrationPopup.classList.add('active'); // Mostra o pop-up de aviso
        }
    });

    // Função para fechar o pop-up
    function closePopup() {
        registrationPopup.classList.remove('active');
    }

    // Adiciona eventos para fechar o pop-up
    closeRegistrationPopupBtn.addEventListener('click', closePopup);
    registrationPopup.addEventListener('click', (event) => {
        if (event.target === registrationPopup) {
            closePopup();
        }
    });

// --- FIM: LÓGICA PARA ATIVAR/DESATIVAR INSCRIÇÕES ---
</script>
    <script>
    // --- INÍCIO: LÓGICA DA CONTAGEM REGRESSIVA DINÂMICA ---
    document.addEventListener('DOMContentLoaded', function() {
        // Esta verificação garante que a variável 'database' do Firebase já exista
        if (typeof database !== 'undefined') {
            // Referências aos elementos do HTML
            const countdownContainer = document.getElementById('countdown-container');
            const timerElement = document.getElementById('timer');
            const liveMessageElement = document.getElementById('live-message');
            const daysEl = document.getElementById('days');
            const hoursEl = document.getElementById('hours');
            const minutesEl = document.getElementById('minutes');
            const secondsEl = document.getElementById('seconds');

            let countdownInterval; // Variável para controlar o timer

            // Referência para buscar a data no Firebase
            const countdownTargetRef = database.ref('config/countdownTarget');

            countdownTargetRef.on('value', (snapshot) => {
                clearInterval(countdownInterval); // Limpa qualquer timer anterior
                const targetDateString = snapshot.val();

                if (!targetDateString || !countdownContainer) {
                    // Se não houver data definida no admin ou o container não existir, esconde o timer
                    if(countdownContainer) countdownContainer.style.display = 'none';
                    return;
                }

                // Mostra o timer caso ele estivesse escondido
                countdownContainer.style.display = 'flex';

                const countdownDate = new Date(targetDateString).getTime();

                function updateTimer() {
                    const now = new Date().getTime();
                    const distance = countdownDate - now;

                    if (distance < 0) {
                        clearInterval(countdownInterval);
                        if(timerElement) timerElement.classList.add('hidden');
                        if(liveMessageElement) liveMessageElement.classList.remove('hidden');
                        return;
                    }
                    
                    if(timerElement) timerElement.classList.remove('hidden');
                    if(liveMessageElement) liveMessageElement.classList.add('hidden');

                    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                    if(daysEl) daysEl.textContent = String(days).padStart(2, '0');
                    if(hoursEl) hoursEl.textContent = String(hours).padStart(2, '0');
                    if(minutesEl) minutesEl.textContent = String(minutes).padStart(2, '0');
                    if(secondsEl) secondsEl.textContent = String(seconds).padStart(2, '0');
                }

                updateTimer(); // Roda uma vez imediatamente
                countdownInterval = setInterval(updateTimer, 1000); // Atualiza a cada segundo
            });
        }
    });
    // --- FIM: LÓGICA DA CONTAGEM REGRESSIVA DINÂMICA ---
        // --- Lógica para o menu suspenso das Regras (VERSÃO CORRIGIDA) ---
const rulesToggleBtn = document.getElementById('rules-toggle-btn');
const rulesContent = document.getElementById('rules-content');
const dropdownIcon = rulesToggleBtn.querySelector('.dropdown-icon');

// Verifica se os elementos existem antes de adicionar o evento
if (rulesToggleBtn && rulesContent && dropdownIcon) {
    rulesToggleBtn.addEventListener('click', () => {
        // Alterna a classe 'hidden' no conteúdo das regras
        rulesContent.classList.toggle('hidden');
        // Alterna a classe 'rotated' no ícone
        dropdownIcon.classList.toggle('rotated');
    });
}
    </script>
    </body>
</html>
