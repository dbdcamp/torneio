<!DOCTYPE html>
<html lang="pt-br">
<head>
    <link rel="icon" type="image/png" href="https://i.imgur.com/b31EnMe.jpeg">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Torneio Dead by Daylight - Ao Vivo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Creepster&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Special+Elite&display=swap" rel="stylesheet">
    <style>
        :root {
            --cor-principal: #ff4d4d;
            --cor-fundo-container: rgba(15, 15, 15, 0.9);
            --cor-borda: #4a0e0e;
            --cor-borda-forte: #8B0000;
            --cor-texto: #f0f0f0;
            --cor-cinza-botao: #3a3a3a;
        }
        body {
            margin: 0;
            padding: 0;
            font-family: 'Roboto', sans-serif;
            color: var(--cor-texto);
            background-image: url('https://i.imgur.com/Vlh2Ik7.jpeg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            backdrop-filter: brightness(0.6);
        }
        main {
            padding: 40px 5%;
            max-width: 1400px;
            margin: 0 auto;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* --- BANNER DE CAMPEONATO --- */
        #campeonato-banner {
            position: sticky;
            top: 0;
            left: 0;
            width: 100%;
            background-color: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(8px);
            border-bottom: 2px solid var(--cor-principal);
            padding: 15px 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 9999;
            box-sizing: border-box;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            transition: transform 0.5s ease-in-out, opacity 0.5s ease-in-out;
            transform: translateY(0);
            opacity: 1;
            animation: slideInDown 0.6s ease-out;
        }
        @keyframes slideInDown { from { transform: translateY(-100%); } to { transform: translateY(0); } }
        #campeonato-banner.hidden {
            transform: translateY(-150%);
            opacity: 0;
            pointer-events: none;
        }
        .banner-conteudo { display: flex; align-items: center; gap: 20px; }
        .banner-icone { font-size: 2.5rem; line-height: 1; }
        .banner-texto h3 { font-family: 'Creepster', cursive; color: var(--cor-principal); font-size: 1.8rem; margin: 0 0 5px 0; letter-spacing: 1px; }
        .banner-texto p { margin: 0; font-size: 1rem; color: var(--cor-texto); }
        .banner-texto p strong { color: #fff; }
        #close-banner-btn { background: none; border: none; font-size: 2.5rem; color: #888; cursor: pointer; transition: color 0.3s, transform 0.3s; padding: 0 15px; }
        #close-banner-btn:hover { color: var(--cor-principal); transform: scale(1.1); }

        /* --- HEADER --- */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 5%;
            position: sticky;
            top: 0;
            z-index: 2000;
            background-color: rgba(10, 10, 10, 0.8);
            border-bottom: 2px solid var(--cor-borda);
            backdrop-filter: blur(10px);
        }
        .logo { display: flex; flex-direction: column; align-items: center; }
        .logo h1 { font-family: 'Creepster', cursive; font-size: 2.5rem; color: var(--cor-principal); margin: 0; }
        #visitor-counter { display: flex; align-items: center; justify-content: center; gap: 8px; color: #aaa; font-size: 0.9rem; text-shadow: 0 0 5px black; }
        #visitor-counter .icon { font-size: 1.2rem; }
        #visitor-counter #visitor-count { font-weight: bold; color: var(--cor-principal); font-size: 1.1rem; }
        #countdown-container { text-align: center; display: flex; flex-direction: column; justify-content: center; min-width: 300px; }
        .countdown-title { margin: 0 0 5px 0; font-size: 1rem; font-weight: bold; text-transform: uppercase; letter-spacing: 2px; color: #ccc; }
        #timer { display: flex; justify-content: center; gap: 15px; }
        .time-block { display: flex; flex-direction: column; align-items: center; }
        .time-value { font-family: 'Creepster', cursive; font-size: 2.5rem; color: var(--cor-principal); line-height: 1; animation: pulse-red-text 2s infinite; }
        .time-label { font-size: 0.7rem; text-transform: uppercase; color: #aaa; }
        #live-message { font-family: 'Creepster', cursive; font-size: 2rem; color: var(--cor-principal); animation: pulse-red-text 1.5s infinite; }
        @keyframes pulse-red-text { 50% { text-shadow: 0 0 15px var(--cor-principal); } }

        /* --- NAVEGA√á√ÉO PRINCIPAL --- */
        .main-nav ul { margin: 0; padding: 0; list-style: none; display: flex; align-items: center; gap: 25px; }
        .main-nav a, .main-nav .nav-button { color: var(--cor-texto); text-decoration: none; font-weight: bold; font-size: 1rem; padding: 10px 5px; background: none; border: none; cursor: pointer; font-family: 'Roboto', sans-serif; position: relative; transition: color 0.3s ease, text-shadow 0.3s ease; }
        .main-nav a::after, .main-nav .nav-button::after { content: ''; position: absolute; width: 100%; height: 2px; background: var(--cor-principal); left: 0; bottom: 0; transform: scaleX(0); transform-origin: center; transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1); }
        .main-nav a:hover, .main-nav .nav-button:hover { color: #fff; text-shadow: 0 0 10px var(--cor-principal); }
        .main-nav a:hover::after, .main-nav .nav-button:hover::after { transform: scaleX(1); }
        .main-nav .btn { background-color: var(--cor-borda-forte); padding: 10px 20px; border-radius: 5px; border: 2px solid transparent; transition: all 0.3s ease; }
        .main-nav .btn:hover { background-color: var(--cor-principal); transform: translateY(-3px) scale(1.05); box-shadow: 0 0 25px rgba(255, 77, 77, 0.7); border-color: rgba(255, 255, 255, 0.5); color: #fff; text-shadow: none; }
        .main-nav .btn::after { display: none; }

        /* --- CONTE√öDO PRINCIPAL E SE√á√ïES --- */
        .section-container { background-color: var(--cor-fundo-container); padding: 30px; border-radius: 10px; border: 2px solid var(--cor-borda); box-shadow: 0 0 25px rgba(0, 0, 0, 0.5); margin-bottom: 30px; animation: fadeIn 1s ease-in-out; position: relative; }
        .section-title { font-family: 'Creepster', cursive; font-size: 3rem; color: var(--cor-principal); text-align: center; margin-top: 0; margin-bottom: 30px; }
        .hidden { display: none !important; }

        /* --- SE√á√ÉO TRANSMISS√ÉO --- */
        #live-section { max-width: 960px; margin: 0 auto; }
        .video-container { position: relative; width: 100%; padding-top: 56.25%; background-color: #000; border-radius: 5px; border: 1px solid var(--cor-borda); }
        .video-container > div, .video-container > iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        #player-wrapper iframe { width: 100%; height: 100%; border: none; }
        #offline-image { width: 100%; height: 100%; object-fit: cover; }
        .live-indicator { position: absolute; top: 15px; left: 15px; background-color: var(--cor-principal); color: white; padding: 5px 10px; border-radius: 5px; font-weight: bold; z-index: 20; animation: pulse 1.5s infinite; }
        @keyframes pulse { 50% { box-shadow: 0 0 20px rgba(255, 77, 77, 1); } }
        #dbd-unmute-popup { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(200%); background-color: var(--cor-fundo-container); padding: 20px; border-radius: 10px; border: 1px solid var(--cor-borda-forte); box-shadow: 0 0 25px rgba(0,0,0,0.7); z-index: 2000; text-align: center; transition: transform 0.4s ease-out, opacity 0.4s ease-out; width: auto; max-width: 90%; opacity: 0; pointer-events: none; }
        #dbd-unmute-popup.show { transform: translateX(-50%) translateY(0); opacity: 1; pointer-events: auto; }
        #dbd-unmute-popup p { margin: 0 0 15px 0; font-size: 1.1rem; color: var(--cor-texto); }
        .popup-buttons { display: flex; gap: 10px; justify-content: center; }
        .popup-btn { border: none; padding: 10px 25px; border-radius: 5px; font-weight: bold; font-size: 1rem; cursor: pointer; transition: all 0.2s ease; }
        .popup-btn:hover { transform: translateY(-2px); }
        #unmute-yes-btn { background-color: var(--cor-borda-forte); color: white; }
        #unmute-yes-btn:hover { background-color: var(--cor-principal); }
        #unmute-no-btn { background-color: var(--cor-cinza-botao); color: var(--cor-texto); }
        #unmute-no-btn:hover { background-color: #555; }
        #stream-switcher { display: flex; justify-content: center; gap: 15px; margin-top: 20px; }
        .stream-btn { font-weight: bold; text-decoration: none; color: var(--cor-texto); background-color: var(--cor-cinza-botao); padding: 10px 20px; border-radius: 5px; transition: all 0.3s ease; text-transform: uppercase; border: 1px solid var(--cor-borda); font-size: 0.9rem; cursor: pointer; }
        .stream-btn:hover { background-color: #555; transform: translateY(-2px); }
        .stream-btn.active { background-color: var(--cor-principal); box-shadow: 0 4px 15px rgba(255, 0, 0, 0.4); border-color: var(--cor-principal); }
        
        /* --- CHAT --- */
        #chat-messages { height: 350px; overflow-y: auto; border: 1px solid #333; padding: 15px; border-radius: 5px; margin-bottom: 15px; display: flex; flex-direction: column; background-image: linear-gradient(rgba(15, 15, 15, 0.85), rgba(15, 15, 15, 0.85)), url('https://i.imgur.com/ElV8c5i.png'); background-position: center; background-repeat: no-repeat; background-size: contain; position: relative; }
        #chat-messages::-webkit-scrollbar { width: 8px; }
        #chat-messages::-webkit-scrollbar-track { background: #1a1a1a; }
        #chat-messages::-webkit-scrollbar-thumb { background: var(--cor-borda-forte); border-radius: 4px; }
        .chat-message { line-height: 1.4; margin-bottom: 15px; word-wrap: break-word; position: relative; z-index: 5;}
        .chat-message .name { font-weight: bold; line-height: 1.2; margin-right: 8px; cursor: pointer; transition: text-shadow 0.2s; }
        .chat-message .name:hover { text-shadow: 0 0 5px var(--cor-texto); }
        .watching-indicator { display: block; font-size: 0.7rem; color: #888; font-style: italic; line-height: 1; margin-bottom: 4px; font-weight: normal; }
        .chat-message .text { font-size: 0.95rem; display: inline; }
        .chat-message .mention { background-color: var(--cor-principal); color: white; padding: 2px 5px; border-radius: 4px; font-weight: bold; }
        .chat-message .edited-indicator { font-size: 0.75rem; color: #999; font-style: italic; margin-left: 8px; }
        .chat-system-message { color: #a0a0a0; font-style: italic; text-align: center; margin: 8px 0; font-size: 0.9em; }
        #chat-form .form-group { display: flex; gap: 15px; }
        #chat-form input { flex-grow: 1; padding: 12px; border-radius: 5px; border: 1px solid #555; background-color: #1a1a1a; color: #f0f0f0; font-size: 1rem; box-sizing: border-box; }
        #chat-form button { padding: 10px 20px; border: none; border-radius: 5px; background-color: var(--cor-borda-forte); color: white; font-weight: bold; cursor: pointer; transition: background-color 0.3s; font-size: 1rem; }
        #chat-form button:hover { background-color: var(--cor-principal); }
        #chat-form input:focus { border-color: var(--cor-principal); box-shadow: 0 0 10px rgba(255, 77, 77, 0.5); }
        
        /* --- PLACEHOLDER E OVERLAY DO CHAT --- */
        #chat-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: url('https://i.imgur.com/2UivLtF.png'); background-size: cover; background-position: center; z-index: 8; opacity: 0; pointer-events: none; transition: opacity 0.4s ease-in-out; }
        #chat-placeholder { position: absolute; width: 80%; left: 50%; top: 50%; transform: translate(-50%, -50%); z-index: 10; text-align: center; pointer-events: none; transition: opacity 0.3s ease; }
        #chat-messages.placeholder-active #chat-overlay { opacity: 0.95; }
        #chat-messages.placeholder-active { overflow-y: hidden !important; }
        #chat-placeholder .placeholder-icon { font-size: 3rem; margin-bottom: 10px; opacity: 0.6; text-shadow: 0 0 8px rgba(255, 77, 77, 0.5); }
        #chat-placeholder h4 { margin: 0 0 15px 0; font-family: 'Creepster', cursive; font-size: 2rem; font-weight: normal; color: rgba(255, 255, 255, 0.9); text-shadow: 0 0 12px var(--cor-principal); }
        #chat-placeholder p { margin: 8px 0; font-size: 0.95rem; color: rgba(255, 255, 255, 0.8); text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8); }
        #chat-placeholder code { background-color: rgba(0,0,0,0.6); padding: 3px 6px; border-radius: 4px; font-family: monospace; color: #ffc107; font-weight: bold; }

        /* --- ESTILOS DE MENSAGENS ESPECIAIS (MOD, ADMIN, PRIVADA) --- */
        .moderator-message { background: linear-gradient(90deg, rgba(255, 215, 0, 0.1), rgba(255, 215, 0, 0) 70%); border-left: 4px solid #FFD700; padding-left: 15px !important; }
        .moderator-message .name { color: #FFD700; font-weight: bold; text-shadow: 0 0 8px rgba(255, 215, 0, 0.8), 0 0 3px black; }
        .moderator-message .name::before { content: ''; display: inline-block; width: 60px; height: 60px; margin-right: 8px; vertical-align: middle; background-image: url('https://i.imgur.com/2L3vqPA.png'); background-size: contain; background-repeat: no-repeat; background-position: center; }
        @keyframes admin-glow-animation { 0% { border-color: #ff4d4d; box-shadow: 0 0 15px #ff4d4d; } 33% { border-color: #ffffff; box-shadow: 0 0 20px #ffffff; } 66% { border-color: #ffc800; box-shadow: 0 0 25px #ffc800; } 100% { border-color: #ff4d4d; box-shadow: 0 0 15px #ff4d4d; } }
        .admin-message { background: linear-gradient(90deg, rgba(139, 0, 0, 0.3), rgba(10, 10, 10, 0.1) 80%); border: 2px solid; border-radius: 6px; padding: 10px 15px; animation: admin-glow-animation 4s linear infinite; }
        .admin-message .name { font-weight: 900; font-size: 0.9em; color: #fff !important; text-shadow: 0 0 5px #ff4d4d, 0 0 10px #ff4d4d; }
        .admin-message .name::before { content: ''; display: inline-block; width: 50px; height: 50px; margin-right: 10px; vertical-align: -20px; background-image: url('https://i.imgur.com/j5tjs8P.png'); background-size: contain; background-repeat: no-repeat; background-position: center; }
        #private-message-indicator { background-color: rgba(139, 0, 0, 0.3); border: 1px solid var(--cor-borda-forte); padding: 8px 12px; border-radius: 5px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; font-size: 0.9rem; animation: fadeIn 0.3s ease; }
        #private-message-indicator span { font-style: italic; }
        #private-message-indicator button { background: var(--cor-principal); color: white; border: none; border-radius: 4px; padding: 4px 8px; font-size: 0.8rem; cursor: pointer; transition: background-color 0.2s; }
        #private-message-indicator button:hover { background-color: #ff2d2d; }
        .private-message { background-color: rgba(112, 12, 12, 0.2); border-left: 3px solid #FFC107; padding: 10px; border-radius: 5px; }
        .private-message .pm-header { font-size: 0.8em; font-style: italic; color: #FFC107; margin-bottom: 5px; }

        /* --- MENUS, SUGEST√ïES E EMOJIS DO CHAT --- */
        #message-group { position: relative; }
        .message-options-menu { position: absolute; z-index: 1001; background-color: #2c2c2c; border: 1px solid var(--cor-borda); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.6); padding: 5px; display: flex; flex-direction: column; gap: 3px; }
        .options-menu-item { padding: 8px 15px; color: var(--cor-texto); cursor: pointer; font-size: 0.9rem; border-radius: 4px; transition: background-color 0.2s; }
        .options-menu-item:hover { background-color: var(--cor-borda-forte); }
        .options-menu-item.delete { color: #ff5c5c; }
        .options-menu-item.delete:hover { background-color: #ff4d4d; color: #fff; }
        .context-menu { position: absolute; background-color: #2a2a2a; border: 1px solid var(--cor-borda); border-radius: 5px; box-shadow: 0 5px 15px rgba(0,0,0,0.5); z-index: 1000; padding: 5px; }
        .context-menu-item { padding: 8px 15px; color: var(--cor-texto); cursor: pointer; font-size: 0.9rem; }
        .context-menu-item:hover { background-color: var(--cor-borda-forte); }
        .suggestions-box { position: absolute; bottom: 100%; left: 0; right: 0; background-color: #1f1f1f; border: 1px solid var(--cor-borda); border-bottom: none; border-radius: 5px 5px 0 0; max-height: 160px; overflow-y: auto; z-index: 10; box-shadow: 0 -5px 15px rgba(0,0,0,0.3); }
        .suggestion-item { padding: 10px 15px; color: var(--cor-texto); cursor: pointer; border-bottom: 1px solid #333; font-size: 0.9rem; }
        .suggestion-item:last-child { border-bottom: none; }
        .suggestion-item:hover { background-color: var(--cor-borda-forte); }
        #emoji-picker { position: absolute; bottom: 110%; right: 0; width: 300px; max-height: 200px; overflow-y: auto; background-color: #1f1f1f; border: 1px solid var(--cor-borda); border-radius: 8px; box-shadow: 0 -5px 20px rgba(0,0,0,0.4); padding: 10px; z-index: 15; display: grid; grid-template-columns: repeat(auto-fill, minmax(30px, 1fr)); gap: 5px; }
        #emoji-picker::-webkit-scrollbar { width: 6px; }
        #emoji-picker::-webkit-scrollbar-track { background: #2a2a2a; }
        #emoji-picker::-webkit-scrollbar-thumb { background: var(--cor-borda-forte); border-radius: 3px; }
        .emoji-item { padding: 5px; font-size: 1.5rem; text-align: center; cursor: pointer; border-radius: 5px; transition: background-color 0.2s; }
        .emoji-item:hover { background-color: var(--cor-borda-forte); }
        #emoji-toggle-btn { padding: 0 12px; background-color: #2a2a2a; border: 1px solid #555; border-radius: 5px; font-size: 1.2rem; cursor: pointer; transition: background-color 0.3s; }
        #emoji-toggle-btn:hover { background-color: #444; }
        #emoji-toggle-btn:disabled { cursor: not-allowed; opacity: 0.5; }

        /* --- POP-UPS GERAIS --- */
        .popup-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.85); z-index: 3000; display: flex; justify-content: center; align-items: center; opacity: 0; pointer-events: none; transition: opacity 0.4s ease; backdrop-filter: blur(5px); }
        .popup-overlay.active { opacity: 1; pointer-events: auto; }
        .feedback-popup, .scoreboard-popup { background-color: #110e0e; border: 1px solid var(--cor-borda); box-shadow: 0 0 40px rgba(0,0,0,0.8); border-radius: 10px; padding: 30px 40px; width: 90%; max-width: 800px; position: relative; transform: scale(0.9); transition: transform 0.4s ease; }
        .popup-overlay.active .feedback-popup, .popup-overlay.active .scoreboard-popup { transform: scale(1); }
        .popup-overlay.align-top { align-items: flex-start; }
        .feedback-popup, .scoreboard-popup { margin-top: 10vh; max-height: 80vh; display: flex; flex-direction: column; }
        .close-btn { position: absolute; top: 15px; right: 20px; background: none; border: none; font-size: 2rem; color: #888; cursor: pointer; transition: color 0.3s, transform 0.3s; }
        .close-btn:hover { color: var(--cor-principal); transform: rotate(90deg); }
        .feedback-popup h2, .scoreboard-popup h2, .rules-popup h2 { font-family: 'Creepster', cursive; color: var(--cor-principal); font-size: 2.8rem; text-align: center; margin: 0 0 25px 0; }
        
        /* --- FEEDBACK POP-UP --- */
        .feedback-popup .form-row { display: flex; gap: 20px; margin-bottom: 20px; }
        .feedback-popup .form-group { flex: 1; margin-bottom: 20px; }
        .feedback-popup .form-row .form-group { margin-bottom: 0; }
        .feedback-popup .form-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #ccc; font-size: 0.8rem; text-transform: uppercase; }
        .feedback-popup .form-group input, .feedback-popup .form-group textarea { width: 100%; padding: 12px; background-color: rgba(0, 0, 0, 0.4); border: 1px solid #555; border-radius: 5px; color: #fff; font-size: 1rem; box-sizing: border-box; font-family: 'Roboto', sans-serif; }
        .feedback-popup .form-group textarea { resize: vertical; min-height: 120px; }
        .feedback-popup .form-group input:focus, .feedback-popup .form-group textarea:focus { border-color: var(--cor-principal); box-shadow: 0 0 10px rgba(255, 77, 77, 0.5); }
        .submit-feedback { width: 100%; border: none; background-color: var(--cor-borda-forte); color: white; padding: 15px; border-radius: 5px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: all 0.3s; margin-top: 10px; }
        .submit-feedback:hover { background-color: var(--cor-principal); }
        .feedback-success { text-align: center; padding: 40px 20px; }
        .feedback-success .icon { font-size: 4rem; color: var(--cor-principal); animation: popIn 0.5s ease; }
        @keyframes popIn { from { transform: scale(0.5); opacity: 0; } }
        .feedback-success h3 { font-family: 'Creepster', cursive; font-size: 2.5rem; margin: 15px 0 10px 0; }
        
        /* --- SCOREBOARD POP-UP --- */
        .scoreboard-fab { position: fixed; bottom: 720px; right: 280px; z-index: 1000; background: radial-gradient(circle, rgba(255, 77, 77, 0.15) 0%, rgba(139, 0, 0, 0.1) 100%); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.25); box-shadow: 0 8px 30px rgba(0, 0, 0, 0.35); border-radius: 50px; padding: 10px 20px; display: flex; align-items: center; gap: 10px; cursor: pointer; color: var(--cor-texto); font-weight: bold; font-size: 1rem; transition: all 0.3s ease; }
        .scoreboard-fab:hover { transform: scale(1.05) translateY(-5px); background: radial-gradient(circle, rgba(255, 77, 77, 0.25) 0%, rgba(139, 0, 0, 0.2) 100%); border: 1px solid var(--cor-principal); box-shadow: 0 0 25px rgba(255, 77, 77, 0.6); }
        .scoreboard-fab img { width: 50px; height: 50px; }
        #last-updated-timestamp { color: #4CAF50; font-size: 0.9rem; font-style: italic; text-align: center; margin-top: -15px; margin-bottom: 25px; }
        .score-display { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; flex-grow: 1; overflow-y: auto; padding-right: 15px; }
        .score-display::-webkit-scrollbar { width: 8px; }
        .score-display::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.3); border-radius: 10px; }
        .score-display::-webkit-scrollbar-thumb { background-color: var(--cor-borda-forte); border-radius: 10px; border: 2px solid #110e0e; }
        .score-display::-webkit-scrollbar-thumb:hover { background-color: var(--cor-principal); }
        .score-card { background-color: rgba(0,0,0,0.4); padding: 20px; border-radius: 5px; }
        .score-card h3 { margin: 0 0 15px 0; font-size: 1.2rem; text-transform: uppercase; display: flex; align-items: center; justify-content: center; gap: 10px; padding-bottom: 10px; border-bottom: 1px solid var(--cor-borda); }
        .score-card h3 img { height: 70px; }
        #chaveamento-card h3 img { height: 80px !important; width: auto !important; }
        .leaderboard-list { list-style: none; padding: 0; margin: 0; min-height: 288px; }
        .leaderboard-list li { display: flex; justify-content: space-between; padding: 8px 5px; border-radius: 3px; font-size: 1.1rem; }
        .leaderboard-list li:nth-child(odd) { background-color: rgba(255,255,255,0.05); }
        .leaderboard-list .name { font-weight: bold; cursor: pointer; transition: color 0.3s ease, text-shadow 0.3s ease; }
        .leaderboard-list .name:hover { color: var(--cor-principal); text-shadow: 0 0 8px var(--cor-principal); }
        .leaderboard-list .score { color: var(--cor-principal); font-weight: bold; }
        
        /* --- CHAVEAMENTO --- */
        #champion-container { text-align: center; padding: 15px; background: linear-gradient(160deg, rgba(255, 215, 0, 0.15) 0%, rgba(255, 215, 0, 0.05) 100%); border: 2px solid #FFD700; border-radius: 8px; margin-bottom: 25px; box-shadow: 0 0 20px rgba(255, 215, 0, 0.3), inset 0 0 10px rgba(255, 215, 0, 0.2); }
        .champion-title { font-family: 'Creepster', cursive; color: #FFD700; margin: 0; font-size: 1.8rem; text-shadow: 0 0 10px #000; }
        #champion-name { font-family: 'Roboto', sans-serif; font-size: 2rem; font-weight: 700; color: #fff; text-shadow: 0 0 15px #FFD700, 0 0 5px #000; margin: 8px 0 0 0; }
        .fase-container { margin-top: 25px; border-top: 2px solid var(--cor-borda); padding-top: 20px; }
        .fase-titulo { font-family: 'Creepster', cursive; text-align: center; color: var(--cor-principal); font-size: 1.6rem; margin: 0 0 15px 0; text-shadow: 0 0 8px var(--cor-principal); }
        .confronto-bloco { background-color: rgba(0,0,0,0.3); border-radius: 6px; margin-bottom: 15px; border: 1px solid var(--cor-borda); overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.4); }
        .confronto-bloco-titulo { text-align: center; font-weight: bold; font-size: 1.1rem; padding: 10px; background-color: rgba(0,0,0,0.4); color: #ddd; border-bottom: 1px solid var(--cor-borda); }
        .match-pair-placar { display: flex; justify-content: space-between; align-items: center; padding: 10px; font-size: 0.9rem; border-bottom: 1px dashed rgba(255,255,255,0.1); }
        .match-pair-placar:last-child { border-bottom: none; }
        .team-side-placar { width: 45%; text-align: center; }
        .team-name-placar { font-weight: bold; font-size: 1rem; color: #fff; }
        .team-role-placar { color: #aaa; font-style: italic; font-size: 0.8rem; }
        .vs-separator { color: var(--cor-principal); font-weight: bold; }
        
        /* --- POPUP MEMBROS DA EQUIPE --- */
        #team-info-members-list { list-style: none; padding: 0; margin-top: 30px; }
        #team-info-members-list li { background-color: rgba(0, 0, 0, 0.2); padding: 15px 20px; margin-bottom: 10px; border-radius: 6px; border-left: 3px solid #666; font-size: 1.2rem; font-weight: 500; transition: all 0.3s ease; }
        #team-info-members-list li:hover { transform: translateX(5px); border-left-color: var(--cor-principal); }
        #team-info-members-list li.captain-member { background: linear-gradient(90deg, rgba(255, 215, 0, 0.15), rgba(255, 215, 0, 0) 70%); border-left: 4px solid #FFD700; color: #FFD700; font-weight: 700; }
        #team-info-members-list li.captain-member::before { content: 'üëë'; margin-right: 12px; vertical-align: middle; display: inline-block; filter: drop-shadow(0 0 5px #FFD700); }
        #team-info-members-list li.killer-member { background: linear-gradient(90deg, rgba(255, 77, 77, 0.2), rgba(255, 77, 77, 0) 70%); border-left: 4px solid var(--cor-principal); color: var(--cor-principal); font-weight: 700; text-shadow: 0 0 8px rgba(255, 77, 77, 0.7); }
        #team-info-members-list li.killer-member::before { content: 'üî™'; margin-right: 12px; vertical-align: middle; display: inline-block; filter: drop-shadow(0 0 5px var(--cor-principal)); }
        #team-info-members-list li.captain-member.killer-member::before { content: 'üëë üî™'; }

        /* --- SE√á√ÉO REGRAS (POPUP) --- */
        .rules-popup { max-width: 800px; }
        .popup-header { text-align: center; padding: 25px 30px; border-bottom: 1px solid var(--cor-borda); flex-shrink: 0; }
        .popup-header h2 { text-shadow: 0 0 10px var(--cor-principal); }
        .popup-scrollable-content { padding: 10px 30px 30px 30px; overflow-y: auto; }
        .popup-scrollable-content::-webkit-scrollbar { width: 8px; }
        .popup-scrollable-content::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); border-radius: 10px; }
        .popup-scrollable-content::-webkit-scrollbar-thumb { background-color: var(--cor-borda-forte); border-radius: 10px; }
        .popup-scrollable-content::-webkit-scrollbar-thumb:hover { background-color: var(--cor-principal); }
        #rules-popup-content ul { list-style: none; padding: 0; counter-reset: rules-counter; }
        #rules-popup-content li { font-family: 'Special Elite', monospace; color: #ccc; font-size: 1rem; line-height: 1.6; padding: 15px; padding-left: 55px; margin-bottom: 10px; position: relative; background-color: rgba(0, 0, 0, 0.2); border-left: 3px solid transparent; transition: all 0.3s ease; }
        #rules-popup-content li:hover { background-color: rgba(0, 0, 0, 0.4); border-left-color: var(--cor-principal); transform: translateX(5px); }
        #rules-popup-content li::before { counter-increment: rules-counter; content: counter(rules-counter); position: absolute; left: 15px; top: 15px; font-family: 'Creepster', cursive; font-size: 1.8rem; color: var(--cor-principal); text-shadow: 0 0 5px black; line-height: 1; }
        #rules-popup-content li strong { color: var(--cor-principal); font-weight: normal; }
        
        /* --- FOOTER --- */
        footer { position: fixed; bottom: 0; left: 0; width: 100%; background-color: rgba(15, 15, 15, 0.2); backdrop-filter: blur(15px); border-top: 1px solid rgba(255, 255, 255, 0.2); padding: 10px 5%; z-index: 100; box-sizing: border-box; }
        .footer-content { display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; max-width: 1400px; margin: 0 auto; width: 100%; gap: 20px; }
        .footer-logo img { height: 40px; width: auto; vertical-align: middle; }
        .footer-copyright { color: #ccc; font-size: 0.9rem; margin: 0; text-align: center; }
        .footer-links { display: flex; gap: 20px; justify-self: end; }
        .footer-links a, .footer-links button { color: #ccc; text-decoration: none; transition: color 0.3s ease; background: none; border: none; cursor: pointer; font-size: 0.9rem; padding: 0; font-family: 'Roboto', sans-serif; }
        .footer-links a:hover, .footer-links button:hover { color: var(--cor-principal); }

/* ========================================== */
/* --- ESTILOS DO MENU MOBILE (NOVO) --- */
/* ========================================== */
.menu-mobile-btn {
    display: none; /* Escondido por padr√£o no desktop */
    flex-direction: column;
    justify-content: space-around;
    width: 35px;
    height: 35px;
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 0;
    z-index: 2010; /* Garante que fique acima de outros elementos */
}

.menu-mobile-btn span {
    width: 100%;
    height: 3px;
    background-color: var(--cor-principal);
    border-radius: 5px;
    transition: all 0.3s linear;
    position: relative;
    transform-origin: 1px;
}

/* Anima√ß√£o do √≠cone para virar um "X" */
header.menu-aberto .menu-mobile-btn span:nth-child(1) {
    transform: rotate(45deg);
}

header.menu-aberto .menu-mobile-btn span:nth-child(2) {
    opacity: 0;
    transform: translateX(20px);
}

header.menu-aberto .menu-mobile-btn span:nth-child(3) {
    transform: rotate(-45deg);
}
        /* =================================================== */
        /* --- ESTILOS PARA DISPOSITIVOS M√ìVEIS --- */
        /* =================================================== */

        /* Regras para telas m√©dias (tablets e celulares grandes) */
        @media (max-width: 850px) {
            body {
                /* Garante que o conte√∫do n√£o fique escondido atr√°s do footer fixo */
                
            }
            main {
                padding: 20px 15px;
            }
            .section-container {
                padding: 20px;
            }
            .section-title {
                font-size: 2.5rem;
            }

            /* --- Header e Navega√ß√£o --- */
            .scoreboard-fab {
    /* PAINEL DE CONTROLE FINO (SOMENTE MOBILE) */
    bottom: 770px;  /* Dist√¢ncia de baixo para cima */
    right: 13px;   /* Dist√¢ncia da direita para a esquerda */
}
            header {
    flex-direction: column;
    gap: 15px;
    position: relative; /* Alterado de static para relative */
}
            .logo h1 {
                font-size: 2rem;
            }
            #countdown-container {
    display: none !important; /* Esconde o contador e impede o JS de mostr√°-lo */
}
            .menu-mobile-btn {
    display: flex;  /* Mostra o bot√£o hamb√∫rguer no mobile */
    margin-top: 15px;
}

.main-nav {
     display: none; /* Esconde a navega√ß√£o por padr√£o no mobile */
     width: 100%;
}

header.menu-aberto .main-nav {
    display: flex; /* Mostra a navega√ß√£o quando o menu estiver aberto */
    position: absolute;
    top: 100%;
    left: 0;
    background-color: rgba(10, 10, 10, 0.98);
    width: 100%;
    padding: 20px 0;
    border-bottom: 2px solid var(--cor-principal);
    z-index: 2005;
}

.main-nav ul {
    flex-direction: column; /* Itens um abaixo do outro */
    width: 100%;
    align-items: center;
    gap: 20px;
}

            /* --- Banner --- */
            #campeonato-banner {
                padding: 15px;
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            .banner-conteudo {
                flex-direction: column;
                gap: 10px;
            }
            #close-banner-btn {
                position: absolute;
                top: 5px;
                right: 5px;
                font-size: 2rem;
            }

            /* --- Popups --- */
            .score-display {
                grid-template-columns: 1fr; /* Coluna √∫nica no placar */
            }
            .feedback-popup, .scoreboard-popup, .rules-popup {
                padding: 30px 20px;
                width: 95%;
                margin-top: 5vh;
                max-height: 85vh;
            }
            .feedback-popup .form-row {
                flex-direction: column;
                gap: 0;
            }
            .feedback-popup .form-row .form-group {
                margin-bottom: 20px;
            }

            /* --- Footer --- */
            footer {
                position: static; /* Footer tamb√©m deixa de ser fixo */
                margin-top: 30px;
            }
            .footer-content {
                grid-template-columns: 1fr; /* Coluna √∫nica */
                justify-items: center; /* Centraliza tudo */
                gap: 15px;
            }
            .footer-logo { order: 2; }
            .footer-copyright { order: 3; }
            .footer-links { order: 1; justify-self: center; } /* Links v√™m primeiro */
        }

        /* Regras para telas pequenas (celulares) */
        @media (max-width: 480px) {
            .section-title {
                font-size: 2rem;
            }
            .logo h1 {
                font-size: 1.8rem;
            }
            .scoreboard-popup h2, .feedback-popup h2, .rules-popup h2 {
                font-size: 2.2rem;
            }
            
            /* --- Formul√°rios e Bot√µes --- */
            #chat-form .form-group {
                flex-direction: column;
                gap: 10px;
            }
            #chat-form button {
                width: 100%;
            }
            #stream-switcher {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }
            
            /* --- Placar FAB e Popups --- */
            .scoreboard-fab {
                padding: 8px 15px;
                font-size: 0.9rem;
            }
            .scoreboard-fab img {
                width: 40px;
                height: 40px;
            }
            .score-card h3 img {
                height: 60px;
            }
        }
    </style>
</head>
<body>
    <div id="campeonato-banner" class="hidden">
        <div class="banner-conteudo">
            <div class="banner-icone">üèÜ</div>
            <div class="banner-texto">
                <h3>A Pr√≥xima Ca√ßada Foi Anunciada!</h3>
                <p>A n√©voa se agita! O pr√≥ximo torneio ser√° em <strong><span id="banner-data"></span> <span id="banner-horario"></span></strong>. Prepare sua alma!</p>
            </div>
        </div>
        <button id="close-banner-btn" title="Fechar Aviso">√ó</button>
    </div>
   <header>
    <div class="logo">
        <h1>Torneio da Entidade</h1>
        <div id="visitor-counter">
            <span class="icon">üëÅÔ∏è</span>
            <span id="visitor-count">1</span>
            <span class="text"></span>
        </div>
    </div>
<button id="menu-mobile-btn" class="menu-mobile-btn">
    <span></span>
    <span></span>
    <span></span>
</button>
    <div id="countdown-container">
        <p class="countdown-title">A Ca√ßada Come√ßa Em...</p>
        <div id="timer">
            <div class="time-block">
                <span id="days" class="time-value">00</span>
                <span class="time-label">Dias</span>
            </div>
            <div class="time-block">
                <span id="hours" class="time-value">00</span>
                <span class="time-label">Horas</span>
            </div>
            <div class="time-block">
                <span id="minutes" class="time-value">00</span>
                <span class="time-label">Minutos</span>
            </div>
            <div class="time-block">
                <span id="seconds" class="time-value">00</span>
                <span class="time-label">Segundos</span>
            </div>
        </div>
        <div id="live-message" class="hidden">A CA√áADA COME√áOU!</div>
    </div>
    <nav class="main-nav">
        <ul>
            <li><button id="open-rules-btn" class="nav-button">Regras</button></li>
            <li><a href="niveis.html">Grim√≥rio</a></li>
            <li><a href="recompensas.html">Rewards</a></li>
            <li><button id="open-feedback-btn" class="nav-button">Feedback</button></li>
            <li><a href="inscricao.html" class="btn" id="signup-btn">Inscrever-se</a></li>
        </ul>
    </nav>
</header>
     <main>
    <section class="section-container" id="transmissao">
        <h2 class="section-title">Acompanhe Ao Vivo</h2>
        <div id="live-section">
            <div class="video-container">
                <div id="player-wrapper"></div>
                <div id="offline-overlay">
                    <img id="offline-image" src="https://i.imgur.com/OezIOeL.jpeg" alt="Transmiss√£o Offline">
                </div>
                <div id="video-loader" class="hidden">
                    <div class="loader-content">
                        <div class="loader-spinner"></div>
                        <span>CARREGANDO A CA√áADA...</span>
                    </div>
                </div>
                <div id="live-indicator-wrapper" class="hidden"><div class="live-indicator">AO VIVO</div></div>
                <button id="custom-fullscreen-btn" class="hidden" title="Tela Cheia">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M5 5h5v2H7v3H5V5m9 0h5v5h-2V7h-3V5m3 9h2v5h-5v-2h3v-3m-7 3v-2H5v5h5v-3H8z"/>
                    </svg>
                </button>
            </div>
            <div id="stream-switcher">
                <button class="stream-btn active" data-stream="stream1">Transmiss√£o Principal</button>
                <button class="stream-btn" data-stream="stream2">Transmiss√£o 2</button>
                <button class="stream-btn" data-stream="stream3">Transmiss√£o 3</button>
            </div>
        </div>
        <div id="dbd-unmute-popup">
            <p>Deseja ativar o som?</p>
            <div class="popup-buttons">
                <button id="unmute-yes-btn" class="popup-btn">Sim</button>
                <button id="unmute-no-btn" class="popup-btn">N√£o</button>
            </div>
        </div>
        <div id="scoreboard-fab" class="scoreboard-fab">
            <img src="https://i.postimg.cc/YCSyWS5y/Gemini-Generated-Image-vpc766vpc766vpc7-Photoroom.png" alt="√çcone de Trof√©u"/>
        </div>
    </section>

    <section class="section-container" id="chat-container">
        <h2 class="section-title">Chat da Entidade</h2>
        <div id="chat-messages">
            <div id="chat-overlay"></div>
            <div id="chat-placeholder">
                <div class="placeholder-icon">üí¨</div>
                <h4>Bem-vindo ao Chat da Entidade</h4>
                <p>Use <code>/nome SEUNOME</code> para mudar o nome de usu√°rio. Ex: /nome Chris.</p>
                <p>Clique no nome de um usu√°rio para enviar uma DM.</p>
                <p>Digite <code>@</code> para mencionar algu√©m.</p>
                <p>Clique em uma mensagem para edit√°-la ou exclu√≠-la.</p>
            </div>
        </div>
        <div id="private-message-indicator" class="hidden">
            <span id="pm-info"></span>
            <button id="exit-pm-btn">Voltar ao Chat P√∫blico</button>
        </div>
        <form id="chat-form">
            <div class="form-group" id="name-group">
                <input type="text" id="chat-name" placeholder="Digite seu nome para entrar..." required maxlength="15">
                <button type="button" id="enter-chat-btn">Entrar no Chat</button>
            </div>
            <div class="form-group hidden" id="message-group">
                <div id="emoji-picker" class="hidden"></div>
                <input type="text" id="chat-message" placeholder="Digite sua mensagem..." required disabled maxlength="400">
                <button type="button" id="emoji-toggle-btn" title="Inserir Emoji" disabled>üòä</button>
                <button type="submit" disabled>Enviar</button>
                <div id="mention-suggestions" class="suggestions-box hidden"></div>
            </div>
        </form>
    </section>

    <section id="regras">
        
        <div id="rules-content" class="rules-list hidden">
            <ul>
                <li>1. Cada esquadr√£o ser√° formado por cinco almas: quatro destinadas √† Sobreviv√™ncia e uma encarregada da Ca√ßada.</li>
                <li>2. A Entidade n√£o espera. A toler√¢ncia para atrasos √© de 5 minutos, e o descumprimento implicar√° em derrota autom√°tica (W.O.).</li>
                <li>3. Assim como o julgamento da Entidade, as decis√µes da organiza√ß√£o s√£o absolutas e n√£o estar√£o sujeitas a apela√ß√µes, visando a integridade da competi√ß√£o.</li>
                <li>4. Para garantir que a habilidade seja o √∫nico reflexo na n√©voa, a Entidade decreta que quando uma equipe for "espelhar" a escolha de Assassino da equipe advers√°ria, ela tamb√©m dever√° espelhar o mapa onde a ca√ßada anterior ocorreu.</li>
                <li>5. Assassinos capazes de um abate instant√¢neo devem honrar a ca√ßada, sendo proibida a pr√°tica de 'camperar'. A exce√ß√£o se aplica unicamente ao Ghost Face.</li>
                <li>6. Para manter o equil√≠brio dos reinos, a Entidade decreta que, dentre as vantagens "Resson√¢ncia, Impasse, Interven√ß√£o e Sem Sa√≠da" o Assassino pode equipar no m√°ximo DUAS (2) por partida.</li>
                <li>7. A forma pura do mal (Michael Myers) est√° proibido de carregar os fragmentos de l√°pide ou o acess√≥rio L√°pide de Judith. Sua f√∫ria deve ser demonstrada no gancho, n√£o em uma aniquila√ß√£o instant√¢nea que ignora o ritual da Entidade.</li>
                <li>8. A Entidade despreza o poder que n√£o √© conquistado pelo m√©rito, ent√£o o uso da perk "Ningu√©m Escapa da Morte (NOED)" √© estritamente proibido. A ca√ßada deve ser vencida pela press√£o constante, n√£o por uma f√∫ria desesperada e artificial no final do ritual.</li>
                <li>9. O reino da Entidade exige respeito. Atos de desrespeito ou preconceito (verbal ou escrito) ser√£o punidos com a expuls√£o sum√°ria de toda a equipe do torneio.</li>
                <li>10. A agonia no ch√£o tem seus limites. Um Assassino com duas presas ca√≠das deve completar o ritual do gancho com uma delas antes de voltar seu foco para os demais.</li>
                <li>11. Para selar o destino da √∫ltima esperan√ßa, cada partida deve ser iniciada com uma oferenda que conjure a Escotilha no Santu√°rio do Assassino ou no pr√©dio principal.</li>
                <li>12. A engenhosidade √© a chave. Os quatro Sobreviventes devem adentrar a partida com itens √∫nicos, sendo proibida a repeti√ß√£o de arsenal entre os membros da equipe.</li>
                <li>13. Entre as poderosas vantagens "Adrenalina, Inquebr√°vel, Extraoficialmente, Duro na Queda e Ataque Decisivo", a equipe de Sobreviventes pode equipar apenas UMA (1) no total entre os quatro jogadores na mesma partida.</li>
                <li>14. As leis da realidade, mesmo neste reino, n√£o devem ser quebradas. √â estritamente proibido o uso de qualquer bug, glitch ou exploit conhecido que conceda uma vantagem injusta. A descoberta de tal ato levar√° √† desclassifica√ß√£o imediata.</li>
                <li>15. Em caso de almas perdidas na n√©voa por desconex√£o de um jogador (Somente se n√£o houver come√ßado uma persegui√ß√£o qualquer), a partida dever√° ser reiniciada. Se j√° houver persegui√ß√£o em andamento, a partida continua normalmente, e a equipe desfalcada dever√° lutar com as almas que restaram.</li>
                <li>16. A desobedi√™ncia √† entidade tem um pre√ßo. A equipe ou Assassino infrator perder√° o favor da Entidade, sofrendo com a subtra√ß√£o parcial ou total dos pontos e at√© mesmo com a desclassifica√ß√£o.</li>
            </ul>
        </div>
    </section>
         
</main>
<footer>
    <div class="footer-content">
        <div class="footer-logo">
            <img src="https://i.imgur.com/ElV8c5i.png" alt="√çcone da Entidade">
        </div>
        
        <p class="footer-copyright">¬© 2025 Torneio da Entidade. Todos os direitos reservados.</p>
        
        <nav class="footer-links">
            <a href="admin.html" target="_blank">Administrador</a>
            <a href="resultados.html" target="_blank">Sorteios</a>
            <a href="niveis.html" target="_blank">Grim√≥rio</a>
        </nav>
    </div>
</footer>
<div id="rules-popup-overlay" class="popup-overlay align-top">
    <div class="rules-popup scoreboard-popup"> <button id="close-rules-btn" class="close-btn">√ó</button>
        <h2>Regras do Torneio</h2>
        <div id="rules-popup-content" class="score-display">
            </div>
    </div>
</div>
<div id="scoreboard-overlay" class="popup-overlay align-top">
    <div class="scoreboard-popup">
        <button id="close-scoreboard-btn" class="close-btn">√ó</button>
        <h2>Placar do Torneio</h2>
        <p id="last-updated-timestamp"></p>
        <div class="score-display">
            <div class="score-card">
                <h3><img src="https://i.postimg.cc/YCSyWS5y/Gemini-Generated-Image-vpc766vpc766vpc7-Photoroom.png" alt="√çcone Trof√©u"> Placar das Equipes</h3>
                <ol id="teams-leaderboard" class="leaderboard-list"></ol>
            </div>
            <div class="score-card">
                <h3><img src="https://i.imgur.com/pvVRmnb.png" alt="√çcone de Confronto"> Chaveamento do Torneio</h3>
                <div id="champion-container" class="hidden">
                    <h4 class="champion-title">üëë GRANDE CAMPE√ÉO üëë</h4>
                    <p id="champion-name"></p>
                </div>
                <div id="grupos-container" class="fase-container hidden">
                    <h4 class="fase-titulo">‚öîÔ∏è Fase de Grupos ‚öîÔ∏è</h4>
                    <div id="grupos-lista"></div>
                </div>
                <div id="semis-container" class="fase-container hidden">
                    <h4 class="fase-titulo">üí• Semifinais üí•</h4>
                    <div id="semis-lista"></div>
                </div>
                <div id="final-container" class="fase-container hidden">
                    <h4 class="fase-titulo">üèÜ Grande Final üèÜ</h4>
                    <div id="final-lista"></div>
                </div>
                <p id="sem-confrontos-msg">Nenhum sorteio foi realizado ainda.</p>
            </div>
        </div>
    </div>
</div>

<div id="feedback-popup-overlay" class="popup-overlay align-top">
    <div class="feedback-popup">
        <button id="close-feedback-btn" class="close-btn">√ó</button>
        <div id="feedback-form-content">
            <h2>Sua Opini√£o Importa</h2>
            <form id="feedback-form" action="https://formspree.io/f/xpwrwpzo" method="POST">
                <div class="form-row">
                    <div class="form-group"><label for="feedback-name">Seu Nome</label><input type="text" id="feedback-name" name="name" required></div>
                    <div class="form-group"><label for="feedback-email">Seu Email</label><input type="email" id="feedback-email" name="email" required></div>
                </div>
                <div class="form-group"><label for="feedback-message">Sua Mensagem</label><textarea id="feedback-message" name="message" required></textarea></div>
                <button type="submit" class="submit-feedback">Enviar Feedback</button>
            </form>
        </div>
        <div id="feedback-success-content" class="feedback-success hidden">
            <div class="icon">‚úî</div><h3>Enviado!</h3><p>Obrigado pelo seu feedback.</p>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
<script src="https://www.youtube.com/iframe_api"></script>
    
<script>
    // --- COLE AQUI A CONFIGURA√á√ÉO DO FIREBASE ---
    const firebaseConfig = {
        apiKey: "AIzaSyAyyhIT7nE7gGngadaAuBwhqlw8FER4Ogo",
        authDomain: "torneiodbd.firebaseapp.com",
        projectId: "torneiodbd",
        storageBucket: "torneiodbd.firebasestorage.app",
        messagingSenderId: "253724939016",
        appId: "1:253724939016:web:030515bc99b6c0d3ab52bd"
    };
    // --- FIM DA CONFIGURA√á√ÉO ---

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const isLiveNow = true; // MUDE PARA false QUANDO N√ÉO HOUVER LIVE
function generateUUID() {
        return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>
            (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
        );
    }
    let deviceId = localStorage.getItem('chatDeviceId');
    if (!deviceId) {
        deviceId = generateUUID();
        localStorage.setItem('chatDeviceId', deviceId);
    }
   // ‚ú® NOVO: Objeto para armazenar os IDs das suas 3 transmiss√µes
const STREAM_IDS = {
    stream1: 'ID_DA_LIVE_1', // SUBSTITUA PELO ID REAL DA SUA LIVE PRINCIPAL
    stream2: 'ID_DA_LIVE_2', // SUBSTITUA PELO ID REAL DA LIVE 2
    stream3: 'ID_DA_LIVE_3'  // SUBSTITUA PELO ID REAL DA LIVE 3
};

let player;
let currentStreamKey = 'stream1'; // Define a transmiss√£o padr√£o que ser√° carregada primeiro

window.onYouTubeIframeAPIReady = function() {
    // Se a vari√°vel isLiveNow for true...
    if (isLiveNow) {
        // ...mostra a nossa anima√ß√£o de carregamento...
        //document.getElementById('video-loader').classList.remove('hidden');

        // ...e ent√£o cria o player do YouTube.
        player = new YT.Player('player-wrapper', {
            videoId: STREAM_IDS[currentStreamKey], // Carrega a live padr√£o
            playerVars: { 'autoplay': 1, 'mute': 1, 'playsinline': 1, 'controls': 1 },
            events: { 'onStateChange': onPlayerStateChange }
        });
    }
    // Se isLiveNow for false, nada acontece, e a imagem offline continua vis√≠vel por padr√£o.
};
    document.addEventListener('DOMContentLoaded', function() {
        const menuBtn = document.getElementById('menu-mobile-btn');
    const header = document.querySelector('header');

    if (menuBtn && header) {
        menuBtn.addEventListener('click', () => {
            header.classList.toggle('menu-aberto');
        });
    }
        // --- IN√çCIO: L√ìGICA DO POP-UP DE MEMBROS DA EQUIPE ---

// Refer√™ncias aos elementos do pop-up
const teamInfoOverlay = document.getElementById('team-info-overlay');
const teamInfoPopup = document.getElementById('team-info-popup');
const closeTeamInfoBtn = document.getElementById('close-team-info-btn');
const teamInfoName = document.getElementById('team-info-name');
const teamInfoMembersList = document.getElementById('team-info-members-list');

// O placar √© din√¢mico, ent√£o usamos delega√ß√£o de evento
const placarListaEquipes = document.getElementById('teams-leaderboard');
        // ‚ñº‚ñº‚ñº COLE ESTE NOVO BLOCO DE C√ìDIGO ‚ñº‚ñº‚ñº

// --- VIGIA DO STATUS DO CHAT EM TEMPO REAL ---
function updateChatUI() {
    // Esta fun√ß√£o agora centraliza toda a l√≥gica de habilitar/desabilitar o chat
    const isChatActive = isChatCurrentlyEnabled; // Usa a vari√°vel global que j√° temos
    const enterChatBtn = document.getElementById('enter-chat-btn');
    const chatMessageInput = document.getElementById('chat-message');
    const messageGroup = document.getElementById('message-group');
    const submitBtn = messageGroup.querySelector('button[type="submit"]');
    const emojiBtn = document.getElementById('emoji-toggle-btn');

    const isCurrentUserAdmin = currentUser && adminUsername && currentUser.toLowerCase() === adminUsername.toLowerCase();

    if (isChatActive) {
        enterChatBtn.disabled = false;
        enterChatBtn.textContent = 'Entrar no Chat';
        if (currentUser) {
            chatMessageInput.disabled = false;
            chatMessageInput.placeholder = 'Digite sua mensagem...';
            submitBtn.disabled = false;
            emojiBtn.disabled = false;
        }
    } else {
        enterChatBtn.disabled = true;
        enterChatBtn.textContent = 'Chat Desativado';
        if (currentUser) {
            if (isCurrentUserAdmin) {
                chatMessageInput.disabled = false;
                submitBtn.disabled = false;
                emojiBtn.disabled = false;
                chatMessageInput.placeholder = 'Chat desativado para usu√°rios. Voc√™ ainda pode enviar mensagens.';
                // N√£o vamos mais exibir a mensagem do sistema aqui para evitar repeti√ß√£o
            } else {
                chatMessageInput.disabled = true;
                submitBtn.disabled = true;
                emojiBtn.disabled = true;
                chatMessageInput.placeholder = 'O chat foi desativado pelo administrador.';
            }
        }
    }
}
// ‚ú® PASSO 2: ADICIONE ESTE NOVO LISTENER SIMPLIFICADO
const chatStatusRef = database.ref('config/chatEnabled');
chatStatusRef.on('value', (snapshot) => {
    isChatCurrentlyEnabled = snapshot.val() === true;
    updateChatUI(); // Apenas chama a fun√ß√£o central
});
// ‚ñ≤‚ñ≤‚ñ≤ FIM DO NOVO BLOCO ‚ñ≤‚ñ≤‚ñ≤
        // ‚ñº‚ñº‚ñº COLE O NOVO BLOCO DE C√ìDIGO AQUI ‚ñº‚ñº‚ñº
// Vigia que busca o nome do admin em tempo real
database.ref('config/administratorName').on('value', (snapshot) => {
    adminUsername = snapshot.val() || '';
    updateChatUI();
});
// ‚ñ≤‚ñ≤‚ñ≤ FIM DO NOVO BLOCO ‚ñ≤‚ñ≤‚ñ≤

placarListaEquipes.addEventListener('click', (e) => {
    if (e.target.classList.contains('name')) {
        const teamId = e.target.dataset.teamId;
        if (teamId) {
            teamsRef.child(teamId).once('value', (snapshot) => {
                const teamData = snapshot.val();
                
                if (teamData && teamData.members) {
                    teamInfoName.textContent = teamData.name;
                    teamInfoMembersList.innerHTML = '';

                    const killerName = teamData.members.killer;
                    const captainName = teamData.members.capitao;
                    
                    // Cria uma lista com todos os nomes de jogadores, sem repeti√ß√£o
                    const todosOsMembros = new Set();
                    if (captainName) todosOsMembros.add(captainName);
                    if (killerName) todosOsMembros.add(killerName); // Garante que o killer esteja na lista
                    for (let i = 1; i <= 4; i++) {
                        const memberName = teamData.members[`membro${i}`];
                        if (memberName) todosOsMembros.add(memberName);
                    }

                    // Agora, cria o elemento <li> para cada membro da lista
                    todosOsMembros.forEach(nomeDoMembro => {
                        const li = document.createElement('li');
                        li.textContent = nomeDoMembro;

                        // Aplica o estilo de Capit√£o se o nome corresponder
                        if (nomeDoMembro === captainName) {
                            li.classList.add('captain-member');
                        }
                        // Aplica o estilo de Killer se o nome corresponder
                        if (nomeDoMembro === killerName) {
                            li.classList.add('killer-member');
                        }
                        teamInfoMembersList.appendChild(li);
                    });
                    
                    teamInfoOverlay.classList.add('active');
                } else {
                    alert('Informa√ß√µes dos membros n√£o encontradas para esta equipe.');
                }
            });
        }
    }
});

// Fun√ß√µes para fechar o pop-up
function closeTeamInfoPopup() {
    teamInfoOverlay.classList.remove('active');
}

closeTeamInfoBtn.addEventListener('click', closeTeamInfoPopup);
teamInfoOverlay.addEventListener('click', (e) => {
    // Fecha o pop-up se o clique for no fundo escuro
    if (e.target === teamInfoOverlay) {
        closeTeamInfoPopup();
    }
});

// --- FIM: L√ìGICA DO POP-UP ---
// --- IN√çCIO: L√ìGICA FINAL DO BANNER (BASEADA NA L√ìGICA DO PLACAR) ---

// Seleciona os elementos do banner na p√°gina
const campeonatoBanner = document.getElementById('campeonato-banner');
const bannerData = document.getElementById('banner-data');
const bannerHorario = document.getElementById('banner-horario');
const closeBannerBtn = document.getElementById('close-banner-btn');

// Garante que o c√≥digo s√≥ execute se os elementos existirem
if (campeonatoBanner) {
    
    // O PLACAR L√ä DE 'teams'. O BANNER LER√Å DE 'banner'.
    // Esta √© a refer√™ncia correta, no n√≠vel principal do seu banco de dados.
    const bannerRef = database.ref('banner');

    // Fica "escutando" por qualquer altera√ß√£o no objeto 'banner'
    bannerRef.on('value', (snapshot) => {
        const bannerInfo = snapshot.val();

        // CONDI√á√ÉO: O objeto 'banner' existe? O campo 'ativo' √© true? O campo 'data' existe?
        if (bannerInfo && bannerInfo.ativo === true && bannerInfo.data) {
            
            // Se sim, preenchemos os dados e removemos a classe 'hidden' para MOSTRAR o banner.
            bannerData.textContent = bannerInfo.data;
            bannerHorario.textContent = bannerInfo.horario || ''; // Hor√°rio √© opcional
            campeonatoBanner.classList.remove('hidden');

        } else {
            
            // Caso contr√°rio, adicionamos a classe 'hidden' para garantir que ele fique ESCONDIDO.
            campeonatoBanner.classList.add('hidden');
        }
    });

    // Adiciona a funcionalidade para o bot√£o de fechar.
    closeBannerBtn.addEventListener('click', () => {
        campeonatoBanner.classList.add('hidden');
    });
}
// --- FIM: L√ìGICA FINAL DO BANNER ---
        const fullscreenBtn = document.getElementById('custom-fullscreen-btn');
const videoContainer = document.querySelector('.video-container');
       // ‚ú® NOVO: L√≥gica para trocar a transmiss√£o
    const streamSwitcher = document.getElementById('stream-switcher');
    const streamButtons = document.querySelectorAll('.stream-btn');

    streamSwitcher.addEventListener('click', (e) => {
        // Verifica se o clique foi em um bot√£o de stream e n√£o √© o ativo
        if (e.target.classList.contains('stream-btn') && !e.target.classList.contains('active')) {
            const newStreamKey = e.target.dataset.stream;

            // Se o player estiver pronto, carrega o novo v√≠deo
            if (player && typeof player.loadVideoById === 'function') {
                player.loadVideoById(STREAM_IDS[newStreamKey]);
                currentStreamKey = newStreamKey;

                // Atualiza a classe 'active' nos bot√µes
                streamButtons.forEach(btn => {
                    btn.classList.remove('active');
                });
                e.target.classList.add('active');
            }
            }
        });
        
        // --- IN√çCIO: L√ìGICA DO CHAT AO VIVO (COMANDOS, DMs E MEN√á√ïES CORRIGIDAS) ---
const MAX_MESSAGE_LENGTH = 400;
const MAX_USERNAME_LENGTH = 15;
const palavrasImproprias = ['idiota', 'idiotas', 'viadinho', 'laskar', 'lascar', 'p√¥po', 'pop√¥', 'p√¥p√¥', 'popo', 'bumbum', 'bunda', 'dedada', 'lamber', 'linguada', 'boquetinho', 'boquet√£o', 'boquetao', 'bouquete', 'boquete', 'genital', 'genitalha', 'camaco', 'dotada', 'dotado', 'roludas', 'roludos', 'roluda', 'roludo', 'rola', 'piroc√£o', 'pirocao', 'pirocudo', 'pirocas', 'piroca', 'neguinhos', 'negrinhos', 'negrinhas', 'neguinha', 'neguinha', 'neguinho', 'nego', 'chifruda', 'chifrudo', 'corninha', 'corninho', 'benga', 'pauzuda', 'pauzudo', 'rodinhas', 'cuzinhos', 'gayzinhos', 'viadinhos', 'putinhas', 'ovinhos', 'ovinho', 'ov√£o', 'ovao', 'ovos', 'ovo', 'rodinha', 'boguinha', 'boga', '√¢nus', 'anus', 'lambido', 'lambi', 'lamber', 'lambe', 'vara', 'negrinha', 'negrinho', 'negra', 'negro', 'peitao', 'peit√£o', 'peitinho', 'peito', 'peitos', 'chupar', 'chupa', 'viad', 'viadao', 'viad√£o', 'viadinho', 'mamaco', 'macaquinho', 'lingui√ßa', 'toba', 'pau no c√∫', 'pau no cu', 'arrombada', 'arrombado', 'piranha', 'gayzinho', 'vadiazinha', 'putinha', 'puta', 'gay', 'travesti', 'traveco', 'bicha', 'bixa', 'macaca', 'macaco', 'vagabunda', 'bilau', 'pal', 'pau', 'chibiu', 'xibiu', 'perereca', 'chota', 'xota', 'vagina', 'buceta', 'p√™nis', 'penis', 'incesto', 'porno', 'porn√¥', 'viadinha', 'cuzinho', 'vadio', 'vadia', 'bobo', 'bobos', 'trouxa', 'trouxas', 'babaca', 'babacas', 'ot√°rio', 'otaria', 'ot√°rios', 'otarias', 'boc√≥', 'boc√≥s', 'burro', 'burra', 'burros', 'burras', 'imbecil', 'imbecis', 'corno', 'corna', 'cornos', 'cornas', 'vagabundo', 'vagabunda', 'vagabundos', 'vagabundas', 'merda', 'merdas', 'porra', 'porras', 'caralho', 'caralhos', 'filho da puta', 'filha da puta', 'filhos da puta', 'filhas da puta', 'puta', 'putas', 'putaria', 'puto', 'puta que pariu', 'vai tomar no cu', 'vai se foder', 'vai se ferrar', 'vai se lascar', 'se fode', 'se foda', 'se ferra', 'se lasca', 'se ferrou', 'foda-se', 'fodase', 'fodam-se', 'fodido', 'fodida', 'fodidos', 'fodidas', 'fdp', 'pnc', 'vsf', 'vtnc', 'escroto', 'escrota', 'escrotos', 'escrotas', 'cuz√£o', 'cuzona', 'cuz√µes', 'cuzao', 'cuzona', 'cu', 'cuzao', 'pau no cu', 'pau no seu cu', 'pau no c√∫', 'no cu', 'no c√∫', 'viado', 'veado', 'veados', 'viados', 'boiola', 'boiolas', 'bicha', 'bichas', 'gayzinho', 'lesbica', 'l√©sbica', 'mongol', 'mongoloide', 'retardado', 'retardada', 'retardados', 'retardadas', 'deficiente', 'aleijado', 'aleijada', 'aleijados', 'aleijadas', 'doente', 'doentes', 'nojento', 'nojenta', 'nojentos', 'nojentas', 'maldito', 'maldita', 'desgra√ßado', 'desgra√ßada', 'desgra√ßados', 'desgra√ßadas', 'maluco', 'maluca', 'malucos', 'malucas', 'traste', 'lixo', 'lixos', 'fracassado', 'fracassada', 'fracassados', 'fracassadas', 'z√© ruela', 'z√© buceta', 'z√©', 'cracudo', 'cracuda', 'cracudos', 'cracudas', 'maconheiro', 'maconheira', 'maconheiros', 'maconheiras', 'demente', 'tapado', 'tapada', 'jumento', 'jumenta', 'anta', 'jegue', 'burro pra caralho', 'burra pra caralho'];
const chatNameInput = document.getElementById('chat-name');
const enterChatBtn = document.getElementById('enter-chat-btn');
const nameGroup = document.getElementById('name-group');
const chatForm = document.getElementById('chat-form');
const chatMessageInput = document.getElementById('chat-message');
const messageGroup = document.getElementById('message-group');
const chatMessages = document.getElementById('chat-messages');
const chatSubmitButton = messageGroup.querySelector('button[type="submit"]');
const chatPlaceholder = document.getElementById('chat-placeholder');

// Refer√™ncias para novas funcionalidades
const pmIndicator = document.getElementById('private-message-indicator');
const pmInfo = document.getElementById('pm-info');
const exitPmBtn = document.getElementById('exit-pm-btn');
const suggestionsBox = document.getElementById('mention-suggestions');

// Refer√™ncias do Firebase
const publicMessagesRef = database.ref('chatMessages');
const privateMessagesRef = database.ref('privateMessages');
const participantsRef = database.ref('participants');
        // COLE ESTAS 5 LINHAS ABAIXO
const moderatorsRef = database.ref('moderators');
let moderatorList = {}; // Guarda a lista de mods

moderatorsRef.on('value', (snapshot) => {
    moderatorList = snapshot.val() || {}; // Atualiza a lista em tempo real
});

// Vari√°veis de estado
let chatParticipants = new Set();
let currentUser = '';
let isChatCurrentlyEnabled = true; // Come√ßa como ativado por padr√£o
let adminUsername = '';
let privateRecipient = null;
const userColors = {};

function getRandomColor() {
    const hue = Math.floor(Math.random() * 360);
    return `hsl(${hue}, 90%, 70%)`;
}

function escapeHTML(str) {
    const p = document.createElement('p');
    p.textContent = str;
    return p.innerHTML;
}

function displaySystemMessage(text) {
    const messageElement = document.createElement('div');
    messageElement.className = 'chat-system-message';
    messageElement.textContent = text;
    chatMessages.appendChild(messageElement);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}
        // DEPOIS (SUBSTITUA PELA VERS√ÉO ABAIXO)
function contemPalavraImpropria(texto) {
    if (palavrasImproprias.length === 0) return false;

    // Converte o texto do usu√°rio para min√∫sculas e divide em "palavras"
    // Isso lida com espa√ßos e pontua√ß√µes de forma mais eficaz
    const palavrasDoTexto = texto.toLowerCase().split(/[\s,\.;:\-_!?()]+/);

    // Verifica se ALGUMA das palavras do texto est√° na lista de palavras impr√≥prias
    return palavrasDoTexto.some(palavra => palavrasImproprias.includes(palavra));
}

// ‚ú® SUBSTITUA PELO BLOCO CORRIGIDO ABAIXO ‚ú®

function activateChat(name) {
    // A verifica√ß√£o do Firebase foi removida daqui, pois o "vigia" j√° cuida disso.

    currentUser = name;
    const chatNameInput = document.getElementById('chat-name');
    const nameGroup = document.getElementById('name-group');
    const messageGroup = document.getElementById('message-group');
    const chatMessageInput = document.getElementById('chat-message');
    const chatSubmitButton = messageGroup.querySelector('button[type="submit"]');
    const chatPlaceholder = document.getElementById('chat-placeholder');

    chatNameInput.value = name;
    nameGroup.classList.add('hidden');

    if (chatPlaceholder) {
        chatPlaceholder.classList.add('hidden');
        chatMessages.classList.remove('placeholder-active');
    }

    messageGroup.classList.remove('hidden');
    chatMessageInput.disabled = false;
    if(chatSubmitButton) chatSubmitButton.disabled = false;
    document.getElementById('emoji-toggle-btn').disabled = false;
    chatMessageInput.focus();

    const participantRef = participantsRef.child(name);
    participantRef.set({ deviceId: deviceId, online: true });
    participantRef.onDisconnect().remove();

    listenForPrivateMessages(currentUser);
}

// L√≥gica de Entrada no Chat (COM VERIFICA√á√ÉO DE BAN)
const savedName = localStorage.getItem('dbdChatName');
if (savedName) {
    activateChat(savedName);
} else {
    if (chatPlaceholder) chatPlaceholder.classList.remove('hidden');
    chatMessages.classList.add('placeholder-active');
}

// Fun√ß√£o para bloquear o chat (reutiliz√°vel)
function bloquearChatPorBanimento() {
    alert('Este dispositivo foi banido do chat e n√£o pode mais participar.');
    const chatNameInput = document.getElementById('chat-name');
    const enterChatBtn = document.getElementById('enter-chat-btn');
    const chatMessageInput = document.getElementById('chat-message');
    const chatSubmitButton = document.querySelector('#message-group button[type="submit"]');
    
    if (chatNameInput) chatNameInput.disabled = true;
    if (enterChatBtn) {
        enterChatBtn.disabled = true;
        enterChatBtn.textContent = 'BANIDO';
    }
    if (chatMessageInput) {
        chatMessageInput.disabled = true;
        chatMessageInput.placeholder = 'Voc√™ foi banido.';
    }
    if (chatSubmitButton) chatSubmitButton.disabled = true;
}

// "Vigilante" em tempo real que escuta por banimentos
const dispositivoBanidoRef = database.ref('dispositivosBanidos').child(deviceId);
dispositivoBanidoRef.on('value', (snapshot) => {
    if (snapshot.exists()) {
        bloquearChatPorBanimento();
    }
});

// L√≥gica de entrada no chat simplificada
enterChatBtn.addEventListener('click', () => {
    const name = chatNameInput.value.trim();
    if (!name) return;

    if (contemPalavraImpropria(name)) {
        alert('Este nome de usu√°rio n√£o √© permitido. Por favor, escolha outro.');
        return;
    }
    if (name.length > MAX_USERNAME_LENGTH) {
        alert(`O nome de usu√°rio √© muito longo! O limite √© de ${MAX_USERNAME_LENGTH} caracteres.`);
        return;
    }
    if (chatParticipants.has(name)) {
        alert(`O nome "${name}" j√° est√° em uso.`);
        return;
    }

    localStorage.setItem('dbdChatName', name);
    activateChat(name);
});

participantsRef.on('child_added', snapshot => chatParticipants.add(snapshot.key));
participantsRef.on('child_removed', snapshot => chatParticipants.delete(snapshot.key));

// L√≥gica de Envio de Mensagem (com tratamento de comandos)
chatForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const isCurrentUserAdmin = currentUser && adminUsername && currentUser.toLowerCase() === adminUsername.toLowerCase();
    if (!isChatCurrentlyEnabled && !isCurrentUserAdmin) {
        alert('O chat est√° desativado no momento e voc√™ n√£o pode enviar mensagens.');
        return; // Impede o envio da mensagem
    }
    const message = chatMessageInput.value.trim();
    if (!currentUser || !message) return;

    if (contemPalavraImpropria(message)) {
        alert('Sua mensagem cont√©m termos n√£o permitidos e n√£o ser√° enviada.');
        chatMessageInput.value = ''; // Limpa o campo
        return;
    }
    if (message.length > MAX_MESSAGE_LENGTH) {
        alert(`Sua mensagem √© muito longa! O limite √© de ${MAX_MESSAGE_LENGTH} caracteres.`);
        return; // Impede o envio da mensagem
    }

    if (message.startsWith('/')) {
        handleCommand(message);
        chatMessageInput.value = '';
        return;
    }

    if (privateRecipient) {
        const conversationId = [currentUser, privateRecipient].sort().join('_');
        privateMessagesRef.child(conversationId).push({
            from: currentUser, to: privateRecipient, message,
            timestamp: firebase.database.ServerValue.TIMESTAMP
        });
    } else {
    publicMessagesRef.push({
        name: currentUser,
        message,
        timestamp: firebase.database.ServerValue.TIMESTAMP,
        watchingStream: isLiveNow ? currentStreamKey : 'offline',
        senderDeviceId: deviceId // <-- ESTA √â A LINHA ADICIONADA
    });
}
    chatMessageInput.value = '';
});

// --- FUN√á√ÉO PARA PROCESSAR COMANDOS ---
function handleCommand(message) {
    const parts = message.split(' ');
    const command = parts[0];
    const args = parts.slice(1);

    if (command === '/limparagora') {
        if (confirm('Tem certeza que deseja apagar TODAS as mensagens do chat p√∫blico?')) {
            publicMessagesRef.remove();
            privateMessagesRef.remove();
        }
    } else if (command === '/nome') {
        const newName = args.join(' ').trim();
        const oldName = currentUser;

        if (!newName) {
            displaySystemMessage('Uso: /nome <seu_novo_nome>');
        } else if (chatParticipants.has(newName)) {
            displaySystemMessage(`O nome "${newName}" j√° est√° em uso.`);
        } else {
            participantsRef.child(oldName).remove();
            const newParticipantRef = participantsRef.child(newName);
            newParticipantRef.set(true);
            newParticipantRef.onDisconnect().remove();

            currentUser = newName;
            localStorage.setItem('dbdChatName', newName);

            displaySystemMessage(`Seu nome foi alterado de "${oldName}" para "${newName}"`);
        }
    } else {
        displaySystemMessage(`Comando "${command}" n√£o reconhecido.`);
    }
}

// üîß ALTERADO: L√≥gica para RENDERIZAR mensagens p√∫blicas
publicMessagesRef.limitToLast(100).on('child_added', (snapshot) => {
    const msg = snapshot.val();
    const messageKey = snapshot.key; // Pega a chave √∫nica da mensagem
    if (!msg || !msg.name || !msg.message || msg.to) return;
    displayPublicMessage(msg, messageKey); // Passa a chave para a fun√ß√£o de exibi√ß√£o
});

// Escuta por mensagens alteradas (editadas ou apagadas)
publicMessagesRef.limitToLast(100).on('child_changed', (snapshot) => {
    const msg = snapshot.val();
    const messageKey = snapshot.key;
    const messageElement = document.querySelector(`[data-message-id="${messageKey}"]`);

    if (messageElement) {
        const textSpan = messageElement.querySelector('.text');
        const editedIndicator = messageElement.querySelector('.edited-indicator');

        // Atualiza o texto da mensagem
        textSpan.innerHTML = escapeHTML(msg.message).replace(/@([\w√Ä-√∫]+)/g, '<span class="mention">@$1</span>');

        // Adiciona ou confirma o indicador "(editado)"
        if (msg.isEdited && !editedIndicator) {
            const indicator = document.createElement('span');
            indicator.className = 'edited-indicator';
            indicator.textContent = '(editado)';
            messageElement.appendChild(indicator);
        }

        // Se a mensagem foi "apagada" (texto substitu√≠do)
        if (msg.isDeleted) {
             textSpan.style.color = '#888';
              textSpan.style.fontStyle = 'italic';
              messageElement.style.pointerEvents = 'none'; // Impede novos cliques
        }
    }
});

// üîß ALTERADO: Fun√ß√£o para exibir a mensagem p√∫blica
function displayPublicMessage(msg, messageKey) {
    const messageElement = document.createElement('div');
    messageElement.classList.add('chat-message');
    messageElement.dataset.messageId = messageKey;
    if(msg.timestamp) messageElement.dataset.timestamp = msg.timestamp;
    if(msg.senderDeviceId) messageElement.dataset.senderDeviceId = msg.senderDeviceId;

    if (msg.watchingStream) {
        const streamIndicator = document.createElement('span');
        streamIndicator.className = 'watching-indicator';
        streamIndicator.textContent = msg.watchingStream === 'offline' ? 'Sem live ativa' : `Na tela ${msg.watchingStream.slice(-1)}`;
        messageElement.appendChild(streamIndicator);
    }

    const nameSpan = document.createElement('span');
    nameSpan.className = 'name';
    nameSpan.dataset.username = msg.name;

    // ===== L√ìGICA DE HIERARQUIA CORRIGIDA E MELHORADA =====

    // ‚ùó MUDAN√áA AQUI: Comparamos os nomes em min√∫sculas
    if (adminUsername && msg.name.toLowerCase() === adminUsername.toLowerCase()) {
        messageElement.classList.add('admin-message');
        nameSpan.textContent = 'ADMINISTRADOR:';

    } else if (moderatorList[msg.name]) {
        messageElement.classList.add('moderator-message');
        nameSpan.textContent = msg.name + ':';
        nameSpan.style.color = '#FFD700';

    } else {
        if (!userColors[msg.name]) userColors[msg.name] = getRandomColor();
        nameSpan.textContent = msg.name + ':';
        nameSpan.style.color = userColors[msg.name]; 
    }
    
    // ===== FIM DA L√ìGICA =====

    messageElement.appendChild(nameSpan);

    const messageSpan = document.createElement('span');
    messageSpan.className = 'text';

    if (msg.isDeleted) {
        messageSpan.textContent = msg.message;
        messageSpan.style.color = '#888';
        messageSpan.style.fontStyle = 'italic';
        messageElement.style.pointerEvents = 'none';
    } else {
        messageSpan.innerHTML = escapeHTML(msg.message).replace(/@([\w√Ä-√∫]+)/g, '<span class="mention">@$1</span>');
    }
    messageElement.appendChild(messageSpan);

    if (msg.isEdited) {
        const indicator = document.createElement('span');
        indicator.className = 'edited-indicator';
        indicator.textContent = '(editado)';
        messageElement.appendChild(indicator);
    }

    chatMessages.appendChild(messageElement);

    if (!chatMessages.classList.contains('placeholder-active')) {
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }
}
// L√≥gica para RENDERIZAR mensagens privadas
function displayPrivateMessage(msg) {
    const isSender = msg.from === currentUser;
    const otherPerson = isSender ? msg.to : msg.from;
    const messageElement = document.createElement('div');
    messageElement.classList.add('chat-message', 'private-message');
    const header = document.createElement('div');
    header.className = 'pm-header';
    header.textContent = isSender ? `Sussurro para ${otherPerson}:` : `Sussurro de ${otherPerson}:`;
    messageElement.appendChild(header);
    const messageSpan = document.createElement('span');
    messageSpan.className = 'text';
    messageSpan.textContent = msg.message;
    messageElement.appendChild(messageSpan);
    chatMessages.appendChild(messageElement);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

// L√≥gica para "ESCUTAR" por mensagens privadas
function listenForPrivateMessages(username) {
    const conversationIds = new Set();
    const setupListener = (otherUser) => {
        if (otherUser === username) return;
        const conversationId = [username, otherUser].sort().join('_');
        if (conversationIds.has(conversationId)) return;
        conversationIds.add(conversationId);
        privateMessagesRef.child(conversationId).on('child_added', (msgSnapshot) => {
            const msg = msgSnapshot.val();
            if (msg && (msg.to === username || msg.from === username)) {
                displayPrivateMessage(msg);
            }
        });
    };
    participantsRef.on('child_added', (snapshot) => setupListener(snapshot.key));
}

// L√≥gica do MENU DE CONTEXTO e SUGEST√ïES DE MEN√á√ÉO
document.body.addEventListener('click', (e) => {
    const existingMenu = document.querySelector('.context-menu');
    if (existingMenu) existingMenu.remove();
    hideSuggestions();

    if (e.target.classList.contains('name')) {
        const username = e.target.dataset.username;
        if (username && username !== currentUser) {
            e.preventDefault();
            createContextMenu(username, e.pageX, e.pageY);
        }
    }
});

function createContextMenu(username, x, y) {
    const menu = document.createElement('div');
    menu.className = 'context-menu';
    menu.style.left = `${x}px`;
    menu.style.top = `${y}px`;
    const pmItem = document.createElement('div');
    pmItem.className = 'context-menu-item';
    pmItem.textContent = `Mensagem Privada`;
    pmItem.onclick = () => { enterPrivateMode(username); menu.remove(); };
    menu.appendChild(pmItem);
    document.body.appendChild(menu);
}

// Fun√ß√µes para GERENCIAR o modo de conversa
function enterPrivateMode(username) {
    privateRecipient = username;
    pmInfo.textContent = `Sussurrando para ${username}...`;
    pmIndicator.classList.remove('hidden');
    chatMessageInput.placeholder = `Mensagem privada para ${username}...`;
    chatMessageInput.focus();
}

function exitPrivateMode() {
    privateRecipient = null;
    pmIndicator.classList.add('hidden');
    chatMessageInput.placeholder = 'Digite sua mensagem...';
    chatMessageInput.focus();
}
exitPmBtn.addEventListener('click', exitPrivateMode);

// --- L√ìGICA DAS SUGEST√ïES DE MEN√á√ÉO (CORRIGIDA) ---
chatMessageInput.addEventListener('input', () => {
    const text = chatMessageInput.value;
    const cursorPos = chatMessageInput.selectionStart;

    // Verifica se o cursor est√° logo ap√≥s um @
    if (text.substring(cursorPos - 1, cursorPos) === '@' && (text.length === 1 || text.substring(cursorPos - 2, cursorPos - 1) === ' ')) {
        const suggestions = [...chatParticipants].filter(name => name !== currentUser);
        if (suggestions.length > 0) showSuggestions(suggestions, cursorPos - 1);
        else hideSuggestions();
        return;
    }

    // L√≥gica para filtrar nomes
    const textBeforeCursor = text.substring(0, cursorPos);
    const lastAtIndex = textBeforeCursor.lastIndexOf('@');
    const lastSpaceIndex = textBeforeCursor.lastIndexOf(' ');

    if (lastAtIndex > lastSpaceIndex) {
        const searchTerm = textBeforeCursor.substring(lastAtIndex + 1).toLowerCase();
        const suggestions = [...chatParticipants].filter(name =>
            name.toLowerCase().startsWith(searchTerm) && name !== currentUser
        );
        if (suggestions.length > 0) showSuggestions(suggestions, lastAtIndex);
        else hideSuggestions();
    } else {
        hideSuggestions();
    }
});

function showSuggestions(suggestions, atIndex) {
    suggestionsBox.innerHTML = '';
    suggestions.forEach(name => {
        const item = document.createElement('div');
        item.className = 'suggestion-item';
        item.textContent = name;
        item.addEventListener('mousedown', (e) => {
            e.preventDefault();
            const text = chatMessageInput.value;
            const before = text.substring(0, atIndex);
            const after = text.substring(chatMessageInput.selectionStart);
            chatMessageInput.value = `${before}@${name} ${after}`;
            hideSuggestions();
            chatMessageInput.focus();
        });
        suggestionsBox.appendChild(item);
    });
    suggestionsBox.classList.remove('hidden');
}

function hideSuggestions() {
    if (!suggestionsBox.classList.contains('hidden')) {
        suggestionsBox.classList.add('hidden');
    }
}

// Limpeza geral do chat p√∫blico
publicMessagesRef.on('value', (snapshot) => {
    if (!snapshot.exists() && chatMessages) {
        chatMessages.innerHTML = ''; // Limpa completamente o chat
        const name = localStorage.getItem('dbdChatName');

        // S√ì recria o placeholder se o usu√°rio N√ÉO tiver um nome salvo
        if (!name) { 
            const placeholder = document.createElement('div');
            placeholder.id = 'chat-placeholder';
            placeholder.innerHTML = `<div class="placeholder-icon">üí¨</div>
                <h4>Bem-vindo ao Chat da Entidade</h4>
                <p>Use <code>/nome SEUNOME</code> para mudar o nome de usu√°rio. Ex: /nome Chris.</p>
                <p>Clique sobre o nome de um usu√°rio para enviar uma DM.</p>
                <p>Digite <code>@</code> para mencionar algu√©m.</p>
                <p>Clique em uma mensagem para edit√°-la ou exclu√≠-la.</p>`;
            chatMessages.appendChild(placeholder);
        }
    }
});
        // ‚ú® IN√çCIO: L√ìGICA PARA EDITAR E APAGAR MENSAGENS ‚ú®

const TIME_LIMIT_MS = 15 * 60 * 1000; // 15 minutos em milissegundos

// Usamos delega√ß√£o de evento no container de mensagens para performance
chatMessages.addEventListener('click', (e) => {
    // Remove qualquer menu anterior que possa estar aberto
    const existingMenu = document.querySelector('.message-options-menu');
    if (existingMenu) existingMenu.remove();

    const messageElement = e.target.closest('.chat-message');
    if (!messageElement) return; // Se o clique n√£o foi em uma mensagem, sai

    // Pega as informa√ß√µes que guardamos nos data-attributes
    const messageId = messageElement.dataset.messageId;
    const senderId = messageElement.dataset.senderDeviceId;
    const timestamp = parseInt(messageElement.dataset.timestamp, 10);
    const messageText = messageElement.querySelector('.text').textContent;

    // CONDI√á√ïES PARA MOSTRAR O MENU:
    // 1. O remetente da msg √© o usu√°rio atual?
    // 2. A mensagem tem um timestamp v√°lido?
    // 3. O tempo decorrido √© menor que 15 minutos?
    if (isChatCurrentlyEnabled && senderId === deviceId && timestamp && (Date.now() - timestamp < TIME_LIMIT_MS)) {
        createMessageOptionsMenu(e.pageX, e.pageY, messageId, messageText);
    }
});

function createMessageOptionsMenu(x, y, messageId, currentText) {
    const menu = document.createElement('div');
    menu.className = 'message-options-menu';
    // Ajusta a posi√ß√£o para n√£o sair da tela
    menu.style.left = `${Math.min(x, window.innerWidth - 150)}px`; 
    menu.style.top = `${y}px`;

    // Op√ß√£o de Editar
    const editItem = document.createElement('div');
    editItem.className = 'options-menu-item';
    editItem.textContent = 'Editar';
    editItem.onclick = () => {
        const newText = prompt('Edite sua mensagem:', currentText);
        // Se o usu√°rio n√£o clicou em "cancelar" e o texto n√£o est√° vazio
        if (newText !== null && newText.trim() !== '') {
            publicMessagesRef.child(messageId).update({
                message: newText.trim(),
                isEdited: true
            });
        }
        menu.remove();
    };

    // Op√ß√£o de Apagar
    const deleteItem = document.createElement('div');
    deleteItem.className = 'options-menu-item delete';
    deleteItem.textContent = 'Apagar para todos';
    deleteItem.onclick = () => {
        if (confirm('Tem certeza de que deseja apagar esta mensagem para todos?')) {
            // Em vez de remover, substitu√≠mos o conte√∫do. Fica mais limpo.
            publicMessagesRef.child(messageId).update({
                message: 'Mensagem apagada pelo autor.',
                isDeleted: true
            });
        }
        menu.remove();
    };

    menu.appendChild(editItem);
    menu.appendChild(deleteItem);
    document.body.appendChild(menu);

    // Garante que o menu seja removido se o usu√°rio clicar fora dele
    setTimeout(() => {
        document.body.addEventListener('click', () => menu.remove(), { once: true });
    }, 0);
}

// ‚ú® FIM: L√ìGICA PARA EDITAR E APAGAR MENSAGENS ‚ú®
// --- FIM: L√ìGICA DO CHAT AO VIVO ---
        // ‚ú® IN√çCIO: L√ìGICA DO SELETOR DE EMOJIS ‚ú®
const emojiBtn = document.getElementById('emoji-toggle-btn');
const emojiPicker = document.getElementById('emoji-picker');

// Lista de emojis que aparecer√£o no painel
const emojis = [
    // Carinhas e Rea√ß√µes
    'üòÄ', 'üòÉ', 'üòÑ', 'üòÅ', 'üòÜ', 'üòÖ', 'ü§£', 'üòÇ', 'üôÇ', 'üôÉ', 'ü´†', 'üòâ', 'üòä', 'üòá', 'ü•∞', 'üòç', 'ü§©', 'üòò',
    'üòó', '‚ò∫Ô∏è', 'üòö', 'üòô', 'ü•≤', 'üòã', 'üòõ', 'üòú', 'ü§™', 'üòù', 'ü§ë', 'ü§ó', 'ü§≠', 'ü´¢', 'ü´£', 'ü§´', 'ü§î',
    'ü´°', 'ü§ê', 'ü§®', 'üòê', 'üòë', 'üò∂', 'ü´•', 'üò∂‚Äçüå´Ô∏è', 'üòè', 'üòí', 'üôÑ', 'üò¨', 'üòÆ‚Äçüí®', 'ü§•', 'ü´®', 'üôÇ‚Äç‚ÜîÔ∏è',
    'üôÇ‚Äç‚ÜïÔ∏è', 'üòå', 'üòî', 'üò™', 'ü§§', 'üò¥', 'üò∑', 'ü§í', 'ü§ï', 'ü§¢', 'ü§Æ', 'ü§ß', 'ü•µ', 'ü•∂', 'ü•¥', 'üòµ', 'üòµ‚Äçüí´',
    'ü§Ø', 'ü§†', 'ü•≥', 'ü•∏', 'üòé', 'ü§ì', 'üßê', 'üòï', 'ü´§', 'üòü', 'üôÅ', '‚òπÔ∏è', 'üòÆ', 'üòØ', 'üò≤', 'üò≥', 'ü•∫',
    'ü•π', 'üò¶', 'üòß', 'üò®', 'üò∞', 'üò•', 'üò¢', 'üò≠', 'üò±', 'üòñ', 'üò£', 'üòû', 'üòì', 'üò©', 'üò´', 'ü•±', 'üò§',
    'üò°', 'üò†', 'ü§¨', 'üòà', 'üëø', 'üíÄ', '‚ò†Ô∏è', 'üí©', 'ü§°', 'üëπ', 'üë∫', 'üëª', 'üëΩ', 'üëæ', 'ü§ñ', 'üò∫', 'üò∏',
    'üòπ', 'üòª', 'üòº', 'üòΩ', 'üôÄ', 'üòø', 'üòæ', 'üôà', 'üôâ', 'üôä', 'üëã', 'ü§ö', 'üñêÔ∏è', '‚úã', 'üññ', 'ü´±', 'ü´≤',
    'ü´≥', 'ü´¥', 'ü´∑', 'ü´∏', 'üëå', 'ü§å', 'ü§è', '‚úåÔ∏è', 'ü§û', 'ü´∞', 'ü§ü', 'ü§ò', 'ü§ô', 'üëà', 'üëâ', 'üëÜ', 'üñï',
    'üëá', '‚òùÔ∏è', 'ü´µ', 'üëç', 'üëé', '‚úä', 'üëä', 'ü§õ', 'ü§ú', 'üëè', 'üôå', 'ü´∂', 'üëê', 'ü§≤', 'ü§ù', 'üôè', '‚úçÔ∏è',
    'üíÖ', 'ü§≥', 'üí™', 'ü¶æ', 'ü¶ø', 'ü¶µ', 'ü¶∂', 'üëÇ', 'ü¶ª', 'üëÉ', 'üôã‚Äç‚ôÇÔ∏è', 'üôã‚Äç‚ôÄÔ∏è', '‚ù§Ô∏è', 'ü©∑', 'üß°', 'üíõ', 'üíö',
    'üíô', 'ü©µ', 'üíú', 'ü§é', 'üñ§', 'ü©∂', 'ü§ç', 'üéñÔ∏è', 'üèÜ', 'üèÖ', 'ü•á', 'ü•à', 'ü•â'
];

// Fun√ß√£o que cria os emojis e os adiciona ao painel
function populateEmojiPicker() {
    emojis.forEach(emoji => {
        const emojiEl = document.createElement('span');
        emojiEl.className = 'emoji-item';
        emojiEl.textContent = emoji;
        emojiEl.addEventListener('click', () => {
            // Insere o emoji na posi√ß√£o atual do cursor no campo de texto
            const start = chatMessageInput.selectionStart;
            const end = chatMessageInput.selectionEnd;
            const text = chatMessageInput.value;
            chatMessageInput.value = text.substring(0, start) + emoji + text.substring(end);
            chatMessageInput.focus();
            // Move o cursor para depois do emoji inserido
            chatMessageInput.selectionEnd = start + emoji.length;
        });
        emojiPicker.appendChild(emojiEl);
    });
}
populateEmojiPicker(); // Chama a fun√ß√£o para criar os emojis assim que a p√°gina carrega

// Evento para mostrar/esconder o painel de emojis
emojiBtn.addEventListener('click', (event) => {
    event.stopPropagation(); // Impede que o clique feche o painel imediatamente
    emojiPicker.classList.toggle('hidden');
});

// Evento para fechar o painel se clicar em qualquer outro lugar da p√°gina
document.addEventListener('click', (event) => {
    if (!emojiPicker.classList.contains('hidden') && !emojiPicker.contains(event.target) && event.target !== emojiBtn) {
        emojiPicker.classList.add('hidden');
    }
});
// ‚ú® FIM: L√ìGICA DO SELETOR DE EMOJIS ‚ú®


// --- FIM: L√ìGICA DO CHAT AO VIVO ---


        // (O resto do seu c√≥digo JS continua aqui, sem altera√ß√µes)
        const visitorCountElement = document.getElementById('visitor-count');
        const presenceRef = database.ref('presence');
        const mySessionRef = presenceRef.push();
        mySessionRef.onDisconnect().remove();
        mySessionRef.set(true);
        presenceRef.on('value', (snapshot) => {
            const count = snapshot.numChildren();
            if (visitorCountElement) {
                visitorCountElement.textContent = count;
            }
        });
        
        const offlineOverlay = document.getElementById('offline-overlay');
        const liveIndicator = document.getElementById('live-indicator-wrapper');
        const unmutePopup = document.getElementById('dbd-unmute-popup');
        const unmuteYesBtn = document.getElementById('unmute-yes-btn');
        const unmuteNoBtn = document.getElementById('unmute-no-btn');
        let popupShown = false;
        window.onPlayerStateChange = function(event) {
    if (event.data === YT.PlayerState.PLAYING) { // Removi o !popupShown para o bot√£o sempre aparecer
        offlineOverlay.classList.add('hidden');
        liveIndicator.classList.remove('hidden');
        document.getElementById('video-loader').classList.add('hidden'); // Esconde a anima√ß√£o
        fullscreenBtn.classList.remove('hidden'); // LINHA ADICIONADA AQUI

        if (!popupShown) { // Movi o popup para uma verifica√ß√£o separada
            unmutePopup.classList.add('show');
            popupShown = true;
        }
    } else {
        // Esconde nosso bot√£o de tela cheia se o v√≠deo n√£o estiver tocando
        fullscreenBtn.classList.add('hidden');
    }
}
        unmuteYesBtn.addEventListener('click', (event) => {
            event.preventDefault();
            unmutePopup.classList.remove('show');
            if (player && typeof player.unMute === 'function') {
                player.unMute();
            }
        });
        unmuteNoBtn.addEventListener('click', (event) => {
            event.preventDefault();
            unmutePopup.classList.remove('show');
        });
        const feedbackOverlay = document.getElementById('feedback-popup-overlay');
        const openFeedbackBtn = document.getElementById('open-feedback-btn');
        const closeFeedbackBtn = document.getElementById('close-feedback-btn');
        const feedbackForm = document.getElementById('feedback-form');
        const formContent = document.getElementById('feedback-form-content');
        const successContent = document.getElementById('feedback-success-content');
        openFeedbackBtn.addEventListener('click', () => feedbackOverlay.classList.add('active'));
        if(closeFeedbackBtn) {
            closeFeedbackBtn.addEventListener('click', () => {
                feedbackOverlay.classList.remove('active');
                setTimeout(() => {
                    formContent.classList.remove('hidden');
                    successContent.classList.add('hidden');
                }, 400);
            });
        }
        feedbackForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(feedbackForm);
            const submitBtn = feedbackForm.querySelector('.submit-feedback');
            submitBtn.textContent = 'Enviando...';
            submitBtn.disabled = true;
            fetch(feedbackForm.action, {
                method: 'POST', body: formData, headers: { 'Accept': 'application/json' }
            }).then(response => {
                if (response.ok) {
                    formContent.classList.add('hidden');
                    successContent.classList.remove('hidden');
                } else {
                    alert('Houve um erro ao enviar seu feedback. Tente novamente.');
                    submitBtn.textContent = 'Enviar Feedback';
                    submitBtn.disabled = false;
                }
            }).catch(error => {
                alert('Houve um erro de conex√£o. Tente novamente.');
                submitBtn.textContent = 'Enviar Feedback';
                submitBtn.disabled = false;
            });
        });
        // SUBSTITUA TODO O BLOCO DO PLACAR POR ESTE C√ìDIGO CORRIGIDO
const scoreboardFab = document.getElementById('scoreboard-fab');
const scoreboardOverlay = document.getElementById('scoreboard-overlay');
const closeScoreboardBtn = document.getElementById('close-scoreboard-btn');

// üîß CORRIGIDO: Refer√™ncias aos elementos corretos do HTML
const teamsList = document.getElementById('teams-leaderboard'); 
const timestampElement = document.getElementById('last-updated-timestamp');

scoreboardFab.addEventListener('click', () => scoreboardOverlay.classList.add('active'));
closeScoreboardBtn.addEventListener('click', () => scoreboardOverlay.classList.remove('active'));

// ‚ú® ATUALIZADO: Fun√ß√£o completa que atualiza a lista E o carimbo de data/hora
function updateLeaderboard(snapshot, listElement, timestampEl) {
    const data = snapshot.val();
    listElement.innerHTML = '<li>Carregando...</li>';

    if (data) {
        const now = new Date();
        const pad = (num) => num.toString().padStart(2, '0');
        const formattedDate = `${pad(now.getDate())}/${pad(now.getMonth() + 1)}/${now.getFullYear()}`;
        const formattedTime = `${pad(now.getHours())}:${pad(now.getMinutes())}:${pad(now.getSeconds())}`;
        timestampEl.textContent = `√öltima atualiza√ß√£o: ${formattedDate} √†s ${formattedTime}`;
    } else {
        timestampEl.textContent = 'Ainda n√£o h√° dados no placar.';
    }

    if (data) {
        listElement.innerHTML = '';
        const entries = Object.keys(data).map(key => ({ id: key, ...data[key] }));
        
        const sortedEntries = entries.sort((a, b) => b.score - a.score);
        
        if (sortedEntries.length === 0) {
            listElement.innerHTML = '<li>Nenhuma equipe registrada ainda.</li>';
        } else {
            sortedEntries.forEach((entry, index) => {
                const li = document.createElement('li');
                li.innerHTML = `<span data-team-id="${entry.id}" class="name">${index + 1}. ${entry.name}</span><span class="score">${entry.score} pts</span>`;
                listElement.appendChild(li);
            });
        }
    } else {
        listElement.innerHTML = '<li>Nenhuma equipe registrada ainda.</li>';
    }
}

// üîß CORRIGIDO: Listener que chama a fun√ß√£o com os par√¢metros corretos
const teamsRef = database.ref('teams');
teamsRef.on('value', (snapshot) => {
    updateLeaderboard(snapshot, teamsList, timestampElement);
});
        // --- IN√çCIO: L√ìGICA PARA MOSTRAR OS CONFRONTOS SORTEADOS ---

// 1. Apontamos para o local no "quadro de avisos" onde os confrontos ser√£o guardados.
const tournamentResultsRef = database.ref('tournamentResults');
const championContainer = document.getElementById('champion-container');
const championNameEl = document.getElementById('champion-name');
const gruposContainer = document.getElementById('grupos-container');
const semisContainer = document.getElementById('semis-container');
const finalContainer = document.getElementById('final-container');
const gruposLista = document.getElementById('grupos-lista');
const semisLista = document.getElementById('semis-lista');
const finalLista = document.getElementById('final-lista');
const semConfrontosMsg = document.getElementById('sem-confrontos-msg');

function criarBlocoDeConfrontoHTML(confronto) {
    const { id, title, teamA, teamB } = confronto;
    // O t√≠tulo principal do bloco n√£o precisa mais do "vs" pois j√° est√° no t√≠tulo da fase
    const mainTitle = title.includes(":") ? title.split(":")[1].trim() : `${teamA} vs ${teamB}`;

    let html = `<div class="confronto-bloco">`;
    html += `<div class="confronto-bloco-titulo">${id}. ${mainTitle}</div>`;

    // Partida 1: A escolhe killer
    html += `<div class="match-pair-placar"><div class="team-side-placar"><span class="team-name-placar">${teamA}</span><br><span class="team-role-placar">(Escolhe Killer)</span></div> <span class="vs-separator">vs</span> <div class="team-side-placar"><span class="team-name-placar">${teamB}</span><br><span class="team-role-placar">(Sobrevivente)</span></div></div>`;
    // Partida 2: B espelha
    html += `<div class="match-pair-placar"><div class="team-side-placar"><span class="team-name-placar">${teamB}</span><br><span class="team-role-placar">(Espelha Killer)</span></div> <span class="vs-separator">vs</span> <div class="team-side-placar"><span class="team-name-placar">${teamA}</span><br><span class="team-role-placar">(Sobrevivente)</span></div></div>`;
    // Partida 3: B escolhe killer
    html += `<div class="match-pair-placar"><div class="team-side-placar"><span class="team-name-placar">${teamB}</span><br><span class="team-role-placar">(Escolhe Killer)</span></div> <span class="vs-separator">vs</span> <div class="team-side-placar"><span class="team-name-placar">${teamA}</span><br><span class="team-role-placar">(Sobrevivente)</span></div></div>`;
    // Partida 4: A espelha
    html += `<div class="match-pair-placar"><div class="team-side-placar"><span class="team-name-placar">${teamA}</span><br><span class="team-role-placar">(Espelha Killer)</span></div> <span class="vs-separator">vs</span> <div class="team-side-placar"><span class="team-name-placar">${teamB}</span><br><span class="team-role-placar">(Sobrevivente)</span></div></div>`;

    html += `</div>`;
    return html;
}


tournamentResultsRef.on('value', (snapshot) => {
    const results = snapshot.val();

    // 1. Esconde tudo para come√ßar
    championContainer.classList.add('hidden');
    gruposContainer.classList.add('hidden');
    semisContainer.classList.add('hidden');
    finalContainer.classList.add('hidden');
    semConfrontosMsg.classList.remove('hidden'); // Come√ßa mostrando a msg padr√£o

    if (results && results.currentStage) {
        const stage = results.currentStage;
        semConfrontosMsg.classList.add('hidden'); // Esconde a msg padr√£o pois algo existe

        if (stage === 'faseDeGrupos' && results.faseDeGrupos) {
            gruposLista.innerHTML = results.faseDeGrupos.map(criarBlocoDeConfrontoHTML).join('');
            gruposContainer.classList.remove('hidden');
        } 
        else if (stage === 'semifinais' && results.semifinais) {
            semisLista.innerHTML = results.semifinais.map(criarBlocoDeConfrontoHTML).join('');
            semisContainer.classList.remove('hidden');
        } 
        else if (stage === 'final' && results.final) {
            finalLista.innerHTML = results.final.map(criarBlocoDeConfrontoHTML).join('');
            finalContainer.classList.remove('hidden');
        } 
        else if (stage === 'campeao' && results.campeao) {
            championNameEl.textContent = results.campeao;
            championContainer.classList.remove('hidden');
        }
    }
});
// --- FIM: L√ìGICA PARA MOSTRAR OS CONFRONTOS SORTEADOS ---
// ADICIONE ESTE NOVO BLOCO
fullscreenBtn.addEventListener('click', () => {
    // Verifica se J√Å existe um elemento em tela cheia no documento
    const isFullscreen = document.fullscreenElement || document.webkitFullscreenElement;

    // SE N√ÉO ESTIVER em tela cheia...
    if (!isFullscreen) {
        // ...ent√£o, entra em tela cheia.
        if (videoContainer.requestFullscreen) {
            videoContainer.requestFullscreen().then(() => { screen.orientation.lock('landscape'); });
        } else if (videoContainer.webkitRequestFullscreen) { /* Safari */
            videoContainer.webkitRequestFullscreen();
        } else if (videoContainer.msRequestFullscreen) { /* IE11 */
            videoContainer.msRequestFullscreen();
        }
    } 
    // SE J√Å ESTIVER em tela cheia...
    else {
        // ...ent√£o, sai da tela cheia.
        if (document.exitFullscreen) {
            document.exitFullscreen().then(() => { screen.orientation.unlock(); });
        } else if (document.webkitExitFullscreen) { /* Safari */
            document.webkitExitFullscreen();
        } else if (document.msExitFullscreen) { /* IE11 */
            document.msExitFullscreen();
        }
    }
});
        });
    // --- L√ìGICA DO POP-UP DE REGRAS (VERS√ÉO SIMPLES) ---
const openRulesBtn = document.getElementById('open-rules-btn');
const rulesPopupOverlay = document.getElementById('rules-popup-overlay');
const closeRulesBtn = document.getElementById('close-rules-btn');
const rulesPopupContent = document.getElementById('rules-popup-content');
const originalRulesList = document.querySelector('#rules-content ul');

// Copia as regras para dentro do pop-up (s√≥ faz isso uma vez)
if (originalRulesList) {
    rulesPopupContent.innerHTML = ''; // Limpa antes de adicionar
    rulesPopupContent.appendChild(originalRulesList.cloneNode(true));
}

// ABRIR o pop-up
openRulesBtn.addEventListener('click', () => {
    rulesPopupOverlay.classList.add('active');
});

// FECHAR o pop-up no bot√£o 'X'
closeRulesBtn.addEventListener('click', () => {
    rulesPopupOverlay.classList.remove('active');
});

// FECHAR o pop-up ao clicar fora
rulesPopupOverlay.addEventListener('click', (e) => {
    if (e.target === rulesPopupOverlay) {
        rulesPopupOverlay.classList.remove('active');
    }
});
// --- FIM DA NOVA L√ìGICA ---
        document.addEventListener('DOMContentLoaded', function() {
    const openFeedbackBtnHeader = document.getElementById('open-feedback-btn');
    const openFeedbackBtnFooter = document.getElementById('open-feedback-btn-footer');
    const feedbackOverlay = document.getElementById('feedback-popup-overlay');

    if (openFeedbackBtnFooter && feedbackOverlay) {
        openFeedbackBtnFooter.addEventListener('click', () => feedbackOverlay.classList.add('active'));
    }
});
</script>
    <div id="registration-closed-popup" class="popup-overlay align-top">
    <div class="feedback-popup">
        <button class="close-btn">√ó</button>
        <div class="feedback-success" style="display: block;">
            <img src="https://i.imgur.com/HGt7kAz.png" alt="Inscri√ß√µes Fechadas" style="height: 150px; margin-bottom: 15px;">
            <h3 style="font-family: 'Creepster', cursive; font-size: 2.5rem;">Inscri√ß√µes Fechadas</h3>
            <p>A Entidade n√£o est√° aceitando novos desafiantes no momento. Volte quando os port√µes de sa√≠da forem energizados!</p>
        </div>
    </div>
</div>
    <div id="team-info-overlay" class="popup-overlay align-top">
    <div id="team-info-popup" class="scoreboard-popup"> <button id="close-team-info-btn" class="close-btn">√ó</button>
        <h2 id="team-info-name">Nome da Equipe</h2>
        <ul id="team-info-members-list">
            </ul>
    </div>
</div>
    <script>
document.addEventListener('DOMContentLoaded', function() {
    const grimorioKillers = document.getElementById('grimorio-killers');
    const grimorioRecompensas = document.getElementById('grimorio-recompensas');

    // Se os elementos existirem na p√°gina
    if (grimorioKillers && grimorioRecompensas) {
        // A cada 10 segundos (10000 milissegundos)
        setInterval(() => {
            // Alterna as classes de visibilidade dos dois livros
            grimorioKillers.classList.toggle('grimorio-visible');
            grimorioKillers.classList.toggle('grimorio-hidden');

            grimorioRecompensas.classList.toggle('grimorio-visible');
            grimorioRecompensas.classList.toggle('grimorio-hidden');
        }, 10000); // 10000ms = 10 segundos
    }
});
        // --- IN√çCIO: L√ìGICA PARA ATIVAR/DESATIVAR INSCRI√á√ïES ---

// Seleciona os elementos que vamos usar
const signupBtn = document.getElementById('signup-btn');
    const registrationPopup = document.getElementById('registration-closed-popup');
    const closeRegistrationPopupBtn = registrationPopup.querySelector('.close-btn');

    // Refer√™ncia no seu Firebase para o controle de inscri√ß√µes
    const registrationsRef = database.ref('config/registrationsOpen');

    // Fica "ouvindo" qualquer mudan√ßa no valor de 'registrationsOpen' no Firebase
    registrationsRef.on('value', (snapshot) => {
        const areOpen = snapshot.val(); // Pega o valor (true ou false)

        if (areOpen === true) {
            // Se as inscri√ß√µes estiverem ABERTAS
            signupBtn.classList.remove('disabled');
            signupBtn.href = 'inscricao.html'; // Garante que o link funcione
            signupBtn.setAttribute('title', 'Clique para se inscrever!');
        } else {
            // Se as inscri√ß√µes estiverem FECHADAS (ou n√£o existir a chave)
            signupBtn.classList.add('disabled');
            signupBtn.href = '#'; // Remove o link para evitar navega√ß√£o
            signupBtn.setAttribute('title', 'As inscri√ß√µes est√£o fechadas no momento.');
        }
    });

    // Adiciona o evento de clique ao bot√£o de inscri√ß√£o
    signupBtn.addEventListener('click', (event) => {
        // Verifica se o bot√£o tem a classe 'disabled'
        if (signupBtn.classList.contains('disabled')) {
            event.preventDefault(); // Previne qualquer a√ß√£o padr√£o do link
            registrationPopup.classList.add('active'); // Mostra o pop-up de aviso
        }
    });

    // Fun√ß√£o para fechar o pop-up
    function closePopup() {
        registrationPopup.classList.remove('active');
    }

    // Adiciona eventos para fechar o pop-up
    closeRegistrationPopupBtn.addEventListener('click', closePopup);
    registrationPopup.addEventListener('click', (event) => {
        if (event.target === registrationPopup) {
            closePopup();
        }
    });

// --- FIM: L√ìGICA PARA ATIVAR/DESATIVAR INSCRI√á√ïES ---
</script>
    <script>
    // --- IN√çCIO: L√ìGICA DA CONTAGEM REGRESSIVA DIN√ÇMICA ---
    document.addEventListener('DOMContentLoaded', function() {
        // Esta verifica√ß√£o garante que a vari√°vel 'database' do Firebase j√° exista
        if (typeof database !== 'undefined') {
            // Refer√™ncias aos elementos do HTML
            const countdownContainer = document.getElementById('countdown-container');
            const timerElement = document.getElementById('timer');
            const liveMessageElement = document.getElementById('live-message');
            const daysEl = document.getElementById('days');
            const hoursEl = document.getElementById('hours');
            const minutesEl = document.getElementById('minutes');
            const secondsEl = document.getElementById('seconds');

            let countdownInterval; // Vari√°vel para controlar o timer

            // Refer√™ncia para buscar a data no Firebase
            const countdownTargetRef = database.ref('config/countdownTarget');

            countdownTargetRef.on('value', (snapshot) => {
                clearInterval(countdownInterval); // Limpa qualquer timer anterior
                const targetDateString = snapshot.val();

                if (!targetDateString || !countdownContainer) {
                    // Se n√£o houver data definida no admin ou o container n√£o existir, esconde o timer
                    if(countdownContainer) countdownContainer.style.display = 'none';
                    return;
                }

                // Mostra o timer caso ele estivesse escondido
                countdownContainer.style.display = 'flex';

                const countdownDate = new Date(targetDateString).getTime();

                function updateTimer() {
                    const now = new Date().getTime();
                    const distance = countdownDate - now;

                    if (distance < 0) {
                        clearInterval(countdownInterval);
                        if(timerElement) timerElement.classList.add('hidden');
                        if(liveMessageElement) liveMessageElement.classList.remove('hidden');
                        return;
                    }
                    
                    if(timerElement) timerElement.classList.remove('hidden');
                    if(liveMessageElement) liveMessageElement.classList.add('hidden');

                    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                    if(daysEl) daysEl.textContent = String(days).padStart(2, '0');
                    if(hoursEl) hoursEl.textContent = String(hours).padStart(2, '0');
                    if(minutesEl) minutesEl.textContent = String(minutes).padStart(2, '0');
                    if(secondsEl) secondsEl.textContent = String(seconds).padStart(2, '0');
                }

                updateTimer(); // Roda uma vez imediatamente
                countdownInterval = setInterval(updateTimer, 1000); // Atualiza a cada segundo
            });
        }
    });
    // --- FIM: L√ìGICA DA CONTAGEM REGRESSIVA DIN√ÇMICA ---
    
    </script>
    </body>
</html>
